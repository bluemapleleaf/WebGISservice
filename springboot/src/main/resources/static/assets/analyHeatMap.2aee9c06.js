var Zt=Object.defineProperty,qt=Object.defineProperties;var Jt=Object.getOwnPropertyDescriptors;var kt=Object.getOwnPropertySymbols;var Qt=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var Xt=(i,r,t)=>r in i?Zt(i,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[r]=t,jt=(i,r)=>{for(var t in r||(r={}))Qt.call(r,t)&&Xt(i,t,r[t]);if(kt)for(var t of kt(r))te.call(r,t)&&Xt(i,t,r[t]);return i},Wt=(i,r)=>qt(i,Jt(r));import"./index.26f42673.js";import{_ as _export_sfc}from"./plugin-vue_export-helper.21dcd24c.js";import{J as reactive,K as onMounted,f as axios,Q as toRefs,r as resolveComponent,o as openBlock,k as createElementBlock,F as createBaseVNode,l as createVNode,w as withCtx,M as Fragment,H as pushScopeId,I as popScopeId,N as renderList,x as createTextVNode,c as createBlock}from"./vendor.4847b99b.js";var ol="",Disposable=function(){function i(){this.disposed=!1}return i.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},i.prototype.disposeInternal=function(){},i}(),Disposable$1=Disposable;function numberSafeCompareFunction(i,r){return i>r?1:i<r?-1:0}function linearFindNearest(i,r,t){var e=i.length;if(i[0]<=r)return 0;if(r<=i[e-1])return e-1;var n=void 0;if(t>0){for(n=1;n<e;++n)if(i[n]<r)return n-1}else if(t<0){for(n=1;n<e;++n)if(i[n]<=r)return n}else for(n=1;n<e;++n){if(i[n]==r)return n;if(i[n]<r)return typeof t=="function"?t(r,i[n-1],i[n])>0?n-1:n:i[n-1]-r<r-i[n]?n-1:n}return e-1}function reverseSubArray(i,r,t){for(;r<t;){var e=i[r];i[r]=i[t],i[t]=e,++r,--t}}function extend$2(i,r){for(var t=Array.isArray(r)?r:[r],e=t.length,n=0;n<e;n++)i[i.length]=t[n]}function equals$2(i,r){var t=i.length;if(t!==r.length)return!1;for(var e=0;e<t;e++)if(i[e]!==r[e])return!1;return!0}function isSorted(i,r,t){var e=r||numberSafeCompareFunction;return i.every(function(n,o){if(o===0)return!0;var a=e(i[o-1],n);return!(a>0||t&&a===0)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(i){var r=!1,t,e,n;return function(){var o=Array.prototype.slice.call(arguments);return(!r||this!==n||!equals$2(o,e))&&(r=!0,n=this,e=o,t=i.apply(this,arguments)),t}}function abstract(){return function(){throw new Error("Unimplemented abstract method.")}()}var uidCounter_=0;function getUid(i){return i.ol_uid||(i.ol_uid=String(++uidCounter_))}var VERSION="6.9.0",ua=typeof navigator!="undefined"&&typeof navigator.userAgent!="undefined"?navigator.userAgent.toLowerCase():"",FIREFOX=ua.indexOf("firefox")!==-1;ua.indexOf("safari")!==-1&&ua.indexOf("chrom")==-1;var WEBKIT=ua.indexOf("webkit")!==-1&&ua.indexOf("edge")==-1,MAC=ua.indexOf("macintosh")!==-1,DEVICE_PIXEL_RATIO=typeof devicePixelRatio!="undefined"?devicePixelRatio:1,WORKER_OFFSCREEN_CANVAS=typeof WorkerGlobalScope!="undefined"&&typeof OffscreenCanvas!="undefined"&&self instanceof WorkerGlobalScope,IMAGE_DECODE=typeof Image!="undefined"&&Image.prototype.decode,PASSIVE_EVENT_LISTENERS=function(){var i=!1;try{var r=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,r),window.removeEventListener("_",null,r)}catch{}return i}(),__extends$1c=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),AssertionError=function(i){__extends$1c(r,i);function r(t){var e=this,n="v"+VERSION.split("-")[0],o="Assertion failed. See https://openlayers.org/en/"+n+"/doc/errors/#"+t+" for details.";return e=i.call(this,o)||this,e.code=t,e.name="AssertionError",e.message=o,e}return r}(Error),AssertionError$1=AssertionError;function assert(i,r){if(!i)throw new AssertionError$1(r)}var tmp_=new Array(6);function create$2(){return[1,0,0,1,0,0]}function reset(i){return set(i,1,0,0,1,0,0)}function multiply(i,r){var t=i[0],e=i[1],n=i[2],o=i[3],a=i[4],s=i[5],l=r[0],u=r[1],h=r[2],c=r[3],f=r[4],p=r[5];return i[0]=t*l+n*u,i[1]=e*l+o*u,i[2]=t*h+n*c,i[3]=e*h+o*c,i[4]=t*f+n*p+a,i[5]=e*f+o*p+s,i}function set(i,r,t,e,n,o,a){return i[0]=r,i[1]=t,i[2]=e,i[3]=n,i[4]=o,i[5]=a,i}function setFromArray(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i}function apply(i,r){var t=r[0],e=r[1];return r[0]=i[0]*t+i[2]*e+i[4],r[1]=i[1]*t+i[3]*e+i[5],r}function rotate$2(i,r){var t=Math.cos(r),e=Math.sin(r);return multiply(i,set(tmp_,t,e,-e,t,0,0))}function scale$3(i,r,t){return multiply(i,set(tmp_,r,0,0,t,0,0))}function makeScale(i,r,t){return set(i,r,0,0,t,0,0)}function compose(i,r,t,e,n,o,a,s){var l=Math.sin(o),u=Math.cos(o);return i[0]=e*u,i[1]=n*l,i[2]=-e*l,i[3]=n*u,i[4]=a*e*u-s*e*l+r,i[5]=a*n*l+s*n*u+t,i}function makeInverse(i,r){var t=determinant(r);assert(t!==0,32);var e=r[0],n=r[1],o=r[2],a=r[3],s=r[4],l=r[5];return i[0]=a/t,i[1]=-n/t,i[2]=-o/t,i[3]=e/t,i[4]=(o*l-a*s)/t,i[5]=-(e*l-n*s)/t,i}function determinant(i){return i[0]*i[3]-i[1]*i[2]}var transformStringDiv;function toString$1(i){var r="matrix("+i.join(", ")+")";if(WORKER_OFFSCREEN_CANVAS)return r;var t=transformStringDiv||(transformStringDiv=document.createElement("div"));return t.style.transform=r,t.style.transform}var Corner={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(i){for(var r=createEmpty(),t=0,e=i.length;t<e;++t)extendCoordinate(r,i[t]);return r}function buffer(i,r,t){return t?(t[0]=i[0]-r,t[1]=i[1]-r,t[2]=i[2]+r,t[3]=i[3]+r,t):[i[0]-r,i[1]-r,i[2]+r,i[3]+r]}function clone(i,r){return r?(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r):i.slice()}function closestSquaredDistanceXY(i,r,t){var e,n;return r<i[0]?e=i[0]-r:i[2]<r?e=r-i[2]:e=0,t<i[1]?n=i[1]-t:i[3]<t?n=t-i[3]:n=0,e*e+n*n}function containsCoordinate(i,r){return containsXY(i,r[0],r[1])}function containsExtent(i,r){return i[0]<=r[0]&&r[2]<=i[2]&&i[1]<=r[1]&&r[3]<=i[3]}function containsXY(i,r,t){return i[0]<=r&&r<=i[2]&&i[1]<=t&&t<=i[3]}function coordinateRelationship(i,r){var t=i[0],e=i[1],n=i[2],o=i[3],a=r[0],s=r[1],l=Relationship.UNKNOWN;return a<t?l=l|Relationship.LEFT:a>n&&(l=l|Relationship.RIGHT),s<e?l=l|Relationship.BELOW:s>o&&(l=l|Relationship.ABOVE),l===Relationship.UNKNOWN&&(l=Relationship.INTERSECTING),l}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate$2(i,r,t,e,n){return n?(n[0]=i,n[1]=r,n[2]=t,n[3]=e,n):[i,r,t,e]}function createOrUpdateEmpty(i){return createOrUpdate$2(1/0,1/0,-1/0,-1/0,i)}function createOrUpdateFromCoordinate(i,r){var t=i[0],e=i[1];return createOrUpdate$2(t,e,t,e,r)}function createOrUpdateFromFlatCoordinates(i,r,t,e,n){var o=createOrUpdateEmpty(n);return extendFlatCoordinates(o,i,r,t,e)}function equals$1(i,r){return i[0]==r[0]&&i[2]==r[2]&&i[1]==r[1]&&i[3]==r[3]}function extend$1(i,r){return r[0]<i[0]&&(i[0]=r[0]),r[2]>i[2]&&(i[2]=r[2]),r[1]<i[1]&&(i[1]=r[1]),r[3]>i[3]&&(i[3]=r[3]),i}function extendCoordinate(i,r){r[0]<i[0]&&(i[0]=r[0]),r[0]>i[2]&&(i[2]=r[0]),r[1]<i[1]&&(i[1]=r[1]),r[1]>i[3]&&(i[3]=r[1])}function extendFlatCoordinates(i,r,t,e,n){for(;t<e;t+=n)extendXY(i,r[t],r[t+1]);return i}function extendXY(i,r,t){i[0]=Math.min(i[0],r),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],r),i[3]=Math.max(i[3],t)}function forEachCorner(i,r){var t;return t=r(getBottomLeft(i)),t||(t=r(getBottomRight(i)),t)||(t=r(getTopRight(i)),t)||(t=r(getTopLeft(i)),t)?t:!1}function getArea(i){var r=0;return isEmpty$1(i)||(r=getWidth(i)*getHeight(i)),r}function getBottomLeft(i){return[i[0],i[1]]}function getBottomRight(i){return[i[2],i[1]]}function getCenter(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function getCorner(i,r){var t;return r===Corner.BOTTOM_LEFT?t=getBottomLeft(i):r===Corner.BOTTOM_RIGHT?t=getBottomRight(i):r===Corner.TOP_LEFT?t=getTopLeft(i):r===Corner.TOP_RIGHT?t=getTopRight(i):assert(!1,13),t}function getForViewAndSize(i,r,t,e,n){var o=r*e[0]/2,a=r*e[1]/2,s=Math.cos(t),l=Math.sin(t),u=o*s,h=o*l,c=a*s,f=a*l,p=i[0],d=i[1],v=p-u+f,_=p-u-f,g=p+u-f,y=p+u+f,m=d-h-c,E=d-h+c,T=d+h+c,I=d+h-c;return createOrUpdate$2(Math.min(v,_,g,y),Math.min(m,E,T,I),Math.max(v,_,g,y),Math.max(m,E,T,I),n)}function getHeight(i){return i[3]-i[1]}function getIntersection(i,r,t){var e=t||createEmpty();return intersects$1(i,r)?(i[0]>r[0]?e[0]=i[0]:e[0]=r[0],i[1]>r[1]?e[1]=i[1]:e[1]=r[1],i[2]<r[2]?e[2]=i[2]:e[2]=r[2],i[3]<r[3]?e[3]=i[3]:e[3]=r[3]):createOrUpdateEmpty(e),e}function getTopLeft(i){return[i[0],i[3]]}function getTopRight(i){return[i[2],i[3]]}function getWidth(i){return i[2]-i[0]}function intersects$1(i,r){return i[0]<=r[2]&&i[2]>=r[0]&&i[1]<=r[3]&&i[3]>=r[1]}function isEmpty$1(i){return i[2]<i[0]||i[3]<i[1]}function returnOrUpdate(i,r){return r?(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r):i}function intersectsSegment(i,r,t){var e=!1,n=coordinateRelationship(i,r),o=coordinateRelationship(i,t);if(n===Relationship.INTERSECTING||o===Relationship.INTERSECTING)e=!0;else{var a=i[0],s=i[1],l=i[2],u=i[3],h=r[0],c=r[1],f=t[0],p=t[1],d=(p-c)/(f-h),v=void 0,_=void 0;!!(o&Relationship.ABOVE)&&!(n&Relationship.ABOVE)&&(v=f-(p-u)/d,e=v>=a&&v<=l),!e&&!!(o&Relationship.RIGHT)&&!(n&Relationship.RIGHT)&&(_=p-(f-l)*d,e=_>=s&&_<=u),!e&&!!(o&Relationship.BELOW)&&!(n&Relationship.BELOW)&&(v=f-(p-s)/d,e=v>=a&&v<=l),!e&&!!(o&Relationship.LEFT)&&!(n&Relationship.LEFT)&&(_=p-(f-a)*d,e=_>=s&&_<=u)}return e}function wrapX$2(i,r){var t=r.getExtent(),e=getCenter(i);if(r.canWrapX()&&(e[0]<t[0]||e[0]>=t[2])){var n=getWidth(t),o=Math.floor((e[0]-t[0])/n),a=o*n;i[0]-=a,i[2]-=a}return i}function clamp(i,r,t){return Math.min(Math.max(i,r),t)}var cosh=function(){var i;return"cosh"in Math?i=Math.cosh:i=function(r){var t=Math.exp(r);return(t+1/t)/2},i}(),log2=function(){var i;return"log2"in Math?i=Math.log2:i=function(r){return Math.log(r)*Math.LOG2E},i}();function squaredSegmentDistance(i,r,t,e,n,o){var a=n-t,s=o-e;if(a!==0||s!==0){var l=((i-t)*a+(r-e)*s)/(a*a+s*s);l>1?(t=n,e=o):l>0&&(t+=a*l,e+=s*l)}return squaredDistance(i,r,t,e)}function squaredDistance(i,r,t,e){var n=t-i,o=e-r;return n*n+o*o}function solveLinearSystem(i){for(var r=i.length,t=0;t<r;t++){for(var e=t,n=Math.abs(i[t][t]),o=t+1;o<r;o++){var a=Math.abs(i[o][t]);a>n&&(n=a,e=o)}if(n===0)return null;var s=i[e];i[e]=i[t],i[t]=s;for(var l=t+1;l<r;l++)for(var u=-i[l][t]/i[t][t],h=t;h<r+1;h++)t==h?i[l][h]=0:i[l][h]+=u*i[t][h]}for(var c=new Array(r),f=r-1;f>=0;f--){c[f]=i[f][r]/i[f][f];for(var p=f-1;p>=0;p--)i[p][r]-=i[p][f]*c[f]}return c}function toRadians(i){return i*Math.PI/180}function modulo(i,r){var t=i%r;return t*r<0?t+r:t}function lerp(i,r,t){return i+t*(r-i)}var HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$|^hsla?\(.*\)$/i;function asString(i){return typeof i=="string"?i:toString(i)}function fromNamed(i){var r=document.createElement("div");if(r.style.color=i,r.style.color!==""){document.body.appendChild(r);var t=getComputedStyle(r).color;return document.body.removeChild(r),t}else return""}var fromString=function(){var i=1024,r={},t=0;return function(e){var n;if(r.hasOwnProperty(e))n=r[e];else{if(t>=i){var o=0;for(var a in r)(o++&3)==0&&(delete r[a],--t)}n=fromStringInternal_(e),r[e]=n,++t}return n}}();function asArray(i){return Array.isArray(i)?i:fromString(i)}function fromStringInternal_(i){var r,t,e,n,o;if(NAMED_COLOR_RE_.exec(i)&&(i=fromNamed(i)),HEX_COLOR_RE_.exec(i)){var a=i.length-1,s=void 0;a<=4?s=1:s=2;var l=a===4||a===8;r=parseInt(i.substr(1+0*s,s),16),t=parseInt(i.substr(1+1*s,s),16),e=parseInt(i.substr(1+2*s,s),16),l?n=parseInt(i.substr(1+3*s,s),16):n=255,s==1&&(r=(r<<4)+r,t=(t<<4)+t,e=(e<<4)+e,l&&(n=(n<<4)+n)),o=[r,t,e,n/255]}else i.indexOf("rgba(")==0?(o=i.slice(5,-1).split(",").map(Number),normalize(o)):i.indexOf("rgb(")==0?(o=i.slice(4,-1).split(",").map(Number),o.push(1),normalize(o)):assert(!1,14);return o}function normalize(i){return i[0]=clamp(i[0]+.5|0,0,255),i[1]=clamp(i[1]+.5|0,0,255),i[2]=clamp(i[2]+.5|0,0,255),i[3]=clamp(i[3],0,1),i}function toString(i){var r=i[0];r!=(r|0)&&(r=r+.5|0);var t=i[1];t!=(t|0)&&(t=t+.5|0);var e=i[2];e!=(e|0)&&(e=e+.5|0);var n=i[3]===void 0?1:i[3];return"rgba("+r+","+t+","+e+","+n+")"}var IconImageCache=function(){function i(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return i.prototype.clear=function(){this.cache_={},this.cacheSize_=0},i.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},i.prototype.expire=function(){if(this.canExpireCache()){var r=0;for(var t in this.cache_){var e=this.cache_[t];(r++&3)==0&&!e.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}},i.prototype.get=function(r,t,e){var n=getKey$1(r,t,e);return n in this.cache_?this.cache_[n]:null},i.prototype.set=function(r,t,e,n){var o=getKey$1(r,t,e);this.cache_[o]=n,++this.cacheSize_},i.prototype.setSize=function(r){this.maxCacheSize_=r,this.expire()},i}();function getKey$1(i,r,t){var e=t?asString(t):"null";return r+":"+i+":"+e}var shared=new IconImageCache,BaseEvent=function(){function i(r){this.propagationStopped,this.defaultPrevented,this.type=r,this.target=null}return i.prototype.preventDefault=function(){this.defaultPrevented=!0},i.prototype.stopPropagation=function(){this.propagationStopped=!0},i}(),BaseEvent$1=BaseEvent,ObjectEventType={PROPERTYCHANGE:"propertychange"},assign=typeof Object.assign=="function"?Object.assign:function(i,r){if(i==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(i),e=1,n=arguments.length;e<n;++e){var o=arguments[e];if(o!=null)for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])}return t};function clear(i){for(var r in i)delete i[r]}var getValues=typeof Object.values=="function"?Object.values:function(i){var r=[];for(var t in i)r.push(i[t]);return r};function isEmpty(i){var r;for(r in i)return!1;return!r}var __extends$1b=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Target=function(i){__extends$1b(r,i);function r(t){var e=i.call(this)||this;return e.eventTarget_=t,e.pendingRemovals_=null,e.dispatching_=null,e.listeners_=null,e}return r.prototype.addEventListener=function(t,e){if(!(!t||!e)){var n=this.listeners_||(this.listeners_={}),o=n[t]||(n[t]=[]);o.indexOf(e)===-1&&o.push(e)}},r.prototype.dispatchEvent=function(t){var e=typeof t=="string"?new BaseEvent$1(t):t,n=e.type;e.target||(e.target=this.eventTarget_||this);var o=this.listeners_&&this.listeners_[n],a;if(o){var s=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});n in s||(s[n]=0,l[n]=0),++s[n];for(var u=0,h=o.length;u<h;++u)if("handleEvent"in o[u]?a=o[u].handleEvent(e):a=o[u].call(this,e),a===!1||e.propagationStopped){a=!1;break}if(--s[n],s[n]===0){var c=l[n];for(delete l[n];c--;)this.removeEventListener(n,VOID);delete s[n]}return a}},r.prototype.disposeInternal=function(){this.listeners_&&clear(this.listeners_)},r.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},r.prototype.hasListener=function(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1},r.prototype.removeEventListener=function(t,e){var n=this.listeners_&&this.listeners_[t];if(n){var o=n.indexOf(e);o!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[o]=VOID,++this.pendingRemovals_[t]):(n.splice(o,1),n.length===0&&delete this.listeners_[t]))}},r}(Disposable$1),EventTarget=Target,EventType={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function listen(i,r,t,e,n){if(e&&e!==i&&(t=t.bind(e)),n){var o=t;t=function(){i.removeEventListener(r,t),o.apply(this,arguments)}}var a={target:i,type:r,listener:t};return i.addEventListener(r,t),a}function listenOnce(i,r,t,e){return listen(i,r,t,e,!0)}function unlistenByKey(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),clear(i))}var __extends$1a=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Observable=function(i){__extends$1a(r,i);function r(){var t=i.call(this)||this;return t.on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return r.prototype.changed=function(){++this.revision_,this.dispatchEvent(EventType.CHANGE)},r.prototype.getRevision=function(){return this.revision_},r.prototype.onInternal=function(t,e){if(Array.isArray(t)){for(var n=t.length,o=new Array(n),a=0;a<n;++a)o[a]=listen(this,t[a],e);return o}else return listen(this,t,e)},r.prototype.onceInternal=function(t,e){var n;if(Array.isArray(t)){var o=t.length;n=new Array(o);for(var a=0;a<o;++a)n[a]=listenOnce(this,t[a],e)}else n=listenOnce(this,t,e);return e.ol_key=n,n},r.prototype.unInternal=function(t,e){var n=e.ol_key;if(n)unByKey(n);else if(Array.isArray(t))for(var o=0,a=t.length;o<a;++o)this.removeEventListener(t[o],e);else this.removeEventListener(t,e)},r}(EventTarget);Observable.prototype.on;Observable.prototype.once;Observable.prototype.un;function unByKey(i){if(Array.isArray(i))for(var r=0,t=i.length;r<t;++r)unlistenByKey(i[r]);else unlistenByKey(i)}var Observable$1=Observable,__extends$19=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ObjectEvent=function(i){__extends$19(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.key=e,o.oldValue=n,o}return r}(BaseEvent$1),BaseObject=function(i){__extends$19(r,i);function r(t){var e=i.call(this)||this;return e.on,e.once,e.un,getUid(e),e.values_=null,t!==void 0&&e.setProperties(t),e}return r.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},r.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},r.prototype.getProperties=function(){return this.values_&&assign({},this.values_)||{}},r.prototype.hasProperties=function(){return!!this.values_},r.prototype.notify=function(t,e){var n;n="change:"+t,this.dispatchEvent(new ObjectEvent(n,t,e)),n=ObjectEventType.PROPERTYCHANGE,this.dispatchEvent(new ObjectEvent(n,t,e))},r.prototype.addChangeListener=function(t,e){this.addEventListener("change:"+t,e)},r.prototype.removeChangeListener=function(t,e){this.removeEventListener("change:"+t,e)},r.prototype.set=function(t,e,n){var o=this.values_||(this.values_={});if(n)o[t]=e;else{var a=o[t];o[t]=e,a!==e&&this.notify(t,a)}},r.prototype.setProperties=function(t,e){for(var n in t)this.set(n,t[n],e)},r.prototype.applyProperties=function(t){!t.values_||assign(this.values_||(this.values_={}),t.values_)},r.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var n=this.values_[t];delete this.values_[t],isEmpty(this.values_)&&(this.values_=null),e||this.notify(t,n)}},r}(Observable$1),BaseObject$1=BaseObject,LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source"},__extends$18=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),BaseLayer=function(i){__extends$18(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un;var n=assign({},t);return typeof t.properties=="object"&&(delete n.properties,assign(n,t.properties)),n[LayerProperty.OPACITY]=t.opacity!==void 0?t.opacity:1,assert(typeof n[LayerProperty.OPACITY]=="number",64),n[LayerProperty.VISIBLE]=t.visible!==void 0?t.visible:!0,n[LayerProperty.Z_INDEX]=t.zIndex,n[LayerProperty.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,n[LayerProperty.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,n[LayerProperty.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,n[LayerProperty.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,e.className_=n.className!==void 0?t.className:"ol-layer",delete n.className,e.setProperties(n),e.state_=null,e}return r.prototype.getClassName=function(){return this.className_},r.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=clamp(Math.round(this.getOpacity()*100)/100,0,1),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},r.prototype.getLayersArray=function(t){return abstract()},r.prototype.getLayerStatesArray=function(t){return abstract()},r.prototype.getExtent=function(){return this.get(LayerProperty.EXTENT)},r.prototype.getMaxResolution=function(){return this.get(LayerProperty.MAX_RESOLUTION)},r.prototype.getMinResolution=function(){return this.get(LayerProperty.MIN_RESOLUTION)},r.prototype.getMinZoom=function(){return this.get(LayerProperty.MIN_ZOOM)},r.prototype.getMaxZoom=function(){return this.get(LayerProperty.MAX_ZOOM)},r.prototype.getOpacity=function(){return this.get(LayerProperty.OPACITY)},r.prototype.getSourceState=function(){return abstract()},r.prototype.getVisible=function(){return this.get(LayerProperty.VISIBLE)},r.prototype.getZIndex=function(){return this.get(LayerProperty.Z_INDEX)},r.prototype.setExtent=function(t){this.set(LayerProperty.EXTENT,t)},r.prototype.setMaxResolution=function(t){this.set(LayerProperty.MAX_RESOLUTION,t)},r.prototype.setMinResolution=function(t){this.set(LayerProperty.MIN_RESOLUTION,t)},r.prototype.setMaxZoom=function(t){this.set(LayerProperty.MAX_ZOOM,t)},r.prototype.setMinZoom=function(t){this.set(LayerProperty.MIN_ZOOM,t)},r.prototype.setOpacity=function(t){assert(typeof t=="number",64),this.set(LayerProperty.OPACITY,t)},r.prototype.setVisible=function(t){this.set(LayerProperty.VISIBLE,t)},r.prototype.setZIndex=function(t){this.set(LayerProperty.Z_INDEX,t)},r.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),i.prototype.disposeInternal.call(this)},r}(BaseObject$1),BaseLayer$1=BaseLayer,RenderEventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},State={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},__extends$17=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Layer=function(i){__extends$17(r,i);function r(t){var e=this,n=assign({},t);delete n.source,e=i.call(this,n)||this,e.on,e.once,e.un,e.mapPrecomposeKey_=null,e.mapRenderKey_=null,e.sourceChangeKey_=null,e.renderer_=null,t.render&&(e.render=t.render),t.map&&e.setMap(t.map),e.addChangeListener(LayerProperty.SOURCE,e.handleSourcePropertyChange_);var o=t.source?t.source:null;return e.setSource(o),e}return r.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},r.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},r.prototype.getSource=function(){return this.get(LayerProperty.SOURCE)||null},r.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():State.UNDEFINED},r.prototype.handleSourceChange_=function(){this.changed()},r.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=listen(t,EventType.CHANGE,this.handleSourceChange_,this)),this.changed()},r.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(function(e){return e([])})},r.prototype.render=function(t,e){var n=this.getRenderer();if(n.prepareFrame(t))return n.renderFrame(t,e)},r.prototype.setMap=function(t){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=listen(t,RenderEventType.PRECOMPOSE,function(e){var n=e,o=n.frameState.layerStatesArray,a=this.getLayerState(!1);assert(!o.some(function(s){return s.layer===a.layer}),67),o.push(a)},this),this.mapRenderKey_=listen(this,EventType.CHANGE,t.render,t),this.changed())},r.prototype.setSource=function(t){this.set(LayerProperty.SOURCE,t)},r.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},r.prototype.hasRenderer=function(){return!!this.renderer_},r.prototype.createRenderer=function(){return null},r.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),i.prototype.disposeInternal.call(this)},r}(BaseLayer$1);function inView(i,r){if(!i.visible)return!1;var t=r.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;var e=r.zoom;return e>i.minZoom&&e<=i.maxZoom}var Layer$1=Layer;function add$2(i,r){return i[0]+=+r[0],i[1]+=+r[1],i}function equals(i,r){for(var t=!0,e=i.length-1;e>=0;--e)if(i[e]!=r[e]){t=!1;break}return t}function rotate$1(i,r){var t=Math.cos(r),e=Math.sin(r),n=i[0]*t-i[1]*e,o=i[1]*t+i[0]*e;return i[0]=n,i[1]=o,i}function scale$2(i,r){return i[0]*=r,i[1]*=r,i}function wrapX$1(i,r){if(r.canWrapX()){var t=getWidth(r.getExtent()),e=getWorldsAway(i,r,t);e&&(i[0]-=e*t)}return i}function getWorldsAway(i,r,t){var e=r.getExtent(),n=0;if(r.canWrapX()&&(i[0]<e[0]||i[0]>e[2])){var o=t||getWidth(e);n=Math.floor((i[0]-e[0])/o)}return n}var __extends$16=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),MapRenderer=function(i){__extends$16(r,i);function r(t){var e=i.call(this)||this;return e.map_=t,e}return r.prototype.dispatchRenderEvent=function(t,e){abstract()},r.prototype.calculateMatrices2D=function(t){var e=t.viewState,n=t.coordinateToPixelTransform,o=t.pixelToCoordinateTransform;compose(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),makeInverse(o,n)},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,o,a,s,l,u){var h,c=e.viewState;function f(A,M,w,G){return a.call(s,M,A?w:null,G)}var p=c.projection,d=wrapX$1(t.slice(),p),v=[[0,0]];if(p.canWrapX()&&o){var _=p.getExtent(),g=getWidth(_);v.push([-g,0],[g,0])}for(var y=e.layerStatesArray,m=y.length,E=[],T=[],I=0;I<v.length;I++)for(var R=m-1;R>=0;--R){var C=y[R],S=C.layer;if(S.hasRenderer()&&inView(C,c)&&l.call(u,S)){var L=S.getRenderer(),O=S.getSource();if(L&&O){var P=O.getWrapX()?d:t,D=f.bind(null,C.managed);T[0]=P[0]+v[I][0],T[1]=P[1]+v[I][1],h=L.forEachFeatureAtCoordinate(T,e,n,D,E)}if(h)return h}}if(E.length!==0){var N=1/E.length;return E.forEach(function(A,M){return A.distanceSq+=M*N}),E.sort(function(A,M){return A.distanceSq-M.distanceSq}),E.some(function(A){return h=A.callback(A.feature,A.layer,A.geometry)}),h}},r.prototype.forEachLayerAtPixel=function(t,e,n,o,a){return abstract()},r.prototype.hasFeatureAtCoordinate=function(t,e,n,o,a,s){var l=this.forEachFeatureAtCoordinate(t,e,n,o,TRUE,this,a,s);return l!==void 0},r.prototype.getMap=function(){return this.map_},r.prototype.renderFrame=function(t){abstract()},r.prototype.scheduleExpireIconCache=function(t){shared.canExpireCache()&&t.postRenderFunctions.push(expireIconCache)},r}(Disposable$1);function expireIconCache(i,r){shared.expire()}var MapRenderer$1=MapRenderer,__extends$15=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),RenderEvent=function(i){__extends$15(r,i);function r(t,e,n,o){var a=i.call(this,t)||this;return a.inversePixelTransform=e,a.frameState=n,a.context=o,a}return r}(BaseEvent$1),RenderEvent$1=RenderEvent,CLASS_HIDDEN="ol-hidden",CLASS_UNSELECTABLE="ol-unselectable",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],getFontParameters=function(i){var r=i.match(fontRegEx);if(!r)return null;for(var t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},e=0,n=fontRegExMatchIndex.length;e<n;++e){var o=r[e+1];o!==void 0&&(t[fontRegExMatchIndex[e]]=o)}return t.families=t.family.split(/,\s?/),t};function cssOpacity(i){return i===1?"":String(Math.round(i*100)/100)}function createCanvasContext2D(i,r,t,e){var n;return t&&t.length?n=t.shift():WORKER_OFFSCREEN_CANVAS?n=new OffscreenCanvas(i||300,r||300):(n=document.createElement("canvas"),n.style.all="unset"),i&&(n.width=i),r&&(n.height=r),n.getContext("2d",e)}function replaceNode(i,r){var t=r.parentNode;t&&t.replaceChild(i,r)}function removeNode(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function removeChildren(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function replaceChildren(i,r){for(var t=i.childNodes,e=0;;++e){var n=t[e],o=r[e];if(!n&&!o)break;if(n!==o){if(!n){i.appendChild(o);continue}if(!o){i.removeChild(n),--e;continue}i.insertBefore(o,n)}}}var defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new BaseObject$1,labelCache=new EventTarget;labelCache.setSize=function(){console.warn("labelCache is deprecated.")};var measureContext=null,measureFont,textHeights={},registerFont=function(){var i=100,r="32px ",t=["monospace","serif"],e=t.length,n="wmytzilWMYTZIL@#/&?$%10\uF013",o,a;function s(u,h,c){for(var f=!0,p=0;p<e;++p){var d=t[p];if(a=measureTextWidth(u+" "+h+" "+r+d,n),c!=d){var v=measureTextWidth(u+" "+h+" "+r+c+","+d,n);f=f&&v!=a}}return!!f}function l(){for(var u=!0,h=checkedFonts.getKeys(),c=0,f=h.length;c<f;++c){var p=h[c];checkedFonts.get(p)<i&&(s.apply(this,p.split(`
`))?(clear(textHeights),measureContext=null,measureFont=void 0,checkedFonts.set(p,i)):(checkedFonts.set(p,checkedFonts.get(p)+1,!0),u=!1))}u&&(clearInterval(o),o=void 0)}return function(u){var h=getFontParameters(u);if(!!h)for(var c=h.families,f=0,p=c.length;f<p;++f){var d=c[f],v=h.style+`
`+h.weight+`
`+d;checkedFonts.get(v)===void 0&&(checkedFonts.set(v,i,!0),s(h.style,h.weight,d)||(checkedFonts.set(v,0,!0),o===void 0&&(o=setInterval(l,32))))}}}(),measureTextHeight=function(){var i;return function(r){var t=textHeights[r];if(t==null){if(WORKER_OFFSCREEN_CANVAS){var e=getFontParameters(r),n=measureText(r,"\u017Dg"),o=isNaN(Number(e.lineHeight))?1.2:Number(e.lineHeight);t=o*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=r,document.body.appendChild(i),t=i.offsetHeight,document.body.removeChild(i);textHeights[r]=t}return t}}();function measureText(i,r){return measureContext||(measureContext=createCanvasContext2D(1,1)),i!=measureFont&&(measureContext.font=i,measureFont=measureContext.font),measureContext.measureText(r)}function measureTextWidth(i,r){return measureText(i,r).width}function measureAndCacheTextWidth(i,r,t){if(r in t)return t[r];var e=measureTextWidth(i,r);return t[r]=e,e}function measureTextWidths(i,r,t){for(var e=r.length,n=0,o=0;o<e;++o){var a=measureTextWidth(i,r[o]);n=Math.max(n,a),t.push(a)}return n}function drawImageOrLabel(i,r,t,e,n,o,a,s,l,u,h){i.save(),t!==1&&(i.globalAlpha*=t),r&&i.setTransform.apply(i,r),e.contextInstructions?(i.translate(l,u),i.scale(h[0],h[1]),executeLabelInstructions(e,i)):h[0]<0||h[1]<0?(i.translate(l,u),i.scale(h[0],h[1]),i.drawImage(e,n,o,a,s,0,0,a,s)):i.drawImage(e,n,o,a,s,l,u,a*h[0],s*h[1]),i.restore()}function executeLabelInstructions(i,r){for(var t=i.contextInstructions,e=0,n=t.length;e<n;e+=2)Array.isArray(t[e+1])?r[t[e]].apply(r,t[e+1]):r[t[e]]=t[e+1]}var __extends$14=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CompositeMapRenderer=function(i){__extends$14(r,i);function r(t){var e=i.call(this,t)||this;e.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,t.redrawText.bind(t)),e.element_=document.createElement("div");var n=e.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",e.element_.className=CLASS_UNSELECTABLE+" ol-layers";var o=t.getViewport();return o.insertBefore(e.element_,o.firstChild||null),e.children_=[],e.renderedVisible_=!0,e}return r.prototype.dispatchRenderEvent=function(t,e){var n=this.getMap();if(n.hasListener(t)){var o=new RenderEvent$1(t,void 0,e);n.dispatchEvent(o)}},r.prototype.disposeInternal=function(){unlistenByKey(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),i.prototype.disposeInternal.call(this)},r.prototype.renderFrame=function(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,t);var e=t.layerStatesArray.sort(function(f,p){return f.zIndex-p.zIndex}),n=t.viewState;this.children_.length=0;for(var o=[],a=null,s=0,l=e.length;s<l;++s){var u=e[s];if(t.layerIndex=s,!(!inView(u,n)||u.sourceState!=State.READY&&u.sourceState!=State.UNDEFINED)){var h=u.layer,c=h.render(t,a);!c||(c!==a&&(this.children_.push(c),a=c),"getDeclutter"in h&&o.push(h))}}for(var s=o.length-1;s>=0;--s)o[s].renderDeclutter(t);replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)},r.prototype.forEachLayerAtPixel=function(t,e,n,o,a){for(var s=e.viewState,l=e.layerStatesArray,u=l.length,h=u-1;h>=0;--h){var c=l[h],f=c.layer;if(f.hasRenderer()&&inView(c,s)&&a(f)){var p=f.getRenderer(),d=p.getDataAtPixel(t,e,n);if(d){var v=o(f,d);if(v)return v}}}},r}(MapRenderer$1),CompositeMapRenderer$1=CompositeMapRenderer,CollectionEventType={ADD:"add",REMOVE:"remove"},__extends$13=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Property$3={LENGTH:"length"},CollectionEvent=function(i){__extends$13(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.element=e,o.index=n,o}return r}(BaseEvent$1),Collection=function(i){__extends$13(r,i);function r(t,e){var n=i.call(this)||this;n.on,n.once,n.un;var o=e||{};if(n.unique_=!!o.unique,n.array_=t||[],n.unique_)for(var a=0,s=n.array_.length;a<s;++a)n.assertUnique_(n.array_[a],a);return n.updateLength_(),n}return r.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},r.prototype.extend=function(t){for(var e=0,n=t.length;e<n;++e)this.push(t[e]);return this},r.prototype.forEach=function(t){for(var e=this.array_,n=0,o=e.length;n<o;++n)t(e[n],n,e)},r.prototype.getArray=function(){return this.array_},r.prototype.item=function(t){return this.array_[t]},r.prototype.getLength=function(){return this.get(Property$3.LENGTH)},r.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,e,t))},r.prototype.pop=function(){return this.removeAt(this.getLength()-1)},r.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},r.prototype.remove=function(t){for(var e=this.array_,n=0,o=e.length;n<o;++n)if(e[n]===t)return this.removeAt(n)},r.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,e,t)),e},r.prototype.setAt=function(t,e){var n=this.getLength();if(t<n){this.unique_&&this.assertUnique_(e,t);var o=this.array_[t];this.array_[t]=e,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,o,t)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,e,t))}else{for(var a=n;a<t;++a)this.insertAt(a,void 0);this.insertAt(t,e)}},r.prototype.updateLength_=function(){this.set(Property$3.LENGTH,this.array_.length)},r.prototype.assertUnique_=function(t,e){for(var n=0,o=this.array_.length;n<o;++n)if(this.array_[n]===t&&n!==e)throw new AssertionError$1(58)},r}(BaseObject$1),Collection$1=Collection,__extends$12=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Property$2={LAYERS:"layers"},LayerGroup=function(i){__extends$12(r,i);function r(t){var e=this,n=t||{},o=assign({},n);delete o.layers;var a=n.layers;return e=i.call(this,o)||this,e.on,e.once,e.un,e.layersListenerKeys_=[],e.listenerKeys_={},e.addChangeListener(Property$2.LAYERS,e.handleLayersChanged_),a?Array.isArray(a)?a=new Collection$1(a.slice(),{unique:!0}):assert(typeof a.getArray=="function",43):a=new Collection$1(void 0,{unique:!0}),e.setLayers(a),e}return r.prototype.handleLayerChange_=function(){this.changed()},r.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;var t=this.getLayers();this.layersListenerKeys_.push(listen(t,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(t,CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(var e in this.listenerKeys_)this.listenerKeys_[e].forEach(unlistenByKey);clear(this.listenerKeys_);for(var n=t.getArray(),o=0,a=n.length;o<a;o++){var s=n[o];this.listenerKeys_[getUid(s)]=[listen(s,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(s,EventType.CHANGE,this.handleLayerChange_,this)]}this.changed()},r.prototype.handleLayersAdd_=function(t){var e=t.element;this.listenerKeys_[getUid(e)]=[listen(e,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(e,EventType.CHANGE,this.handleLayerChange_,this)],this.changed()},r.prototype.handleLayersRemove_=function(t){var e=t.element,n=getUid(e);this.listenerKeys_[n].forEach(unlistenByKey),delete this.listenerKeys_[n],this.changed()},r.prototype.getLayers=function(){return this.get(Property$2.LAYERS)},r.prototype.setLayers=function(t){this.set(Property$2.LAYERS,t)},r.prototype.getLayersArray=function(t){var e=t!==void 0?t:[];return this.getLayers().forEach(function(n){n.getLayersArray(e)}),e},r.prototype.getLayerStatesArray=function(t){var e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(h){h.getLayerStatesArray(e)});var o=this.getLayerState(),a=o.zIndex;!t&&o.zIndex===void 0&&(a=0);for(var s=n,l=e.length;s<l;s++){var u=e[s];u.opacity*=o.opacity,u.visible=u.visible&&o.visible,u.maxResolution=Math.min(u.maxResolution,o.maxResolution),u.minResolution=Math.max(u.minResolution,o.minResolution),u.minZoom=Math.max(u.minZoom,o.minZoom),u.maxZoom=Math.min(u.maxZoom,o.maxZoom),o.extent!==void 0&&(u.extent!==void 0?u.extent=getIntersection(u.extent,o.extent):u.extent=o.extent),u.zIndex===void 0&&(u.zIndex=a)}return e},r.prototype.getSourceState=function(){return State.READY},r}(BaseLayer$1),LayerGroup$1=LayerGroup,__extends$11=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),MapEvent=function(i){__extends$11(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.map=e,o.frameState=n!==void 0?n:null,o}return r}(BaseEvent$1),MapEvent$1=MapEvent,__extends$10=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),MapBrowserEvent=function(i){__extends$10(r,i);function r(t,e,n,o,a){var s=i.call(this,t,e,a)||this;return s.originalEvent=n,s.pixel_=null,s.coordinate_=null,s.dragging=o!==void 0?o:!1,s}return Object.defineProperty(r.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),r.prototype.preventDefault=function(){i.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){i.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},r}(MapEvent$1),MapBrowserEvent$1=MapBrowserEvent,MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},__extends$$=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),MapBrowserEventHandler=function(i){__extends$$(r,i);function r(t,e){var n=i.call(this,t)||this;n.map_=t,n.clickTimeoutId_,n.emulateClicks_=!1,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=e===void 0?1:e,n.down_=null;var o=n.map_.getViewport();return n.activePointers_=0,n.trackedTouches_={},n.element_=o,n.pointerdownListenerKey_=listen(o,PointerEventType.POINTERDOWN,n.handlePointerDown_,n),n.originalPointerMoveEvent_,n.relayedListenerKey_=listen(o,PointerEventType.POINTERMOVE,n.relayEvent_,n),n.boundHandleTouchMove_=n.handleTouchMove_.bind(n),n.element_.addEventListener(EventType.TOUCHMOVE,n.boundHandleTouchMove_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1),n}return r.prototype.emulateClick_=function(t){var e=new MapBrowserEvent$1(MapBrowserEventType.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new MapBrowserEvent$1(MapBrowserEventType.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var n=new MapBrowserEvent$1(MapBrowserEventType.SINGLECLICK,this.map_,t);this.dispatchEvent(n)}.bind(this),250)},r.prototype.updateActivePointers_=function(t){var e=t;e.type==MapBrowserEventType.POINTERUP||e.type==MapBrowserEventType.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==MapBrowserEventType.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},r.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new MapBrowserEvent$1(MapBrowserEventType.POINTERUP,this.map_,t);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_===0&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},r.prototype.isMouseActionButton_=function(t){return t.button===0},r.prototype.handlePointerDown_=function(t){this.emulateClicks_=this.activePointers_===0,this.updateActivePointers_(t);var e=new MapBrowserEvent$1(MapBrowserEventType.POINTERDOWN,this.map_,t);this.dispatchEvent(e),this.down_={};for(var n in t){var o=t[n];this.down_[n]=typeof o=="function"?VOID:o}if(this.dragListenerKeys_.length===0){var a=this.map_.getOwnerDocument();this.dragListenerKeys_.push(listen(a,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(a,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==a&&this.dragListenerKeys_.push(listen(this.element_.getRootNode(),MapBrowserEventType.POINTERUP,this.handlePointerUp_,this))}},r.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new MapBrowserEvent$1(MapBrowserEventType.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}},r.prototype.relayEvent_=function(t){this.originalPointerMoveEvent_=t;var e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new MapBrowserEvent$1(t.type,this.map_,t,e))},r.prototype.handleTouchMove_=function(t){var e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()},r.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},r.prototype.disposeInternal=function(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,i.prototype.disposeInternal.call(this)},r}(EventTarget),MapBrowserEventHandler$1=MapBrowserEventHandler,MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},DROP=1/0,PriorityQueue=function(){function i(r,t){this.priorityFunction_=r,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return i.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,clear(this.queuedElements_)},i.prototype.dequeue=function(){var r=this.elements_,t=this.priorities_,e=r[0];r.length==1?(r.length=0,t.length=0):(r[0]=r.pop(),t[0]=t.pop(),this.siftUp_(0));var n=this.keyFunction_(e);return delete this.queuedElements_[n],e},i.prototype.enqueue=function(r){assert(!(this.keyFunction_(r)in this.queuedElements_),31);var t=this.priorityFunction_(r);return t!=DROP?(this.elements_.push(r),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(r)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1},i.prototype.getCount=function(){return this.elements_.length},i.prototype.getLeftChildIndex_=function(r){return r*2+1},i.prototype.getRightChildIndex_=function(r){return r*2+2},i.prototype.getParentIndex_=function(r){return r-1>>1},i.prototype.heapify_=function(){var r;for(r=(this.elements_.length>>1)-1;r>=0;r--)this.siftUp_(r)},i.prototype.isEmpty=function(){return this.elements_.length===0},i.prototype.isKeyQueued=function(r){return r in this.queuedElements_},i.prototype.isQueued=function(r){return this.isKeyQueued(this.keyFunction_(r))},i.prototype.siftUp_=function(r){for(var t=this.elements_,e=this.priorities_,n=t.length,o=t[r],a=e[r],s=r;r<n>>1;){var l=this.getLeftChildIndex_(r),u=this.getRightChildIndex_(r),h=u<n&&e[u]<e[l]?u:l;t[r]=t[h],e[r]=e[h],r=h}t[r]=o,e[r]=a,this.siftDown_(s,r)},i.prototype.siftDown_=function(r,t){for(var e=this.elements_,n=this.priorities_,o=e[t],a=n[t];t>r;){var s=this.getParentIndex_(t);if(n[s]>a)e[t]=e[s],n[t]=n[s],t=s;else break}e[t]=o,n[t]=a},i.prototype.reprioritize=function(){var r=this.priorityFunction_,t=this.elements_,e=this.priorities_,n=0,o=t.length,a,s,l;for(s=0;s<o;++s)a=t[s],l=r(a),l==DROP?delete this.queuedElements_[this.keyFunction_(a)]:(e[n]=l,t[n++]=a);t.length=n,e.length=n,this.heapify_()},i}(),PriorityQueue$1=PriorityQueue,TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},__extends$_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),TileQueue=function(i){__extends$_(r,i);function r(t,e){var n=i.call(this,function(o){return t.apply(null,o)},function(o){return o[0].getKey()})||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=e,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return r.prototype.enqueue=function(t){var e=i.prototype.enqueue.call(this,t);if(e){var n=t[0];n.addEventListener(EventType.CHANGE,this.boundHandleTileChange_)}return e},r.prototype.getTilesLoading=function(){return this.tilesLoading_},r.prototype.handleTileChange=function(t){var e=t.target,n=e.getState();if(n===TileState.LOADED||n===TileState.ERROR||n===TileState.EMPTY){e.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_);var o=e.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}},r.prototype.loadMoreTiles=function(t,e){for(var n=0,o,a,s;this.tilesLoading_<t&&n<e&&this.getCount()>0;)a=this.dequeue()[0],s=a.getKey(),o=a.getState(),o===TileState.IDLE&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++n,a.load())},r}(PriorityQueue$1),TileQueue$1=TileQueue;function getTilePriority(i,r,t,e,n){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][r.getKey()])return DROP;var o=i.viewState.center,a=e[0]-o[0],s=e[1]-o[1];return 65536*Math.log(n)+Math.sqrt(a*a+s*s)/n}var GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Units={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},METERS_PER_UNIT$1={};METERS_PER_UNIT$1[Units.RADIANS]=6370997/(2*Math.PI);METERS_PER_UNIT$1[Units.DEGREES]=2*Math.PI*6370997/360;METERS_PER_UNIT$1[Units.FEET]=.3048;METERS_PER_UNIT$1[Units.METERS]=1;METERS_PER_UNIT$1[Units.USFEET]=1200/3937;var Units$1=Units,ViewHint={ANIMATING:0,INTERACTING:1},ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256,Projection=function(){function i(r){this.code_=r.code,this.units_=r.units,this.extent_=r.extent!==void 0?r.extent:null,this.worldExtent_=r.worldExtent!==void 0?r.worldExtent:null,this.axisOrientation_=r.axisOrientation!==void 0?r.axisOrientation:"enu",this.global_=r.global!==void 0?r.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=r.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=r.metersPerUnit}return i.prototype.canWrapX=function(){return this.canWrapX_},i.prototype.getCode=function(){return this.code_},i.prototype.getExtent=function(){return this.extent_},i.prototype.getUnits=function(){return this.units_},i.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||METERS_PER_UNIT$1[this.units_]},i.prototype.getWorldExtent=function(){return this.worldExtent_},i.prototype.getAxisOrientation=function(){return this.axisOrientation_},i.prototype.isGlobal=function(){return this.global_},i.prototype.setGlobal=function(r){this.global_=r,this.canWrapX_=!!(r&&this.extent_)},i.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},i.prototype.setDefaultTileGrid=function(r){this.defaultTileGrid_=r},i.prototype.setExtent=function(r){this.extent_=r,this.canWrapX_=!!(this.global_&&r)},i.prototype.setWorldExtent=function(r){this.worldExtent_=r},i.prototype.setGetPointResolution=function(r){this.getPointResolutionFunc_=r},i.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},i}(),Projection$1=Projection,__extends$Z=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),RADIUS$1=6378137,HALF_SIZE=Math.PI*RADIUS$1,EXTENT$1=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],MAX_SAFE_Y=RADIUS$1*Math.log(Math.tan(Math.PI/2)),EPSG3857Projection=function(i){__extends$Z(r,i);function r(t){return i.call(this,{code:t,units:Units$1.METERS,extent:EXTENT$1,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(e,n){return e/cosh(n[1]/RADIUS$1)}})||this}return r}(Projection$1),PROJECTIONS$1=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("http://www.opengis.net/def/crs/EPSG/0/3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(i,r,t){var e=i.length,n=t>1?t:2,o=r;o===void 0&&(n>2?o=i.slice():o=new Array(e));for(var a=0;a<e;a+=n){o[a]=HALF_SIZE*i[a]/180;var s=RADIUS$1*Math.log(Math.tan(Math.PI*(+i[a+1]+90)/360));s>MAX_SAFE_Y?s=MAX_SAFE_Y:s<-MAX_SAFE_Y&&(s=-MAX_SAFE_Y),o[a+1]=s}return o}function toEPSG4326(i,r,t){var e=i.length,n=t>1?t:2,o=r;o===void 0&&(n>2?o=i.slice():o=new Array(e));for(var a=0;a<e;a+=n)o[a]=180*i[a]/HALF_SIZE,o[a+1]=360*Math.atan(Math.exp(i[a+1]/RADIUS$1))/Math.PI-90;return o}var __extends$Y=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),RADIUS=6378137,EXTENT=[-180,-90,180,90],METERS_PER_UNIT=Math.PI*RADIUS/180,EPSG4326Projection=function(i){__extends$Y(r,i);function r(t,e){return i.call(this,{code:t,units:Units$1.DEGREES,extent:EXTENT,axisOrientation:e,global:!0,metersPerUnit:METERS_PER_UNIT,worldExtent:EXTENT})||this}return r}(Projection$1),PROJECTIONS=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/def/crs/OGC/1.3/CRS84","neu"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],cache={};function get$3(i){return cache[i]||cache[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function add$1(i,r){cache[i]=r}var transforms={};function add(i,r,t){var e=i.getCode(),n=r.getCode();e in transforms||(transforms[e]={}),transforms[e][n]=t}function get$2(i,r){var t;return i in transforms&&r in transforms[i]&&(t=transforms[i][r]),t}var DEFAULT_RADIUS=63710088e-1;function getDistance(i,r,t){var e=t||DEFAULT_RADIUS,n=toRadians(i[1]),o=toRadians(r[1]),a=(o-n)/2,s=toRadians(r[0]-i[0])/2,l=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(o);return 2*e*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function cloneTransform(i,r,t){var e;if(r!==void 0){for(var n=0,o=i.length;n<o;++n)r[n]=i[n];e=r}else e=i.slice();return e}function identityTransform(i,r,t){if(r!==void 0&&i!==r){for(var e=0,n=i.length;e<n;++e)r[e]=i[e];i=r}return i}function addProjection(i){add$1(i.getCode(),i),add(i,i,cloneTransform)}function addProjections(i){i.forEach(addProjection)}function get$1(i){return typeof i=="string"?get$3(i):i||null}function getPointResolution(i,r,t,e){i=get$1(i);var n,o=i.getPointResolutionFunc();if(o){if(n=o(r,t),e&&e!==i.getUnits()){var a=i.getMetersPerUnit();a&&(n=n*a/METERS_PER_UNIT$1[e])}}else{var s=i.getUnits();if(s==Units$1.DEGREES&&!e||e==Units$1.DEGREES)n=r;else{var l=getTransformFromProjections(i,get$1("EPSG:4326"));if(l===identityTransform&&s!==Units$1.DEGREES)n=r*i.getMetersPerUnit();else{var u=[t[0]-r/2,t[1],t[0]+r/2,t[1],t[0],t[1]-r/2,t[0],t[1]+r/2];u=l(u,u,2);var h=getDistance(u.slice(0,2),u.slice(2,4)),c=getDistance(u.slice(4,6),u.slice(6,8));n=(h+c)/2}var a=e?METERS_PER_UNIT$1[e]:i.getMetersPerUnit();a!==void 0&&(n/=a)}}return n}function addEquivalentProjections(i){addProjections(i),i.forEach(function(r){i.forEach(function(t){r!==t&&add(r,t,cloneTransform)})})}function addEquivalentTransforms(i,r,t,e){i.forEach(function(n){r.forEach(function(o){add(n,o,t),add(o,n,e)})})}function createProjection(i,r){return i?typeof i=="string"?get$1(i):i:get$1(r)}function equivalent(i,r){if(i===r)return!0;var t=i.getUnits()===r.getUnits();if(i.getCode()===r.getCode())return t;var e=getTransformFromProjections(i,r);return e===cloneTransform&&t}function getTransformFromProjections(i,r){var t=i.getCode(),e=r.getCode(),n=get$2(t,e);return n||(n=identityTransform),n}function getTransform(i,r){var t=get$1(i),e=get$1(r);return getTransformFromProjections(t,e)}function transform(i,r,t){var e=getTransform(r,t);return e(i,void 0,i.length)}var userProjection=null;function getUserProjection(){return userProjection}function toUserCoordinate(i,r){return i}function fromUserCoordinate(i,r){return i}function toUserExtent(i,r){return i}function fromUserExtent(i,r){return i}function addCommon(){addEquivalentProjections(PROJECTIONS$1),addEquivalentProjections(PROJECTIONS),addEquivalentTransforms(PROJECTIONS,PROJECTIONS$1,fromEPSG4326,toEPSG4326)}addCommon();function createExtent(i,r,t){return function(e,n,o,a,s){if(e){var l=r?0:o[0]*n,u=r?0:o[1]*n,h=s?s[0]:0,c=s?s[1]:0,f=i[0]+l/2+h,p=i[2]-l/2+h,d=i[1]+u/2+c,v=i[3]-u/2+c;f>p&&(f=(p+f)/2,p=f),d>v&&(d=(v+d)/2,v=d);var _=clamp(e[0],f,p),g=clamp(e[1],d,v),y=30*n;return a&&t&&(_+=-y*Math.log(1+Math.max(0,f-e[0])/y)+y*Math.log(1+Math.max(0,e[0]-p)/y),g+=-y*Math.log(1+Math.max(0,d-e[1])/y)+y*Math.log(1+Math.max(0,e[1]-v)/y)),[_,g]}else return}}function none$1(i){return i}function getViewportClampedResolution(i,r,t,e){var n=getWidth(r)/t[0],o=getHeight(r)/t[1];return e?Math.min(i,Math.max(n,o)):Math.min(i,Math.min(n,o))}function getSmoothClampedResolution(i,r,t){var e=Math.min(i,r),n=50;return e*=Math.log(1+n*Math.max(0,i/r-1))/n+1,t&&(e=Math.max(e,t),e/=Math.log(1+n*Math.max(0,t/i-1))/n+1),clamp(e,t/2,r*2)}function createSnapToResolutions(i,r,t,e){return function(n,o,a,s){if(n!==void 0){var l=i[0],u=i[i.length-1],h=t?getViewportClampedResolution(l,t,a,e):l;if(s){var c=r!==void 0?r:!0;return c?getSmoothClampedResolution(n,h,u):clamp(n,u,h)}var f=Math.min(h,n),p=Math.floor(linearFindNearest(i,f,o));return i[p]>h&&p<i.length-1?i[p+1]:i[p]}else return}}function createSnapToPower(i,r,t,e,n,o){return function(a,s,l,u){if(a!==void 0){var h=n?getViewportClampedResolution(r,n,l,o):r,c=t!==void 0?t:0;if(u){var f=e!==void 0?e:!0;return f?getSmoothClampedResolution(a,h,c):clamp(a,c,h)}var p=1e-9,d=Math.ceil(Math.log(r/h)/Math.log(i)-p),v=-s*(.5-p)+.5,_=Math.min(h,a),g=Math.floor(Math.log(r/_)/Math.log(i)+v),y=Math.max(d,g),m=r/Math.pow(i,y);return clamp(m,c,h)}else return}}function createMinMaxResolution(i,r,t,e,n){return function(o,a,s,l){if(o!==void 0){var u=e?getViewportClampedResolution(i,e,s,n):i,h=t!==void 0?t:!0;return!h||!l?clamp(o,r,u):getSmoothClampedResolution(o,u,r)}else return}}function disable(i){if(i!==void 0)return 0}function none(i){if(i!==void 0)return i}function createSnapToN(i){var r=2*Math.PI/i;return function(t,e){if(e)return t;if(t!==void 0)return t=Math.floor(t/r+.5)*r,t}}function createSnapToZero(i){var r=i||toRadians(5);return function(t,e){if(e)return t;if(t!==void 0)return Math.abs(t)<=r?0:t}}function easeIn(i){return Math.pow(i,3)}function easeOut(i){return 1-easeIn(1-i)}function inAndOut(i){return 3*i*i-2*i*i*i}function linear(i){return i}var GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function transform2D(i,r,t,e,n,o){for(var a=o||[],s=0,l=r;l<t;l+=e){var u=i[l],h=i[l+1];a[s++]=n[0]*u+n[2]*h+n[4],a[s++]=n[1]*u+n[3]*h+n[5]}return o&&a.length!=s&&(a.length=s),a}function rotate(i,r,t,e,n,o,a){for(var s=a||[],l=Math.cos(n),u=Math.sin(n),h=o[0],c=o[1],f=0,p=r;p<t;p+=e){var d=i[p]-h,v=i[p+1]-c;s[f++]=h+d*l-v*u,s[f++]=c+d*u+v*l;for(var _=p+2;_<p+e;++_)s[f++]=i[_]}return a&&s.length!=f&&(s.length=f),s}function scale$1(i,r,t,e,n,o,a,s){for(var l=s||[],u=a[0],h=a[1],c=0,f=r;f<t;f+=e){var p=i[f]-u,d=i[f+1]-h;l[c++]=u+n*p,l[c++]=h+o*d;for(var v=f+2;v<f+e;++v)l[c++]=i[v]}return s&&l.length!=c&&(l.length=c),l}function translate(i,r,t,e,n,o,a){for(var s=a||[],l=0,u=r;u<t;u+=e){s[l++]=i[u]+n,s[l++]=i[u+1]+o;for(var h=u+2;h<u+e;++h)s[l++]=i[h]}return a&&s.length!=l&&(s.length=l),s}var __extends$X=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),tmpTransform=create$2(),Geometry=function(i){__extends$X(r,i);function r(){var t=i.call(this)||this;return t.extent_=createEmpty(),t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=memoizeOne(function(e,n,o){if(!o)return this.getSimplifiedGeometry(n);var a=this.clone();return a.applyTransform(o),a.getSimplifiedGeometry(n)}),t}return r.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},r.prototype.clone=function(){return abstract()},r.prototype.closestPointXY=function(t,e,n,o){return abstract()},r.prototype.containsXY=function(t,e){var n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e},r.prototype.getClosestPoint=function(t,e){var n=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],n,1/0),n},r.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},r.prototype.computeExtent=function(t){return abstract()},r.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&createOrUpdateEmpty(e),this.extentRevision_=this.getRevision()}return returnOrUpdate(this.extent_,t)},r.prototype.rotate=function(t,e){abstract()},r.prototype.scale=function(t,e,n){abstract()},r.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},r.prototype.getSimplifiedGeometry=function(t){return abstract()},r.prototype.getType=function(){return abstract()},r.prototype.applyTransform=function(t){abstract()},r.prototype.intersectsExtent=function(t){return abstract()},r.prototype.translate=function(t,e){abstract()},r.prototype.transform=function(t,e){var n=get$1(t),o=n.getUnits()==Units$1.TILE_PIXELS?function(a,s,l){var u=n.getExtent(),h=n.getWorldExtent(),c=getHeight(h)/getHeight(u);return compose(tmpTransform,h[0],h[3],c,-c,0,0,0),transform2D(a,0,a.length,l,tmpTransform,s),getTransform(n,e)(a,s,l)}:getTransform(n,e);return this.applyTransform(o),this},r}(BaseObject$1),Geometry$1=Geometry,__extends$W=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),SimpleGeometry=function(i){__extends$W(r,i);function r(){var t=i.call(this)||this;return t.layout=GeometryLayout.XY,t.stride=2,t.flatCoordinates=null,t}return r.prototype.computeExtent=function(t){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},r.prototype.getCoordinates=function(){return abstract()},r.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},r.prototype.getFlatCoordinates=function(){return this.flatCoordinates},r.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},r.prototype.getLayout=function(){return this.layout},r.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t),n=e.getFlatCoordinates();return n.length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},r.prototype.getSimplifiedGeometryInternal=function(t){return this},r.prototype.getStride=function(){return this.stride},r.prototype.setFlatCoordinates=function(t,e){this.stride=getStrideForLayout(t),this.layout=t,this.flatCoordinates=e},r.prototype.setCoordinates=function(t,e){abstract()},r.prototype.setLayout=function(t,e,n){var o;if(t)o=getStrideForLayout(t);else{for(var a=0;a<n;++a)if(e.length===0){this.layout=GeometryLayout.XY,this.stride=2;return}else e=e[0];o=e.length,t=getLayoutForStride(o)}this.layout=t,this.stride=o},r.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},r.prototype.rotate=function(t,e){var n=this.getFlatCoordinates();if(n){var o=this.getStride();rotate(n,0,n.length,o,t,e,n),this.changed()}},r.prototype.scale=function(t,e,n){var o=e;o===void 0&&(o=t);var a=n;a||(a=getCenter(this.getExtent()));var s=this.getFlatCoordinates();if(s){var l=this.getStride();scale$1(s,0,s.length,l,t,o,a,s),this.changed()}},r.prototype.translate=function(t,e){var n=this.getFlatCoordinates();if(n){var o=this.getStride();translate(n,0,n.length,o,t,e,n),this.changed()}},r}(Geometry$1);function getLayoutForStride(i){var r;return i==2?r=GeometryLayout.XY:i==3?r=GeometryLayout.XYZ:i==4&&(r=GeometryLayout.XYZM),r}function getStrideForLayout(i){var r;return i==GeometryLayout.XY?r=2:i==GeometryLayout.XYZ||i==GeometryLayout.XYM?r=3:i==GeometryLayout.XYZM&&(r=4),r}function transformGeom2D(i,r,t){var e=i.getFlatCoordinates();if(e){var n=i.getStride();return transform2D(e,0,e.length,n,r,t)}else return null}var SimpleGeometry$1=SimpleGeometry;function assignClosest(i,r,t,e,n,o,a){var s=i[r],l=i[r+1],u=i[t]-s,h=i[t+1]-l,c;if(u===0&&h===0)c=r;else{var f=((n-s)*u+(o-l)*h)/(u*u+h*h);if(f>1)c=t;else if(f>0){for(var p=0;p<e;++p)a[p]=lerp(i[r+p],i[t+p],f);a.length=e;return}else c=r}for(var p=0;p<e;++p)a[p]=i[c+p];a.length=e}function maxSquaredDelta(i,r,t,e,n){var o=i[r],a=i[r+1];for(r+=e;r<t;r+=e){var s=i[r],l=i[r+1],u=squaredDistance(o,a,s,l);u>n&&(n=u),o=s,a=l}return n}function arrayMaxSquaredDelta(i,r,t,e,n){for(var o=0,a=t.length;o<a;++o){var s=t[o];n=maxSquaredDelta(i,r,s,e,n),r=s}return n}function assignClosestPoint(i,r,t,e,n,o,a,s,l,u,h){if(r==t)return u;var c,f;if(n===0)if(f=squaredDistance(a,s,i[r],i[r+1]),f<u){for(c=0;c<e;++c)l[c]=i[r+c];return l.length=e,f}else return u;for(var p=h||[NaN,NaN],d=r+e;d<t;)if(assignClosest(i,d-e,d,e,a,s,p),f=squaredDistance(a,s,p[0],p[1]),f<u){for(u=f,c=0;c<e;++c)l[c]=p[c];l.length=e,d+=e}else d+=e*Math.max((Math.sqrt(f)-Math.sqrt(u))/n|0,1);if(o&&(assignClosest(i,t-e,r,e,a,s,p),f=squaredDistance(a,s,p[0],p[1]),f<u)){for(u=f,c=0;c<e;++c)l[c]=p[c];l.length=e}return u}function assignClosestArrayPoint(i,r,t,e,n,o,a,s,l,u,h){for(var c=h||[NaN,NaN],f=0,p=t.length;f<p;++f){var d=t[f];u=assignClosestPoint(i,r,d,e,n,o,a,s,l,u,c),r=d}return u}function deflateCoordinate(i,r,t,e){for(var n=0,o=t.length;n<o;++n)i[r++]=t[n];return r}function deflateCoordinates(i,r,t,e){for(var n=0,o=t.length;n<o;++n)for(var a=t[n],s=0;s<e;++s)i[r++]=a[s];return r}function deflateCoordinatesArray(i,r,t,e,n){for(var o=n||[],a=0,s=0,l=t.length;s<l;++s){var u=deflateCoordinates(i,r,t[s],e);o[a++]=u,r=u}return o.length=a,o}function douglasPeucker(i,r,t,e,n,o,a){var s=(t-r)/e;if(s<3){for(;r<t;r+=e)o[a++]=i[r],o[a++]=i[r+1];return a}var l=new Array(s);l[0]=1,l[s-1]=1;for(var u=[r,t-e],h=0;u.length>0;){for(var c=u.pop(),f=u.pop(),p=0,d=i[f],v=i[f+1],_=i[c],g=i[c+1],y=f+e;y<c;y+=e){var m=i[y],E=i[y+1],T=squaredSegmentDistance(m,E,d,v,_,g);T>p&&(h=y,p=T)}p>n&&(l[(h-r)/e]=1,f+e<h&&u.push(f,h),h+e<c&&u.push(h,c))}for(var y=0;y<s;++y)l[y]&&(o[a++]=i[r+y*e],o[a++]=i[r+y*e+1]);return a}function snap(i,r){return r*Math.round(i/r)}function quantize(i,r,t,e,n,o,a){if(r==t)return a;var s=snap(i[r],n),l=snap(i[r+1],n);r+=e,o[a++]=s,o[a++]=l;var u,h;do if(u=snap(i[r],n),h=snap(i[r+1],n),r+=e,r==t)return o[a++]=u,o[a++]=h,a;while(u==s&&h==l);for(;r<t;){var c=snap(i[r],n),f=snap(i[r+1],n);if(r+=e,!(c==u&&f==h)){var p=u-s,d=h-l,v=c-s,_=f-l;if(p*_==d*v&&(p<0&&v<p||p==v||p>0&&v>p)&&(d<0&&_<d||d==_||d>0&&_>d)){u=c,h=f;continue}o[a++]=u,o[a++]=h,s=u,l=h,u=c,h=f}}return o[a++]=u,o[a++]=h,a}function quantizeArray(i,r,t,e,n,o,a,s){for(var l=0,u=t.length;l<u;++l){var h=t[l];a=quantize(i,r,h,e,n,o,a),s.push(a),r=h}return a}function inflateCoordinates(i,r,t,e,n){for(var o=n!==void 0?n:[],a=0,s=r;s<t;s+=e)o[a++]=i.slice(s,s+e);return o.length=a,o}function inflateCoordinatesArray(i,r,t,e,n){for(var o=n!==void 0?n:[],a=0,s=0,l=t.length;s<l;++s){var u=t[s];o[a++]=inflateCoordinates(i,r,u,e,o[a]),r=u}return o.length=a,o}function inflateMultiCoordinatesArray(i,r,t,e,n){for(var o=n!==void 0?n:[],a=0,s=0,l=t.length;s<l;++s){var u=t[s];o[a++]=inflateCoordinatesArray(i,r,u,e,o[a]),r=u[u.length-1]}return o.length=a,o}function linearRing(i,r,t,e){for(var n=0,o=i[t-e],a=i[t-e+1];r<t;r+=e){var s=i[r],l=i[r+1];n+=a*s-o*l,o=s,a=l}return n/2}function linearRings(i,r,t,e){for(var n=0,o=0,a=t.length;o<a;++o){var s=t[o];n+=linearRing(i,r,s,e),r=s}return n}var __extends$V=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),LinearRing=function(i){__extends$V(r,i);function r(t,e){var n=i.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?n.setFlatCoordinates(e,t):n.setCoordinates(t,e),n}return r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout)},r.prototype.closestPointXY=function(t,e,n,o){return o<closestSquaredDistanceXY(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,o))},r.prototype.getArea=function(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];return e.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new r(e,GeometryLayout.XY)},r.prototype.getType=function(){return GeometryType.LINEAR_RING},r.prototype.intersectsExtent=function(t){return!1},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,t,this.stride),this.changed()},r}(SimpleGeometry$1),LinearRing$1=LinearRing,__extends$U=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Point=function(i){__extends$U(r,i);function r(t,e){var n=i.call(this)||this;return n.setCoordinates(t,e),n}return r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){var a=this.flatCoordinates,s=squaredDistance(t,e,a[0],a[1]);if(s<o){for(var l=this.stride,u=0;u<l;++u)n[u]=a[u];return n.length=l,s}else return o},r.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},r.prototype.computeExtent=function(t){return createOrUpdateFromCoordinate(this.flatCoordinates,t)},r.prototype.getType=function(){return GeometryType.POINT},r.prototype.intersectsExtent=function(t){return containsXY(t,this.flatCoordinates[0],this.flatCoordinates[1])},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,t,this.stride),this.changed()},r}(SimpleGeometry$1),point=Point;function linearRingContainsExtent(i,r,t,e,n){var o=forEachCorner(n,function(a){return!linearRingContainsXY(i,r,t,e,a[0],a[1])});return!o}function linearRingContainsXY(i,r,t,e,n,o){for(var a=0,s=i[t-e],l=i[t-e+1];r<t;r+=e){var u=i[r],h=i[r+1];l<=o?h>o&&(u-s)*(o-l)-(n-s)*(h-l)>0&&a++:h<=o&&(u-s)*(o-l)-(n-s)*(h-l)<0&&a--,s=u,l=h}return a!==0}function linearRingsContainsXY(i,r,t,e,n,o){if(t.length===0||!linearRingContainsXY(i,r,t[0],e,n,o))return!1;for(var a=1,s=t.length;a<s;++a)if(linearRingContainsXY(i,t[a-1],t[a],e,n,o))return!1;return!0}function getInteriorPointOfArray(i,r,t,e,n,o,a){for(var s,l,u,h,c,f,p,d=n[o+1],v=[],_=0,g=t.length;_<g;++_){var y=t[_];for(h=i[y-e],f=i[y-e+1],s=r;s<y;s+=e)c=i[s],p=i[s+1],(d<=f&&p<=d||f<=d&&d<=p)&&(u=(d-f)/(p-f)*(c-h)+h,v.push(u)),h=c,f=p}var m=NaN,E=-1/0;for(v.sort(numberSafeCompareFunction),h=v[0],s=1,l=v.length;s<l;++s){c=v[s];var T=Math.abs(c-h);T>E&&(u=(h+c)/2,linearRingsContainsXY(i,r,t,e,u,d)&&(m=u,E=T)),h=c}return isNaN(m)&&(m=n[o]),a?(a.push(m,d,E),a):[m,d,E]}function forEach(i,r,t,e,n){var o;for(r+=e;r<t;r+=e)if(o=n(i.slice(r-e,r),i.slice(r,r+e)),o)return o;return!1}function intersectsLineString(i,r,t,e,n){var o=extendFlatCoordinates(createEmpty(),i,r,t,e);return intersects$1(n,o)?containsExtent(n,o)||o[0]>=n[0]&&o[2]<=n[2]||o[1]>=n[1]&&o[3]<=n[3]?!0:forEach(i,r,t,e,function(a,s){return intersectsSegment(n,a,s)}):!1}function intersectsLinearRing(i,r,t,e,n){return!!(intersectsLineString(i,r,t,e,n)||linearRingContainsXY(i,r,t,e,n[0],n[1])||linearRingContainsXY(i,r,t,e,n[0],n[3])||linearRingContainsXY(i,r,t,e,n[2],n[1])||linearRingContainsXY(i,r,t,e,n[2],n[3]))}function intersectsLinearRingArray(i,r,t,e,n){if(!intersectsLinearRing(i,r,t[0],e,n))return!1;if(t.length===1)return!0;for(var o=1,a=t.length;o<a;++o)if(linearRingContainsExtent(i,t[o-1],t[o],e,n)&&!intersectsLineString(i,t[o-1],t[o],e,n))return!1;return!0}function coordinates(i,r,t,e){for(;r<t-e;){for(var n=0;n<e;++n){var o=i[r+n];i[r+n]=i[t-e+n],i[t-e+n]=o}r+=e,t-=e}}function linearRingIsClockwise(i,r,t,e){for(var n=0,o=i[t-e],a=i[t-e+1];r<t;r+=e){var s=i[r],l=i[r+1];n+=(s-o)*(l+a),o=s,a=l}return n===0?void 0:n>0}function linearRingsAreOriented(i,r,t,e,n){for(var o=n!==void 0?n:!1,a=0,s=t.length;a<s;++a){var l=t[a],u=linearRingIsClockwise(i,r,l,e);if(a===0){if(o&&u||!o&&!u)return!1}else if(o&&!u||!o&&u)return!1;r=l}return!0}function orientLinearRings(i,r,t,e,n){for(var o=n!==void 0?n:!1,a=0,s=t.length;a<s;++a){var l=t[a],u=linearRingIsClockwise(i,r,l,e),h=a===0?o&&u||!o&&!u:o&&!u||!o&&u;h&&coordinates(i,r,l,e),r=l}return r}var __extends$T=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Polygon=function(i){__extends$T(r,i);function r(t,e,n){var o=i.call(this)||this;return o.ends_=[],o.flatInteriorPointRevision_=-1,o.flatInteriorPoint_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,e!==void 0&&n?(o.setFlatCoordinates(e,t),o.ends_=n):o.setCoordinates(t,e),o}return r.prototype.appendLinearRing=function(t){this.flatCoordinates?extend$2(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){return o<closestSquaredDistanceXY(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,o))},r.prototype.containsXY=function(t,e){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},r.prototype.getArea=function(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},r.prototype.getCoordinates=function(t){var e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),orientLinearRings(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,inflateCoordinatesArray(e,0,this.ends_,this.stride)},r.prototype.getEnds=function(){return this.ends_},r.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},r.prototype.getInteriorPoint=function(){return new point(this.getFlatInteriorPoint(),GeometryLayout.XYM)},r.prototype.getLinearRingCount=function(){return this.ends_.length},r.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new LinearRing$1(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)},r.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,n=this.ends_,o=[],a=0,s=0,l=n.length;s<l;++s){var u=n[s],h=new LinearRing$1(e.slice(a,u),t);o.push(h),a=u}return o},r.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;linearRingsAreOriented(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],n=[];return e.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new r(e,GeometryLayout.XY,n)},r.prototype.getType=function(){return GeometryType.POLYGON},r.prototype.intersectsExtent=function(t){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=deflateCoordinatesArray(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()},r}(SimpleGeometry$1);function fromExtent(i){var r=i[0],t=i[1],e=i[2],n=i[3],o=[r,t,r,n,e,n,e,t,r,t];return new Polygon(o,GeometryLayout.XY,[o.length])}var __extends$S=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),DEFAULT_MIN_ZOOM=0,View=function(i){__extends$S(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un;var n=assign({},t);return e.hints_=[0,0],e.animations_=[],e.updateAnimationKey_,e.projection_=createProjection(n.projection,"EPSG:3857"),e.viewportSize_=[100,100],e.targetCenter_=null,e.targetResolution_,e.targetRotation_,e.nextCenter_=null,e.nextResolution_,e.nextRotation_,e.cancelAnchor_=void 0,n.center&&(n.center=fromUserCoordinate(n.center,e.projection_)),n.extent&&(n.extent=fromUserExtent(n.extent,e.projection_)),e.applyOptions_(n),e}return r.prototype.applyOptions_=function(t){var e={},n=createResolutionConstraint(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;var o=createCenterConstraint(t),a=n.constraint,s=createRotationConstraint(t);this.constraints_={center:o,resolution:a,rotation:s},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom),this.setProperties(e),this.options_=t},Object.defineProperty(r.prototype,"padding",{get:function(){return this.padding_},set:function(t){var e=this.padding_;this.padding_=t;var n=this.getCenter();if(n){var o=t||[0,0,0,0];e=e||[0,0,0,0];var a=this.getResolution(),s=a/2*(o[3]-e[3]+e[1]-o[1]),l=a/2*(o[0]-e[0]+e[2]-o[2]);this.setCenterInternal([n[0]+s,n[1]-l])}},enumerable:!1,configurable:!0}),r.prototype.getUpdatedOptions_=function(t){var e=assign({},this.options_);return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),assign({},e,t)},r.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var e=new Array(arguments.length),n=0;n<e.length;++n){var o=arguments[n];o.center&&(o=assign({},o),o.center=fromUserCoordinate(o.center,this.getProjection())),o.anchor&&(o=assign({},o),o.anchor=fromUserCoordinate(o.anchor,this.getProjection())),e[n]=o}this.animateInternal.apply(this,e)},r.prototype.animateInternal=function(t){var e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);for(var o=0;o<e&&!this.isDef();++o){var a=arguments[o];a.center&&this.setCenterInternal(a.center),a.zoom!==void 0?this.setZoom(a.zoom):a.resolution&&this.setResolution(a.resolution),a.rotation!==void 0&&this.setRotation(a.rotation)}if(o===e){n&&animationCallback(n,!0);return}for(var s=Date.now(),l=this.targetCenter_.slice(),u=this.targetResolution_,h=this.targetRotation_,c=[];o<e;++o){var f=arguments[o],p={start:s,complete:!1,anchor:f.anchor,duration:f.duration!==void 0?f.duration:1e3,easing:f.easing||inAndOut,callback:n};if(f.center&&(p.sourceCenter=l,p.targetCenter=f.center.slice(),l=p.targetCenter),f.zoom!==void 0?(p.sourceResolution=u,p.targetResolution=this.getResolutionForZoom(f.zoom),u=p.targetResolution):f.resolution&&(p.sourceResolution=u,p.targetResolution=f.resolution,u=p.targetResolution),f.rotation!==void 0){p.sourceRotation=h;var d=modulo(f.rotation-h+Math.PI,2*Math.PI)-Math.PI;p.targetRotation=h+d,h=p.targetRotation}isNoopAnimation(p)?p.complete=!0:s+=p.duration,c.push(p)}this.animations_.push(c),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()},r.prototype.getAnimating=function(){return this.hints_[ViewHint.ANIMATING]>0},r.prototype.getInteracting=function(){return this.hints_[ViewHint.INTERACTING]>0},r.prototype.cancelAnimations=function(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);for(var t,e=0,n=this.animations_.length;e<n;++e){var o=this.animations_[e];if(o[0].callback&&animationCallback(o[0].callback,!1),!t)for(var a=0,s=o.length;a<s;++a){var l=o[a];if(!l.complete){t=l.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},r.prototype.updateAnimations_=function(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!!this.getAnimating()){for(var t=Date.now(),e=!1,n=this.animations_.length-1;n>=0;--n){for(var o=this.animations_[n],a=!0,s=0,l=o.length;s<l;++s){var u=o[s];if(!u.complete){var h=t-u.start,c=u.duration>0?h/u.duration:1;c>=1?(u.complete=!0,c=1):a=!1;var f=u.easing(c);if(u.sourceCenter){var p=u.sourceCenter[0],d=u.sourceCenter[1],v=u.targetCenter[0],_=u.targetCenter[1];this.nextCenter_=u.targetCenter;var g=p+f*(v-p),y=d+f*(_-d);this.targetCenter_=[g,y]}if(u.sourceResolution&&u.targetResolution){var m=f===1?u.targetResolution:u.sourceResolution+f*(u.targetResolution-u.sourceResolution);if(u.anchor){var E=this.getViewportSize_(this.getRotation()),T=this.constraints_.resolution(m,0,E,!0);this.targetCenter_=this.calculateCenterZoom(T,u.anchor)}this.nextResolution_=u.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(u.sourceRotation!==void 0&&u.targetRotation!==void 0){var I=f===1?modulo(u.targetRotation+Math.PI,2*Math.PI)-Math.PI:u.sourceRotation+f*(u.targetRotation-u.sourceRotation);if(u.anchor){var R=this.constraints_.rotation(I,!0);this.targetCenter_=this.calculateCenterRotate(R,u.anchor)}this.nextRotation_=u.targetRotation,this.targetRotation_=I}if(this.applyTargetState_(!0),e=!0,!u.complete)break}}if(a){this.animations_[n]=null,this.setHint(ViewHint.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var C=o[0].callback;C&&animationCallback(C,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},r.prototype.calculateCenterRotate=function(t,e){var n,o=this.getCenterInternal();return o!==void 0&&(n=[o[0]-e[0],o[1]-e[1]],rotate$1(n,t-this.getRotation()),add$2(n,e)),n},r.prototype.calculateCenterZoom=function(t,e){var n,o=this.getCenterInternal(),a=this.getResolution();if(o!==void 0&&a!==void 0){var s=e[0]-t*(e[0]-o[0])/a,l=e[1]-t*(e[1]-o[1])/a;n=[s,l]}return n},r.prototype.getViewportSize_=function(t){var e=this.viewportSize_;if(t){var n=e[0],o=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(o*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(o*Math.cos(t))]}else return e},r.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},r.prototype.getCenter=function(){var t=this.getCenterInternal();return t&&toUserCoordinate(t,this.getProjection())},r.prototype.getCenterInternal=function(){return this.get(ViewProperty.CENTER)},r.prototype.getConstraints=function(){return this.constraints_},r.prototype.getConstrainResolution=function(){return this.options_.constrainResolution},r.prototype.getHints=function(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},r.prototype.calculateExtent=function(t){var e=this.calculateExtentInternal(t);return toUserExtent(e,this.getProjection())},r.prototype.calculateExtentInternal=function(t){var e=t||this.getViewportSizeMinusPadding_(),n=this.getCenterInternal();assert(n,1);var o=this.getResolution();assert(o!==void 0,2);var a=this.getRotation();return assert(a!==void 0,3),getForViewAndSize(n,o,a,e)},r.prototype.getMaxResolution=function(){return this.maxResolution_},r.prototype.getMinResolution=function(){return this.minResolution_},r.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},r.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},r.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},r.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},r.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},r.prototype.getProjection=function(){return this.projection_},r.prototype.getResolution=function(){return this.get(ViewProperty.RESOLUTION)},r.prototype.getResolutions=function(){return this.resolutions_},r.prototype.getResolutionForExtent=function(t,e){return this.getResolutionForExtentInternal(fromUserExtent(t,this.getProjection()),e)},r.prototype.getResolutionForExtentInternal=function(t,e){var n=e||this.getViewportSizeMinusPadding_(),o=getWidth(t)/n[0],a=getHeight(t)/n[1];return Math.max(o,a)},r.prototype.getResolutionForValueFunction=function(t){var e=t||2,n=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,a=Math.log(n/o)/Math.log(e);return function(s){var l=n/Math.pow(e,s*a);return l}},r.prototype.getRotation=function(){return this.get(ViewProperty.ROTATION)},r.prototype.getValueForResolutionFunction=function(t){var e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,a=Math.log(n/o)/e;return function(s){var l=Math.log(n/s)/e/a;return l}},r.prototype.getViewportSizeMinusPadding_=function(t){var e=this.getViewportSize_(t),n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e},r.prototype.getState=function(){var t=this.getProjection(),e=this.getResolution(),n=this.getRotation(),o=this.getCenterInternal(),a=this.padding_;if(a){var s=this.getViewportSizeMinusPadding_();o=calculateCenterOn(o,this.getViewportSize_(),[s[0]/2+a[3],s[1]/2+a[0]],e,n)}return{center:o.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}},r.prototype.getZoom=function(){var t,e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t},r.prototype.getZoomForResolution=function(t){var e=this.minZoom_||0,n,o;if(this.resolutions_){var a=linearFindNearest(this.resolutions_,t,1);e=a,n=this.resolutions_[a],a==this.resolutions_.length-1?o=2:o=n/this.resolutions_[a+1]}else n=this.maxResolution_,o=this.zoomFactor_;return e+Math.log(n/t)/Math.log(o)},r.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var e=clamp(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,clamp(t-e,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},r.prototype.fit=function(t,e){var n;if(assert(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){assert(!isEmpty$1(t),25);var o=fromUserExtent(t,this.getProjection());n=fromExtent(o)}else if(t.getType()===GeometryType.CIRCLE){var o=fromUserExtent(t.getExtent(),this.getProjection());n=fromExtent(o),n.rotate(this.getRotation(),getCenter(o))}else{var a=getUserProjection();a?n=t.clone().transform(a,this.getProjection()):n=t}this.fitInternal(n,e)},r.prototype.rotatedExtentForGeometry=function(t){for(var e=this.getRotation(),n=Math.cos(e),o=Math.sin(-e),a=t.getFlatCoordinates(),s=t.getStride(),l=1/0,u=1/0,h=-1/0,c=-1/0,f=0,p=a.length;f<p;f+=s){var d=a[f]*n-a[f+1]*o,v=a[f]*o+a[f+1]*n;l=Math.min(l,d),u=Math.min(u,v),h=Math.max(h,d),c=Math.max(c,v)}return[l,u,h,c]},r.prototype.fitInternal=function(t,e){var n=e||{},o=n.size;o||(o=this.getViewportSizeMinusPadding_());var a=n.padding!==void 0?n.padding:[0,0,0,0],s=n.nearest!==void 0?n.nearest:!1,l;n.minResolution!==void 0?l=n.minResolution:n.maxZoom!==void 0?l=this.getResolutionForZoom(n.maxZoom):l=0;var u=this.rotatedExtentForGeometry(t),h=this.getResolutionForExtentInternal(u,[o[0]-a[1]-a[3],o[1]-a[0]-a[2]]);h=isNaN(h)?l:Math.max(h,l),h=this.getConstrainedResolution(h,s?0:1);var c=this.getRotation(),f=Math.sin(c),p=Math.cos(c),d=getCenter(u);d[0]+=(a[1]-a[3])/2*h,d[1]+=(a[0]-a[2])/2*h;var v=d[0]*p-d[1]*f,_=d[1]*p+d[0]*f,g=this.getConstrainedCenter([v,_],h),y=n.callback?n.callback:VOID;n.duration!==void 0?this.animateInternal({resolution:h,center:g,duration:n.duration,easing:n.easing},y):(this.targetResolution_=h,this.targetCenter_=g,this.applyTargetState_(!1,!0),animationCallback(y,!0))},r.prototype.centerOn=function(t,e,n){this.centerOnInternal(fromUserCoordinate(t,this.getProjection()),e,n)},r.prototype.centerOnInternal=function(t,e,n){this.setCenterInternal(calculateCenterOn(t,e,n,this.getResolution(),this.getRotation()))},r.prototype.calculateCenterShift=function(t,e,n,o){var a,s=this.padding_;if(s&&t){var l=this.getViewportSizeMinusPadding_(-n),u=calculateCenterOn(t,o,[l[0]/2+s[3],l[1]/2+s[0]],e,n);a=[t[0]-u[0],t[1]-u[1]]}return a},r.prototype.isDef=function(){return!!this.getCenterInternal()&&this.getResolution()!==void 0},r.prototype.adjustCenter=function(t){var e=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])},r.prototype.adjustCenterInternal=function(t){var e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])},r.prototype.adjustResolution=function(t,e){var n=e&&fromUserCoordinate(e,this.getProjection());this.adjustResolutionInternal(t,n)},r.prototype.adjustResolutionInternal=function(t,e){var n=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),a=this.constraints_.resolution(this.targetResolution_*t,0,o,n);e&&(this.targetCenter_=this.calculateCenterZoom(a,e)),this.targetResolution_*=t,this.applyTargetState_()},r.prototype.adjustZoom=function(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)},r.prototype.adjustRotation=function(t,e){e&&(e=fromUserCoordinate(e,this.getProjection())),this.adjustRotationInternal(t,e)},r.prototype.adjustRotationInternal=function(t,e){var n=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(o,e)),this.targetRotation_+=t,this.applyTargetState_()},r.prototype.setCenter=function(t){this.setCenterInternal(fromUserCoordinate(t,this.getProjection()))},r.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},r.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},r.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},r.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},r.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},r.prototype.applyTargetState_=function(t,e){var n=this.getAnimating()||this.getInteracting()||e,o=this.constraints_.rotation(this.targetRotation_,n),a=this.getViewportSize_(o),s=this.constraints_.resolution(this.targetResolution_,0,a,n),l=this.constraints_.center(this.targetCenter_,s,a,n,this.calculateCenterShift(this.targetCenter_,s,o,a));this.get(ViewProperty.ROTATION)!==o&&this.set(ViewProperty.ROTATION,o),this.get(ViewProperty.RESOLUTION)!==s&&this.set(ViewProperty.RESOLUTION,s),(!this.get(ViewProperty.CENTER)||!equals(this.get(ViewProperty.CENTER),l))&&this.set(ViewProperty.CENTER,l),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},r.prototype.resolveConstraints=function(t,e,n){var o=t!==void 0?t:200,a=e||0,s=this.constraints_.rotation(this.targetRotation_),l=this.getViewportSize_(s),u=this.constraints_.resolution(this.targetResolution_,a,l),h=this.constraints_.center(this.targetCenter_,u,l,!1,this.calculateCenterShift(this.targetCenter_,u,s,l));if(o===0&&!this.cancelAnchor_){this.targetResolution_=u,this.targetRotation_=s,this.targetCenter_=h,this.applyTargetState_();return}var c=n||(o===0?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,(this.getResolution()!==u||this.getRotation()!==s||!this.getCenterInternal()||!equals(this.getCenterInternal(),h))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:h,resolution:u,duration:o,easing:easeOut,anchor:c}))},r.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)},r.prototype.endInteraction=function(t,e,n){var o=n&&fromUserCoordinate(n,this.getProjection());this.endInteractionInternal(t,e,o)},r.prototype.endInteractionInternal=function(t,e,n){this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(t,e,n)},r.prototype.getConstrainedCenter=function(t,e){var n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)},r.prototype.getConstrainedZoom=function(t,e){var n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))},r.prototype.getConstrainedResolution=function(t,e){var n=e||0,o=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,n,o)},r}(BaseObject$1);function animationCallback(i,r){setTimeout(function(){i(r)},0)}function createCenterConstraint(i){if(i.extent!==void 0){var r=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return createExtent(i.extent,i.constrainOnlyCenter,r)}var t=createProjection(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){var e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,createExtent(e,!1,!1)}return none$1}function createResolutionConstraint(i){var r,t,e,n=28,o=2,a=i.minZoom!==void 0?i.minZoom:DEFAULT_MIN_ZOOM,s=i.maxZoom!==void 0?i.maxZoom:n,l=i.zoomFactor!==void 0?i.zoomFactor:o,u=i.multiWorld!==void 0?i.multiWorld:!1,h=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,c=i.showFullExtent!==void 0?i.showFullExtent:!1,f=createProjection(i.projection,"EPSG:3857"),p=f.getExtent(),d=i.constrainOnlyCenter,v=i.extent;if(!u&&!v&&f.isGlobal()&&(d=!1,v=p),i.resolutions!==void 0){var _=i.resolutions;t=_[a],e=_[s]!==void 0?_[s]:_[_.length-1],i.constrainResolution?r=createSnapToResolutions(_,h,!d&&v,c):r=createMinMaxResolution(t,e,h,!d&&v,c)}else{var g=p?Math.max(getWidth(p),getHeight(p)):360*METERS_PER_UNIT$1[Units$1.DEGREES]/f.getMetersPerUnit(),y=g/DEFAULT_TILE_SIZE/Math.pow(o,DEFAULT_MIN_ZOOM),m=y/Math.pow(o,n-DEFAULT_MIN_ZOOM);t=i.maxResolution,t!==void 0?a=0:t=y/Math.pow(l,a),e=i.minResolution,e===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?e=t/Math.pow(l,s):e=y/Math.pow(l,s):e=m),s=a+Math.floor(Math.log(t/e)/Math.log(l)),e=t/Math.pow(l,s-a),i.constrainResolution?r=createSnapToPower(l,t,e,h,!d&&v,c):r=createMinMaxResolution(t,e,h,!d&&v,c)}return{constraint:r,maxResolution:t,minResolution:e,minZoom:a,zoomFactor:l}}function createRotationConstraint(i){var r=i.enableRotation!==void 0?i.enableRotation:!0;if(r){var t=i.constrainRotation;return t===void 0||t===!0?createSnapToZero():t===!1?none:typeof t=="number"?createSnapToN(t):none}else return disable}function isNoopAnimation(i){return!(i.sourceCenter&&i.targetCenter&&!equals(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function calculateCenterOn(i,r,t,e,n){var o=Math.cos(-n),a=Math.sin(-n),s=i[0]*o-i[1]*a,l=i[1]*o+i[0]*a;s+=(r[0]/2-t[0])*e,l+=(t[1]-r[1]/2)*e,a=-a;var u=s*o-l*a,h=l*o+s*a;return[u,h]}var View$1=View;function hasArea(i){return i[0]>0&&i[1]>0}function scale(i,r,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*r+.5|0,t[1]=i[1]*r+.5|0,t}function toSize(i,r){return Array.isArray(i)?i:(r===void 0?r=[i,i]:(r[0]=i,r[1]=i),r)}var __extends$R=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),PluggableMap=function(i){__extends$R(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un;var n=createOptionsInternal(t);e.boundHandleBrowserEvent_=e.handleBrowserEvent.bind(e),e.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,e.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:DEVICE_PIXEL_RATIO,e.postRenderTimeoutHandle_,e.animationDelayKey_,e.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(e),e.coordinateToPixelTransform_=create$2(),e.pixelToCoordinateTransform_=create$2(),e.frameIndex_=0,e.frameState_=null,e.previousExtent_=null,e.viewPropertyListenerKey_=null,e.viewChangeListenerKey_=null,e.layerGroupPropertyListenerKeys_=null,e.viewport_=document.createElement("div"),e.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),e.viewport_.style.position="relative",e.viewport_.style.overflow="hidden",e.viewport_.style.width="100%",e.viewport_.style.height="100%",e.overlayContainer_=document.createElement("div"),e.overlayContainer_.style.position="absolute",e.overlayContainer_.style.zIndex="0",e.overlayContainer_.style.width="100%",e.overlayContainer_.style.height="100%",e.overlayContainer_.style.pointerEvents="none",e.overlayContainer_.className="ol-overlaycontainer",e.viewport_.appendChild(e.overlayContainer_),e.overlayContainerStopEvent_=document.createElement("div"),e.overlayContainerStopEvent_.style.position="absolute",e.overlayContainerStopEvent_.style.zIndex="0",e.overlayContainerStopEvent_.style.width="100%",e.overlayContainerStopEvent_.style.height="100%",e.overlayContainerStopEvent_.style.pointerEvents="none",e.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",e.viewport_.appendChild(e.overlayContainerStopEvent_),e.mapBrowserEventHandler_=null,e.moveTolerance_=t.moveTolerance,e.keyboardEventTarget_=n.keyboardEventTarget,e.keyHandlerKeys_=null,e.controls=n.controls||new Collection$1,e.interactions=n.interactions||new Collection$1,e.overlays_=n.overlays,e.overlayIdIndex_={},e.renderer_=null,e.handleResize_,e.postRenderFunctions_=[],e.tileQueue_=new TileQueue$1(e.getTilePriority.bind(e),e.handleTileChange_.bind(e)),e.addChangeListener(MapProperty.LAYERGROUP,e.handleLayerGroupChanged_),e.addChangeListener(MapProperty.VIEW,e.handleViewChanged_),e.addChangeListener(MapProperty.SIZE,e.handleSizeChanged_),e.addChangeListener(MapProperty.TARGET,e.handleTargetChanged_),e.setProperties(n.values);var o=e;return t.view&&!(t.view instanceof View$1)&&t.view.then(function(a){o.setView(new View$1(a))}),e.controls.addEventListener(CollectionEventType.ADD,function(a){a.element.setMap(this)}.bind(e)),e.controls.addEventListener(CollectionEventType.REMOVE,function(a){a.element.setMap(null)}.bind(e)),e.interactions.addEventListener(CollectionEventType.ADD,function(a){a.element.setMap(this)}.bind(e)),e.interactions.addEventListener(CollectionEventType.REMOVE,function(a){a.element.setMap(null)}.bind(e)),e.overlays_.addEventListener(CollectionEventType.ADD,function(a){this.addOverlayInternal_(a.element)}.bind(e)),e.overlays_.addEventListener(CollectionEventType.REMOVE,function(a){var s=a.element,l=s.getId();l!==void 0&&delete this.overlayIdIndex_[l.toString()],a.element.setMap(null)}.bind(e)),e.controls.forEach(function(a){a.setMap(this)}.bind(e)),e.interactions.forEach(function(a){a.setMap(this)}.bind(e)),e.overlays_.forEach(e.addOverlayInternal_.bind(e)),e}return r.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},r.prototype.addControl=function(t){this.getControls().push(t)},r.prototype.addInteraction=function(t){this.getInteractions().push(t)},r.prototype.addLayer=function(t){var e=this.getLayerGroup().getLayers();e.push(t)},r.prototype.addOverlay=function(t){this.getOverlays().push(t)},r.prototype.addOverlayInternal_=function(t){var e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},r.prototype.disposeInternal=function(){this.setTarget(null),i.prototype.disposeInternal.call(this)},r.prototype.forEachFeatureAtPixel=function(t,e,n){if(!!this.frameState_){var o=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};var a=n.hitTolerance!==void 0?n.hitTolerance:0,s=n.layerFilter!==void 0?n.layerFilter:TRUE,l=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,a,l,e,null,s,null)}},r.prototype.getFeaturesAtPixel=function(t,e){var n=[];return this.forEachFeatureAtPixel(t,function(o){n.push(o)},e),n},r.prototype.forEachLayerAtPixel=function(t,e,n){if(!!this.frameState_){var o=n||{},a=o.hitTolerance!==void 0?o.hitTolerance:0,s=o.layerFilter||TRUE;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,a,e,s)}},r.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};var o=e.layerFilter!==void 0?e.layerFilter:TRUE,a=e.hitTolerance!==void 0?e.hitTolerance:0,s=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,a,s,o,null)},r.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},r.prototype.getEventCoordinateInternal=function(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))},r.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),n="changedTouches"in t?t.changedTouches[0]:t;return[n.clientX-e.left,n.clientY-e.top]},r.prototype.getTarget=function(){return this.get(MapProperty.TARGET)},r.prototype.getTargetElement=function(){var t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null},r.prototype.getCoordinateFromPixel=function(t){return toUserCoordinate(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())},r.prototype.getCoordinateFromPixelInternal=function(t){var e=this.frameState_;return e?apply(e.pixelToCoordinateTransform,t.slice()):null},r.prototype.getControls=function(){return this.controls},r.prototype.getOverlays=function(){return this.overlays_},r.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null},r.prototype.getInteractions=function(){return this.interactions},r.prototype.getLayerGroup=function(){return this.get(MapProperty.LAYERGROUP)},r.prototype.setLayers=function(t){var e=this.getLayerGroup();if(t instanceof Collection$1){e.setLayers(t);return}var n=e.getLayers();n.clear(),n.extend(t)},r.prototype.getLayers=function(){var t=this.getLayerGroup().getLayers();return t},r.prototype.getLoading=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,n=t.length;e<n;++e){var o=t[e].layer,a=o.getSource();if(a&&a.loading)return!0}return!1},r.prototype.getPixelFromCoordinate=function(t){var e=fromUserCoordinate(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)},r.prototype.getPixelFromCoordinateInternal=function(t){var e=this.frameState_;return e?apply(e.coordinateToPixelTransform,t.slice(0,2)):null},r.prototype.getRenderer=function(){return this.renderer_},r.prototype.getSize=function(){return this.get(MapProperty.SIZE)},r.prototype.getView=function(){return this.get(MapProperty.VIEW)},r.prototype.getViewport=function(){return this.viewport_},r.prototype.getOverlayContainer=function(){return this.overlayContainer_},r.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},r.prototype.getOwnerDocument=function(){var t=this.getTargetElement();return t?t.ownerDocument:document},r.prototype.getTilePriority=function(t,e,n,o){return getTilePriority(this.frameState_,t,e,n,o)},r.prototype.handleBrowserEvent=function(t,e){var n=e||t.type,o=new MapBrowserEvent$1(n,this,t);this.handleMapBrowserEvent(o)},r.prototype.handleMapBrowserEvent=function(t){if(!!this.frameState_){var e=t.originalEvent,n=e.type;if(n===PointerEventType.POINTERDOWN||n===EventType.WHEEL||n===EventType.KEYDOWN){var o=this.getOwnerDocument(),a=this.viewport_.getRootNode?this.viewport_.getRootNode():o,s=e.target;if(this.overlayContainerStopEvent_.contains(s)||!(a===o?o.documentElement:a).contains(s))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1)for(var l=this.getInteractions().getArray().slice(),u=l.length-1;u>=0;u--){var h=l[u];if(!(h.getMap()!==this||!h.getActive()||!this.getTargetElement())){var c=h.handleEvent(t);if(!c||t.propagationStopped)break}}}},r.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var n=this.maxTilesLoading_,o=n;if(t){var a=t.viewHints;if(a[ViewHint.ANIMATING]||a[ViewHint.INTERACTING]){var s=Date.now()-t.time>8;n=s?0:8,o=s?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,o))}t&&this.hasListener(RenderEventType.RENDERCOMPLETE)&&!t.animate&&!this.tileQueue_.getTilesLoading()&&!this.getLoading()&&this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,t);for(var l=this.postRenderFunctions_,u=0,h=l.length;u<h;++u)l[u](this,t);l.length=0},r.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},r.prototype.handleTargetChanged_=function(){var t;if(this.getTarget()&&(t=this.getTargetElement()),this.mapBrowserEventHandler_){for(var e=0,n=this.keyHandlerKeys_.length;e<n;++e)unlistenByKey(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null,this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),this.handleResize_!==void 0&&(removeEventListener(EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,removeNode(this.viewport_)}if(!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new MapBrowserEventHandler$1(this,this.moveTolerance_);for(var o in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1);var a=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[listen(a,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(a,EventType.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(EventType.RESIZE,this.handleResize_,!1))}this.updateSize()},r.prototype.handleTileChange_=function(){this.render()},r.prototype.handleViewPropertyChanged_=function(){this.render()},r.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=listen(t,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(t,EventType.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()},r.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[listen(t,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(t,EventType.CHANGE,this.render,this)]),this.render()},r.prototype.isRendered=function(){return!!this.frameState_},r.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},r.prototype.redrawText=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,n=t.length;e<n;++e){var o=t[e].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}},r.prototype.render=function(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},r.prototype.removeControl=function(t){return this.getControls().remove(t)},r.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},r.prototype.removeLayer=function(t){var e=this.getLayerGroup().getLayers();return e.remove(t)},r.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},r.prototype.renderFrame_=function(t){var e=this,n=this.getSize(),o=this.getView(),a=this.frameState_,s=null;if(n!==void 0&&hasArea(n)&&o&&o.isDef()){var l=o.getHints(this.frameState_?this.frameState_.viewHints:void 0),u=o.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:getForViewAndSize(u.center,u.resolution,u.rotation,n),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:u,viewHints:l,wantedTiles:{}},u.nextCenter&&u.nextResolution){var h=isNaN(u.nextRotation)?u.rotation:u.nextRotation;s.nextExtent=getForViewAndSize(u.nextCenter,u.nextResolution,h,n)}}if(this.frameState_=s,this.renderer_.renderFrame(s),s){if(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),a){var c=!this.previousExtent_||!isEmpty$1(this.previousExtent_)&&!equals$1(s.extent,this.previousExtent_);c&&(this.dispatchEvent(new MapEvent$1(MapEventType.MOVESTART,this,a)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_))}var f=this.previousExtent_&&!s.viewHints[ViewHint.ANIMATING]&&!s.viewHints[ViewHint.INTERACTING]&&!equals$1(s.extent,this.previousExtent_);f&&(this.dispatchEvent(new MapEvent$1(MapEventType.MOVEEND,this,s)),clone(s.extent,this.previousExtent_))}this.dispatchEvent(new MapEvent$1(MapEventType.POSTRENDER,this,s)),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){e.postRenderTimeoutHandle_=void 0,e.handlePostRender()},0))},r.prototype.setLayerGroup=function(t){this.set(MapProperty.LAYERGROUP,t)},r.prototype.setSize=function(t){this.set(MapProperty.SIZE,t)},r.prototype.setTarget=function(t){this.set(MapProperty.TARGET,t)},r.prototype.setView=function(t){if(!t||t instanceof View$1){this.set(MapProperty.VIEW,t);return}this.set(MapProperty.VIEW,new View$1);var e=this;t.then(function(n){e.setView(new View$1(n))})},r.prototype.updateSize=function(){var t=this.getTargetElement(),e=void 0;if(t){var n=getComputedStyle(t),o=t.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),a=t.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(o)&&!isNaN(a)&&(e=[o,a],!hasArea(e)&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()},r.prototype.updateViewportSize_=function(){var t=this.getView();if(t){var e=void 0,n=getComputedStyle(this.viewport_);n.width&&n.height&&(e=[parseInt(n.width,10),parseInt(n.height,10)]),t.setViewportSize(e)}},r}(BaseObject$1);function createOptionsInternal(i){var r=null;i.keyboardEventTarget!==void 0&&(r=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);var t={},e=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new LayerGroup$1({layers:i.layers});t[MapProperty.LAYERGROUP]=e,t[MapProperty.TARGET]=i.target,t[MapProperty.VIEW]=i.view instanceof View$1?i.view:new View$1;var n;i.controls!==void 0&&(Array.isArray(i.controls)?n=new Collection$1(i.controls.slice()):(assert(typeof i.controls.getArray=="function",47),n=i.controls));var o;i.interactions!==void 0&&(Array.isArray(i.interactions)?o=new Collection$1(i.interactions.slice()):(assert(typeof i.interactions.getArray=="function",48),o=i.interactions));var a;return i.overlays!==void 0?Array.isArray(i.overlays)?a=new Collection$1(i.overlays.slice()):(assert(typeof i.overlays.getArray=="function",49),a=i.overlays):a=new Collection$1,{controls:n,interactions:o,keyboardEventTarget:r,overlays:a,values:t}}var PluggableMap$1=PluggableMap,__extends$Q=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Control=function(i){__extends$Q(r,i);function r(t){var e=i.call(this)||this,n=t.element;return n&&!t.target&&!n.style.pointerEvents&&(n.style.pointerEvents="auto"),e.element=n||null,e.target_=null,e.map_=null,e.listenerKeys=[],t.render&&(e.render=t.render),t.target&&e.setTarget(t.target),e}return r.prototype.disposeInternal=function(){removeNode(this.element),i.prototype.disposeInternal.call(this)},r.prototype.getMap=function(){return this.map_},r.prototype.setMap=function(t){this.map_&&removeNode(this.element);for(var e=0,n=this.listenerKeys.length;e<n;++e)unlistenByKey(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=t,this.map_){var o=this.target_?this.target_:t.getOverlayContainerStopEvent();o.appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(t,MapEventType.POSTRENDER,this.render,this)),t.render()}},r.prototype.render=function(t){},r.prototype.setTarget=function(t){this.target_=typeof t=="string"?document.getElementById(t):t},r}(BaseObject$1),Control$1=Control,__extends$P=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Attribution=function(i){__extends$P(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this,e.ulElement_=document.createElement("ul"),e.collapsed_=n.collapsed!==void 0?n.collapsed:!0,e.userCollapsed_=e.collapsed_,e.overrideCollapsible_=n.collapsible!==void 0,e.collapsible_=n.collapsible!==void 0?n.collapsible:!0,e.collapsible_||(e.collapsed_=!1);var o=n.className!==void 0?n.className:"ol-attribution",a=n.tipLabel!==void 0?n.tipLabel:"Attributions",s=n.expandClassName!==void 0?n.expandClassName:o+"-expand",l=n.collapseLabel!==void 0?n.collapseLabel:"\u203A",u=n.collapseClassName!==void 0?n.collapseClassName:o+"-collpase";typeof l=="string"?(e.collapseLabel_=document.createElement("span"),e.collapseLabel_.textContent=l,e.collapseLabel_.className=u):e.collapseLabel_=l;var h=n.label!==void 0?n.label:"i";typeof h=="string"?(e.label_=document.createElement("span"),e.label_.textContent=h,e.label_.className=s):e.label_=h;var c=e.collapsible_&&!e.collapsed_?e.collapseLabel_:e.label_;e.toggleButton_=document.createElement("button"),e.toggleButton_.setAttribute("type","button"),e.toggleButton_.setAttribute("aria-expanded",String(!e.collapsed_)),e.toggleButton_.title=a,e.toggleButton_.appendChild(c),e.toggleButton_.addEventListener(EventType.CLICK,e.handleClick_.bind(e),!1);var f=o+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(e.collapsed_&&e.collapsible_?" "+CLASS_COLLAPSED:"")+(e.collapsible_?"":" ol-uncollapsible"),p=e.element;return p.className=f,p.appendChild(e.toggleButton_),p.appendChild(e.ulElement_),e.renderedAttributions_=[],e.renderedVisible_=!0,e}return r.prototype.collectSourceAttributions_=function(t){for(var e={},n=[],o=!0,a=t.layerStatesArray,s=0,l=a.length;s<l;++s){var u=a[s];if(!!inView(u,t.viewState)){var h=u.layer.getSource();if(!!h){var c=h.getAttributions();if(!!c){var f=c(t);if(!!f)if(o=o&&h.getAttributionsCollapsible()!==!1,Array.isArray(f))for(var p=0,d=f.length;p<d;++p)f[p]in e||(n.push(f[p]),e[f[p]]=!0);else f in e||(n.push(f),e[f]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(o),n},r.prototype.updateElement_=function(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}var e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!equals$2(e,this.renderedAttributions_)){removeChildren(this.ulElement_);for(var o=0,a=e.length;o<a;++o){var s=document.createElement("li");s.innerHTML=e[o],this.ulElement_.appendChild(s)}this.renderedAttributions_=e}},r.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},r.prototype.handleToggle_=function(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},r.prototype.getCollapsible=function(){return this.collapsible_},r.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},r.prototype.setCollapsed=function(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()},r.prototype.getCollapsed=function(){return this.collapsed_},r.prototype.render=function(t){this.updateElement_(t.frameState)},r}(Control$1),Attribution$1=Attribution,__extends$O=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Rotate=function(i){__extends$O(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this;var o=n.className!==void 0?n.className:"ol-rotate",a=n.label!==void 0?n.label:"\u21E7",s=n.compassClassName!==void 0?n.compassClassName:"ol-compass";e.label_=null,typeof a=="string"?(e.label_=document.createElement("span"),e.label_.className=s,e.label_.textContent=a):(e.label_=a,e.label_.classList.add(s));var l=n.tipLabel?n.tipLabel:"Reset rotation",u=document.createElement("button");u.className=o+"-reset",u.setAttribute("type","button"),u.title=l,u.appendChild(e.label_),u.addEventListener(EventType.CLICK,e.handleClick_.bind(e),!1);var h=o+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,c=e.element;return c.className=h,c.appendChild(u),e.callResetNorth_=n.resetNorth?n.resetNorth:void 0,e.duration_=n.duration!==void 0?n.duration:250,e.autoHide_=n.autoHide!==void 0?n.autoHide:!0,e.rotation_=void 0,e.autoHide_&&e.element.classList.add(CLASS_HIDDEN),e}return r.prototype.handleClick_=function(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()},r.prototype.resetNorth_=function(){var t=this.getMap(),e=t.getView();if(!!e){var n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:easeOut}):e.setRotation(0))}},r.prototype.render=function(t){var e=t.frameState;if(!!e){var n=e.viewState.rotation;if(n!=this.rotation_){var o="rotate("+n+"rad)";if(this.autoHide_){var a=this.element.classList.contains(CLASS_HIDDEN);!a&&n===0?this.element.classList.add(CLASS_HIDDEN):a&&n!==0&&this.element.classList.remove(CLASS_HIDDEN)}this.label_.style.transform=o}this.rotation_=n}},r}(Control$1),Rotate$1=Rotate,__extends$N=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Zoom=function(i){__extends$N(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{element:document.createElement("div"),target:n.target})||this;var o=n.className!==void 0?n.className:"ol-zoom",a=n.delta!==void 0?n.delta:1,s=n.zoomInClassName!==void 0?n.zoomInClassName:o+"-in",l=n.zoomOutClassName!==void 0?n.zoomOutClassName:o+"-out",u=n.zoomInLabel!==void 0?n.zoomInLabel:"+",h=n.zoomOutLabel!==void 0?n.zoomOutLabel:"\u2013",c=n.zoomInTipLabel!==void 0?n.zoomInTipLabel:"Zoom in",f=n.zoomOutTipLabel!==void 0?n.zoomOutTipLabel:"Zoom out",p=document.createElement("button");p.className=s,p.setAttribute("type","button"),p.title=c,p.appendChild(typeof u=="string"?document.createTextNode(u):u),p.addEventListener(EventType.CLICK,e.handleClick_.bind(e,a),!1);var d=document.createElement("button");d.className=l,d.setAttribute("type","button"),d.title=f,d.appendChild(typeof h=="string"?document.createTextNode(h):h),d.addEventListener(EventType.CLICK,e.handleClick_.bind(e,-a),!1);var v=o+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,_=e.element;return _.className=v,_.appendChild(p),_.appendChild(d),e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},r.prototype.zoomByDelta_=function(t){var e=this.getMap(),n=e.getView();if(!!n){var o=n.getZoom();if(o!==void 0){var a=n.getConstrainedZoom(o+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:a,duration:this.duration_,easing:easeOut})):n.setZoom(a)}}},r}(Control$1),Zoom$1=Zoom;function defaults$1(i){var r=i||{},t=new Collection$1,e=r.zoom!==void 0?r.zoom:!0;e&&t.push(new Zoom$1(r.zoomOptions));var n=r.rotate!==void 0?r.rotate:!0;n&&t.push(new Rotate$1(r.rotateOptions));var o=r.attribution!==void 0?r.attribution:!0;return o&&t.push(new Attribution$1(r.attributionOptions)),t}var InteractionProperty={ACTIVE:"active"},__extends$M=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Interaction=function(i){__extends$M(r,i);function r(t){var e=i.call(this)||this;return e.on,e.once,e.un,t&&t.handleEvent&&(e.handleEvent=t.handleEvent),e.map_=null,e.setActive(!0),e}return r.prototype.getActive=function(){return this.get(InteractionProperty.ACTIVE)},r.prototype.getMap=function(){return this.map_},r.prototype.handleEvent=function(t){return!0},r.prototype.setActive=function(t){this.set(InteractionProperty.ACTIVE,t)},r.prototype.setMap=function(t){this.map_=t},r}(BaseObject$1);function pan(i,r,t){var e=i.getCenterInternal();if(e){var n=[e[0]+r[0],e[1]+r[1]];i.animateInternal({duration:t!==void 0?t:250,easing:linear,center:i.getConstrainedCenter(n)})}}function zoomByDelta(i,r,t,e){var n=i.getZoom();if(n!==void 0){var o=i.getConstrainedZoom(n+r),a=i.getResolutionForZoom(o);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:a,anchor:t,duration:e!==void 0?e:250,easing:easeOut})}}var Interaction$1=Interaction,__extends$L=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),DoubleClickZoom=function(i){__extends$L(r,i);function r(t){var e=i.call(this)||this,n=t||{};return e.delta_=n.delta?n.delta:1,e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleEvent=function(t){var e=!1;if(t.type==MapBrowserEventType.DBLCLICK){var n=t.originalEvent,o=t.map,a=t.coordinate,s=n.shiftKey?-this.delta_:this.delta_,l=o.getView();zoomByDelta(l,s,a,this.duration_),n.preventDefault(),e=!0}return!e},r}(Interaction$1),DoubleClickZoom$1=DoubleClickZoom,__extends$K=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),PointerInteraction=function(i){__extends$K(r,i);function r(t){var e=this,n=t||{};return e=i.call(this,n)||this,n.handleDownEvent&&(e.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(e.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(e.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(e.handleUpEvent=n.handleUpEvent),n.stopDown&&(e.stopDown=n.stopDown),e.handlingDownUpSequence=!1,e.trackedPointers_={},e.targetPointers=[],e}return r.prototype.getPointerCount=function(){return this.targetPointers.length},r.prototype.handleDownEvent=function(t){return!1},r.prototype.handleDragEvent=function(t){},r.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==MapBrowserEventType.POINTERUP){var n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==MapBrowserEventType.POINTERDOWN){var o=this.handleDownEvent(t);this.handlingDownUpSequence=o,e=this.stopDown(o)}else t.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(t);return!e},r.prototype.handleMoveEvent=function(t){},r.prototype.handleUpEvent=function(t){return!1},r.prototype.stopDown=function(t){return t},r.prototype.updateTrackedPointers_=function(t){if(isPointerDraggingEvent(t)){var e=t.originalEvent,n=e.pointerId.toString();t.type==MapBrowserEventType.POINTERUP?delete this.trackedPointers_[n]:t.type==MapBrowserEventType.POINTERDOWN?this.trackedPointers_[n]=e:n in this.trackedPointers_&&(this.trackedPointers_[n]=e),this.targetPointers=getValues(this.trackedPointers_)}},r}(Interaction$1);function centroid(i){for(var r=i.length,t=0,e=0,n=0;n<r;n++)t+=i[n].clientX,e+=i[n].clientY;return[t/r,e/r]}function isPointerDraggingEvent(i){var r=i.type;return r===MapBrowserEventType.POINTERDOWN||r===MapBrowserEventType.POINTERDRAG||r===MapBrowserEventType.POINTERUP}var PointerInteraction$1=PointerInteraction;function all$1(i){var r=arguments;return function(t){for(var e=!0,n=0,o=r.length;n<o&&(e=e&&r[n](t),!!e);++n);return e}}var altShiftKeysOnly=function(i){var r=i.originalEvent;return r.altKey&&!(r.metaKey||r.ctrlKey)&&r.shiftKey},focus=function(i){return i.target.getTargetElement().contains(document.activeElement)},focusWithTabindex=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?focus(i):!0},always=TRUE,mouseActionButton=function(i){var r=i.originalEvent;return r.button==0&&!(WEBKIT&&MAC&&r.ctrlKey)},noModifierKeys=function(i){var r=i.originalEvent;return!r.altKey&&!(r.metaKey||r.ctrlKey)&&!r.shiftKey},shiftKeyOnly=function(i){var r=i.originalEvent;return!r.altKey&&!(r.metaKey||r.ctrlKey)&&r.shiftKey},targetNotEditable=function(i){var r=i.originalEvent,t=r.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"},mouseOnly=function(i){var r=i.originalEvent;return assert(r!==void 0,56),r.pointerType=="mouse"},primaryAction=function(i){var r=i.originalEvent;return assert(r!==void 0,56),r.isPrimary&&r.button===0},__extends$J=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),DragPan=function(i){__extends$J(r,i);function r(t){var e=i.call(this,{stopDown:FALSE})||this,n=t||{};e.kinetic_=n.kinetic,e.lastCentroid=null,e.lastPointersCount_,e.panning_=!1;var o=n.condition?n.condition:all$1(noModifierKeys,primaryAction);return e.condition_=n.onFocusOnly?all$1(focusWithTabindex,o):o,e.noKinetic_=!1,e}return r.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e=this.targetPointers,n=centroid(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){var o=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=t.map,s=a.getView();scale$2(o,s.getResolution()),rotate$1(o,s.getRotation()),s.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()},r.prototype.handleUpEvent=function(t){var e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var o=this.kinetic_.getDistance(),a=this.kinetic_.getAngle(),s=n.getCenterInternal(),l=e.getPixelFromCoordinateInternal(s),u=e.getCoordinateFromPixelInternal([l[0]-o*Math.cos(a),l[1]-o*Math.sin(a)]);n.animateInternal({center:n.getConstrainedCenter(u),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map,n=e.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1},r}(PointerInteraction$1),DragPan$1=DragPan,__extends$I=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),DragRotate=function(i){__extends$I(r,i);function r(t){var e=this,n=t||{};return e=i.call(this,{stopDown:FALSE})||this,e.condition_=n.condition?n.condition:altShiftKeysOnly,e.lastAngle_=void 0,e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleDragEvent=function(t){if(!!mouseOnly(t)){var e=t.map,n=e.getView();if(n.getConstraints().rotation!==disable){var o=e.getSize(),a=t.pixel,s=Math.atan2(o[1]/2-a[1],a[0]-o[0]/2);if(this.lastAngle_!==void 0){var l=s-this.lastAngle_;n.adjustRotationInternal(-l)}this.lastAngle_=s}}},r.prototype.handleUpEvent=function(t){if(!mouseOnly(t))return!0;var e=t.map,n=e.getView();return n.endInteraction(this.duration_),!1},r.prototype.handleDownEvent=function(t){if(!mouseOnly(t))return!1;if(mouseActionButton(t)&&this.condition_(t)){var e=t.map;return e.getView().beginInteraction(),this.lastAngle_=void 0,!0}else return!1},r}(PointerInteraction$1),DragRotate$1=DragRotate,__extends$H=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),RenderBox=function(i){__extends$H(r,i);function r(t){var e=i.call(this)||this;return e.geometry_=null,e.element_=document.createElement("div"),e.element_.style.position="absolute",e.element_.style.pointerEvents="auto",e.element_.className="ol-box "+t,e.map_=null,e.startPixel_=null,e.endPixel_=null,e}return r.prototype.disposeInternal=function(){this.setMap(null)},r.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,n="px",o=this.element_.style;o.left=Math.min(t[0],e[0])+n,o.top=Math.min(t[1],e[1])+n,o.width=Math.abs(e[0]-t[0])+n,o.height=Math.abs(e[1]-t[1])+n},r.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},r.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},r.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]],o=n.map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new Polygon([o])},r.prototype.getGeometry=function(){return this.geometry_},r}(Disposable$1),RenderBox$1=RenderBox,__extends$G=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},DragBoxEvent=function(i){__extends$G(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.coordinate=e,o.mapBrowserEvent=n,o}return r}(BaseEvent$1),DragBox=function(i){__extends$G(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un;var n=t||{};return e.box_=new RenderBox$1(n.className||"ol-dragbox"),e.minArea_=n.minArea!==void 0?n.minArea:64,n.onBoxEnd&&(e.onBoxEnd=n.onBoxEnd),e.startPixel_=null,e.condition_=n.condition?n.condition:mouseActionButton,e.boxEndCondition_=n.boxEndCondition?n.boxEndCondition:e.defaultBoxEndCondition,e}return r.prototype.defaultBoxEndCondition=function(t,e,n){var o=n[0]-e[0],a=n[1]-e[1];return o*o+a*a>=this.minArea_},r.prototype.getGeometry=function(){return this.box_.getGeometry()},r.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,t.coordinate,t))},r.prototype.handleUpEvent=function(t){this.box_.setMap(null);var e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new DragBoxEvent(e?DragBoxEventType.BOXEND:DragBoxEventType.BOXCANCEL,t.coordinate,t)),!1},r.prototype.handleDownEvent=function(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,t.coordinate,t)),!0):!1},r.prototype.onBoxEnd=function(t){},r}(PointerInteraction$1),DragBox$1=DragBox,__extends$F=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),DragZoom=function(i){__extends$F(r,i);function r(t){var e=this,n=t||{},o=n.condition?n.condition:shiftKeyOnly;return e=i.call(this,{condition:o,className:n.className||"ol-dragzoom",minArea:n.minArea})||this,e.duration_=n.duration!==void 0?n.duration:200,e.out_=n.out!==void 0?n.out:!1,e}return r.prototype.onBoxEnd=function(t){var e=this.getMap(),n=e.getView(),o=this.getGeometry();if(this.out_){var a=n.rotatedExtentForGeometry(o),s=n.getResolutionForExtentInternal(a),l=n.getResolution()/s;o=o.clone(),o.scale(l*l)}n.fitInternal(o,{duration:this.duration_,easing:easeOut})},r}(DragBox$1),DragZoom$1=DragZoom,KeyCode={LEFT:37,UP:38,RIGHT:39,DOWN:40},__extends$E=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),KeyboardPan=function(i){__extends$E(r,i);function r(t){var e=i.call(this)||this,n=t||{};return e.defaultCondition_=function(o){return noModifierKeys(o)&&targetNotEditable(o)},e.condition_=n.condition!==void 0?n.condition:e.defaultCondition_,e.duration_=n.duration!==void 0?n.duration:100,e.pixelDelta_=n.pixelDelta!==void 0?n.pixelDelta:128,e}return r.prototype.handleEvent=function(t){var e=!1;if(t.type==EventType.KEYDOWN){var n=t.originalEvent,o=n.keyCode;if(this.condition_(t)&&(o==KeyCode.DOWN||o==KeyCode.LEFT||o==KeyCode.RIGHT||o==KeyCode.UP)){var a=t.map,s=a.getView(),l=s.getResolution()*this.pixelDelta_,u=0,h=0;o==KeyCode.DOWN?h=-l:o==KeyCode.LEFT?u=-l:o==KeyCode.RIGHT?u=l:h=l;var c=[u,h];rotate$1(c,s.getRotation()),pan(s,c,this.duration_),n.preventDefault(),e=!0}}return!e},r}(Interaction$1),KeyboardPan$1=KeyboardPan,__extends$D=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),KeyboardZoom=function(i){__extends$D(r,i);function r(t){var e=i.call(this)||this,n=t||{};return e.condition_=n.condition?n.condition:targetNotEditable,e.delta_=n.delta?n.delta:1,e.duration_=n.duration!==void 0?n.duration:100,e}return r.prototype.handleEvent=function(t){var e=!1;if(t.type==EventType.KEYDOWN||t.type==EventType.KEYPRESS){var n=t.originalEvent,o=n.charCode;if(this.condition_(t)&&(o=="+".charCodeAt(0)||o=="-".charCodeAt(0))){var a=t.map,s=o=="+".charCodeAt(0)?this.delta_:-this.delta_,l=a.getView();zoomByDelta(l,s,void 0,this.duration_),n.preventDefault(),e=!0}}return!e},r}(Interaction$1),KeyboardZoom$1=KeyboardZoom,Kinetic=function(){function i(r,t,e){this.decay_=r,this.minVelocity_=t,this.delay_=e,this.points_=[],this.angle_=0,this.initialVelocity_=0}return i.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},i.prototype.update=function(r,t){this.points_.push(r,t,Date.now())},i.prototype.end=function(){if(this.points_.length<6)return!1;var r=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<r)return!1;for(var e=t-3;e>0&&this.points_[e+2]>r;)e-=3;var n=this.points_[t+2]-this.points_[e+2];if(n<1e3/60)return!1;var o=this.points_[t]-this.points_[e],a=this.points_[t+1]-this.points_[e+1];return this.angle_=Math.atan2(a,o),this.initialVelocity_=Math.sqrt(o*o+a*a)/n,this.initialVelocity_>this.minVelocity_},i.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},i.prototype.getAngle=function(){return this.angle_},i}(),Kinetic$1=Kinetic,__extends$C=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Mode={TRACKPAD:"trackpad",WHEEL:"wheel"},MouseWheelZoom=function(i){__extends$C(r,i);function r(t){var e=this,n=t||{};e=i.call(this,n)||this,e.totalDelta_=0,e.lastDelta_=0,e.maxDelta_=n.maxDelta!==void 0?n.maxDelta:1,e.duration_=n.duration!==void 0?n.duration:250,e.timeout_=n.timeout!==void 0?n.timeout:80,e.useAnchor_=n.useAnchor!==void 0?n.useAnchor:!0,e.constrainResolution_=n.constrainResolution!==void 0?n.constrainResolution:!1;var o=n.condition?n.condition:always;return e.condition_=n.onFocusOnly?all$1(focusWithTabindex,o):o,e.lastAnchor_=null,e.startTime_=void 0,e.timeoutId_,e.mode_=void 0,e.trackpadEventGap_=400,e.trackpadTimeoutId_,e.deltaPerZoom_=300,e}return r.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0;var t=this.getMap().getView();t.endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},r.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var e=t.type;if(e!==EventType.WHEEL)return!0;var n=t.map,o=t.originalEvent;o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);var a;if(t.type==EventType.WHEEL&&(a=o.deltaY,FIREFOX&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(a/=DEVICE_PIXEL_RATIO),o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(a*=40)),a===0)return!1;this.lastDelta_=a;var s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(a)<4?Mode.TRACKPAD:Mode.WHEEL);var l=n.getView();if(this.mode_===Mode.TRACKPAD&&!(l.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(l.getAnimating()&&l.cancelAnimations(),l.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),l.adjustZoom(-a/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=a;var u=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),u),!1},r.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var n=-clamp(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),zoomByDelta(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},r.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},r}(Interaction$1),MouseWheelZoom$1=MouseWheelZoom,__extends$B=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),PinchRotate=function(i){__extends$B(r,i);function r(t){var e=this,n=t||{},o=n;return o.stopDown||(o.stopDown=FALSE),e=i.call(this,o)||this,e.anchor_=null,e.lastAngle_=void 0,e.rotating_=!1,e.rotationDelta_=0,e.threshold_=n.threshold!==void 0?n.threshold:.3,e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleDragEvent=function(t){var e=0,n=this.targetPointers[0],o=this.targetPointers[1],a=Math.atan2(o.clientY-n.clientY,o.clientX-n.clientX);if(this.lastAngle_!==void 0){var s=a-this.lastAngle_;this.rotationDelta_+=s,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=s}this.lastAngle_=a;var l=t.map,u=l.getView();if(u.getConstraints().rotation!==disable){var h=l.getViewport().getBoundingClientRect(),c=centroid(this.targetPointers);c[0]-=h.left,c[1]-=h.top,this.anchor_=l.getCoordinateFromPixelInternal(c),this.rotating_&&(l.render(),u.adjustRotationInternal(e,this.anchor_))}},r.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map,n=e.getView();return n.endInteraction(this.duration_),!1}else return!0},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1},r}(PointerInteraction$1),PinchRotate$1=PinchRotate,__extends$A=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),PinchZoom=function(i){__extends$A(r,i);function r(t){var e=this,n=t||{},o=n;return o.stopDown||(o.stopDown=FALSE),e=i.call(this,o)||this,e.anchor_=null,e.duration_=n.duration!==void 0?n.duration:400,e.lastDistance_=void 0,e.lastScaleDelta_=1,e}return r.prototype.handleDragEvent=function(t){var e=1,n=this.targetPointers[0],o=this.targetPointers[1],a=n.clientX-o.clientX,s=n.clientY-o.clientY,l=Math.sqrt(a*a+s*s);this.lastDistance_!==void 0&&(e=this.lastDistance_/l),this.lastDistance_=l;var u=t.map,h=u.getView();e!=1&&(this.lastScaleDelta_=e);var c=u.getViewport().getBoundingClientRect(),f=centroid(this.targetPointers);f[0]-=c.left,f[1]-=c.top,this.anchor_=u.getCoordinateFromPixelInternal(f),u.render(),h.adjustResolutionInternal(e,this.anchor_)},r.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map,n=e.getView(),o=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,o),!1}else return!0},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1},r}(PointerInteraction$1),PinchZoom$1=PinchZoom,FormatType={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},__extends$z=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Feature=function(i){__extends$z(r,i);function r(t){var e=i.call(this)||this;if(e.on,e.once,e.un,e.id_=void 0,e.geometryName_="geometry",e.style_=null,e.styleFunction_=void 0,e.geometryChangeKey_=null,e.addChangeListener(e.geometryName_,e.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){var n=t;e.setGeometry(n)}else{var o=t;e.setProperties(o)}return e}return r.prototype.clone=function(){var t=new r(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var n=this.getStyle();return n&&t.setStyle(n),t},r.prototype.getGeometry=function(){return this.get(this.geometryName_)},r.prototype.getId=function(){return this.id_},r.prototype.getGeometryName=function(){return this.geometryName_},r.prototype.getStyle=function(){return this.style_},r.prototype.getStyleFunction=function(){return this.styleFunction_},r.prototype.handleGeometryChange_=function(){this.changed()},r.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=listen(t,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()},r.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},r.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?createStyleFunction(t):void 0,this.changed()},r.prototype.setId=function(t){this.id_=t,this.changed()},r.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},r}(BaseObject$1);function createStyleFunction(i){if(typeof i=="function")return i;var r;if(Array.isArray(i))r=i;else{assert(typeof i.getZIndex=="function",41);var t=i;r=[t]}return function(){return r}}var Feature$1=Feature;function lineStringLength(i,r,t,e){for(var n=i[r],o=i[r+1],a=0,s=r+e;s<t;s+=e){var l=i[s],u=i[s+1];a+=Math.sqrt((l-n)*(l-n)+(u-o)*(u-o)),n=l,o=u}return a}function quickselect(i,r,t,e,n){quickselectStep(i,r,t||0,e||i.length-1,n||defaultCompare)}function quickselectStep(i,r,t,e,n){for(;e>t;){if(e-t>600){var o=e-t+1,a=r-t+1,s=Math.log(o),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1),h=Math.max(t,Math.floor(r-a*l/o+u)),c=Math.min(e,Math.floor(r+(o-a)*l/o+u));quickselectStep(i,r,h,c,n)}var f=i[r],p=t,d=e;for(swap(i,t,r),n(i[e],f)>0&&swap(i,t,e);p<d;){for(swap(i,p,d),p++,d--;n(i[p],f)<0;)p++;for(;n(i[d],f)>0;)d--}n(i[t],f)===0?swap(i,t,d):(d++,swap(i,d,e)),d<=r&&(t=d+1),r<=d&&(e=d-1)}}function swap(i,r,t){var e=i[r];i[r]=i[t],i[t]=e}function defaultCompare(i,r){return i<r?-1:i>r?1:0}class RBush$2{constructor(r=9){this._maxEntries=Math.max(4,r),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(r){let t=this.data;const e=[];if(!intersects(r,t))return e;const n=this.toBBox,o=[];for(;t;){for(let a=0;a<t.children.length;a++){const s=t.children[a],l=t.leaf?n(s):s;intersects(r,l)&&(t.leaf?e.push(s):contains(r,l)?this._all(s,e):o.push(s))}t=o.pop()}return e}collides(r){let t=this.data;if(!intersects(r,t))return!1;const e=[];for(;t;){for(let n=0;n<t.children.length;n++){const o=t.children[n],a=t.leaf?this.toBBox(o):o;if(intersects(r,a)){if(t.leaf||contains(r,a))return!0;e.push(o)}}t=e.pop()}return!1}load(r){if(!(r&&r.length))return this;if(r.length<this._minEntries){for(let e=0;e<r.length;e++)this.insert(r[e]);return this}let t=this._build(r.slice(),0,r.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(r){return r&&this._insert(r,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(r,t){if(!r)return this;let e=this.data;const n=this.toBBox(r),o=[],a=[];let s,l,u;for(;e||o.length;){if(e||(e=o.pop(),l=o[o.length-1],s=a.pop(),u=!0),e.leaf){const h=findItem(r,e.children,t);if(h!==-1)return e.children.splice(h,1),o.push(e),this._condense(o),this}!u&&!e.leaf&&contains(e,n)?(o.push(e),a.push(s),s=0,l=e,e=e.children[0]):l?(s++,e=l.children[s],u=!1):e=null}return this}toBBox(r){return r}compareMinX(r,t){return r.minX-t.minX}compareMinY(r,t){return r.minY-t.minY}toJSON(){return this.data}fromJSON(r){return this.data=r,this}_all(r,t){const e=[];for(;r;)r.leaf?t.push(...r.children):e.push(...r.children),r=e.pop();return t}_build(r,t,e,n){const o=e-t+1;let a=this._maxEntries,s;if(o<=a)return s=createNode(r.slice(t,e+1)),calcBBox(s,this.toBBox),s;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),s=createNode([]),s.leaf=!1,s.height=n;const l=Math.ceil(o/a),u=l*Math.ceil(Math.sqrt(a));multiSelect(r,t,e,u,this.compareMinX);for(let h=t;h<=e;h+=u){const c=Math.min(h+u-1,e);multiSelect(r,h,c,l,this.compareMinY);for(let f=h;f<=c;f+=l){const p=Math.min(f+l-1,c);s.children.push(this._build(r,f,p,n-1))}}return calcBBox(s,this.toBBox),s}_chooseSubtree(r,t,e,n){for(;n.push(t),!(t.leaf||n.length-1===e);){let o=1/0,a=1/0,s;for(let l=0;l<t.children.length;l++){const u=t.children[l],h=bboxArea(u),c=enlargedArea(r,u)-h;c<a?(a=c,o=h<o?h:o,s=u):c===a&&h<o&&(o=h,s=u)}t=s||t.children[0]}return t}_insert(r,t,e){const n=e?r:this.toBBox(r),o=[],a=this._chooseSubtree(n,this.data,t,o);for(a.children.push(r),extend(a,n);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(n,o,t)}_split(r,t){const e=r[t],n=e.children.length,o=this._minEntries;this._chooseSplitAxis(e,o,n);const a=this._chooseSplitIndex(e,o,n),s=createNode(e.children.splice(a,e.children.length-a));s.height=e.height,s.leaf=e.leaf,calcBBox(e,this.toBBox),calcBBox(s,this.toBBox),t?r[t-1].children.push(s):this._splitRoot(e,s)}_splitRoot(r,t){this.data=createNode([r,t]),this.data.height=r.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(r,t,e){let n,o=1/0,a=1/0;for(let s=t;s<=e-t;s++){const l=distBBox(r,0,s,this.toBBox),u=distBBox(r,s,e,this.toBBox),h=intersectionArea(l,u),c=bboxArea(l)+bboxArea(u);h<o?(o=h,n=s,a=c<a?c:a):h===o&&c<a&&(a=c,n=s)}return n||e-t}_chooseSplitAxis(r,t,e){const n=r.leaf?this.compareMinX:compareNodeMinX,o=r.leaf?this.compareMinY:compareNodeMinY,a=this._allDistMargin(r,t,e,n),s=this._allDistMargin(r,t,e,o);a<s&&r.children.sort(n)}_allDistMargin(r,t,e,n){r.children.sort(n);const o=this.toBBox,a=distBBox(r,0,t,o),s=distBBox(r,e-t,e,o);let l=bboxMargin(a)+bboxMargin(s);for(let u=t;u<e-t;u++){const h=r.children[u];extend(a,r.leaf?o(h):h),l+=bboxMargin(a)}for(let u=e-t-1;u>=t;u--){const h=r.children[u];extend(s,r.leaf?o(h):h),l+=bboxMargin(s)}return l}_adjustParentBBoxes(r,t,e){for(let n=e;n>=0;n--)extend(t[n],r)}_condense(r){for(let t=r.length-1,e;t>=0;t--)r[t].children.length===0?t>0?(e=r[t-1].children,e.splice(e.indexOf(r[t]),1)):this.clear():calcBBox(r[t],this.toBBox)}}function findItem(i,r,t){if(!t)return r.indexOf(i);for(let e=0;e<r.length;e++)if(t(i,r[e]))return e;return-1}function calcBBox(i,r){distBBox(i,0,i.children.length,r,i)}function distBBox(i,r,t,e,n){n||(n=createNode(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let o=r;o<t;o++){const a=i.children[o];extend(n,i.leaf?e(a):a)}return n}function extend(i,r){return i.minX=Math.min(i.minX,r.minX),i.minY=Math.min(i.minY,r.minY),i.maxX=Math.max(i.maxX,r.maxX),i.maxY=Math.max(i.maxY,r.maxY),i}function compareNodeMinX(i,r){return i.minX-r.minX}function compareNodeMinY(i,r){return i.minY-r.minY}function bboxArea(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function bboxMargin(i){return i.maxX-i.minX+(i.maxY-i.minY)}function enlargedArea(i,r){return(Math.max(r.maxX,i.maxX)-Math.min(r.minX,i.minX))*(Math.max(r.maxY,i.maxY)-Math.min(r.minY,i.minY))}function intersectionArea(i,r){const t=Math.max(i.minX,r.minX),e=Math.max(i.minY,r.minY),n=Math.min(i.maxX,r.maxX),o=Math.min(i.maxY,r.maxY);return Math.max(0,n-t)*Math.max(0,o-e)}function contains(i,r){return i.minX<=r.minX&&i.minY<=r.minY&&r.maxX<=i.maxX&&r.maxY<=i.maxY}function intersects(i,r){return r.minX<=i.maxX&&r.minY<=i.maxY&&r.maxX>=i.minX&&r.maxY>=i.minY}function createNode(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(i,r,t,e,n){const o=[r,t];for(;o.length;){if(t=o.pop(),r=o.pop(),t-r<=e)continue;const a=r+Math.ceil((t-r)/e/2)*e;quickselect(i,a,r,t,n),o.push(r,a,a,t)}}var ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},ImageStyle=function(){function i(r){this.opacity_=r.opacity,this.rotateWithView_=r.rotateWithView,this.rotation_=r.rotation,this.scale_=r.scale,this.scaleArray_=toSize(r.scale),this.displacement_=r.displacement}return i.prototype.clone=function(){var r=this.getScale();return new i({opacity:this.getOpacity(),scale:Array.isArray(r)?r.slice():r,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},i.prototype.getOpacity=function(){return this.opacity_},i.prototype.getRotateWithView=function(){return this.rotateWithView_},i.prototype.getRotation=function(){return this.rotation_},i.prototype.getScale=function(){return this.scale_},i.prototype.getScaleArray=function(){return this.scaleArray_},i.prototype.getDisplacement=function(){return this.displacement_},i.prototype.getAnchor=function(){return abstract()},i.prototype.getImage=function(r){return abstract()},i.prototype.getHitDetectionImage=function(){return abstract()},i.prototype.getPixelRatio=function(r){return 1},i.prototype.getImageState=function(){return abstract()},i.prototype.getImageSize=function(){return abstract()},i.prototype.getOrigin=function(){return abstract()},i.prototype.getSize=function(){return abstract()},i.prototype.setOpacity=function(r){this.opacity_=r},i.prototype.setRotateWithView=function(r){this.rotateWithView_=r},i.prototype.setRotation=function(r){this.rotation_=r},i.prototype.setScale=function(r){this.scale_=r,this.scaleArray_=toSize(r)},i.prototype.listenImageChange=function(r){abstract()},i.prototype.load=function(){abstract()},i.prototype.unlistenImageChange=function(r){abstract()},i}(),ImageStyle$1=ImageStyle;function asColorLike(i){return Array.isArray(i)?toString(i):i}var __extends$y=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),RegularShape=function(i){__extends$y(r,i);function r(t){var e=this,n=t.rotateWithView!==void 0?t.rotateWithView:!1;return e=i.call(this,{opacity:1,rotateWithView:n,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0]})||this,e.canvas_=void 0,e.hitDetectionCanvas_=null,e.fill_=t.fill!==void 0?t.fill:null,e.origin_=[0,0],e.points_=t.points,e.radius_=t.radius!==void 0?t.radius:t.radius1,e.radius2_=t.radius2,e.angle_=t.angle!==void 0?t.angle:0,e.stroke_=t.stroke!==void 0?t.stroke:null,e.anchor_=null,e.size_=null,e.renderOptions_=null,e.render(),e}return r.prototype.clone=function(){var t=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e},r.prototype.getAnchor=function(){return this.anchor_},r.prototype.getAngle=function(){return this.angle_},r.prototype.getFill=function(){return this.fill_},r.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},r.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var n=this.renderOptions_,o=createCanvasContext2D(n.size*t,n.size*t);this.draw_(n,o,t),e=o.canvas,this.canvas_[t]=e}return e},r.prototype.getPixelRatio=function(t){return t},r.prototype.getImageSize=function(){return this.size_},r.prototype.getImageState=function(){return ImageState.LOADED},r.prototype.getOrigin=function(){return this.origin_},r.prototype.getPoints=function(){return this.points_},r.prototype.getRadius=function(){return this.radius_},r.prototype.getRadius2=function(){return this.radius2_},r.prototype.getSize=function(){return this.size_},r.prototype.getStroke=function(){return this.stroke_},r.prototype.listenImageChange=function(t){},r.prototype.load=function(){},r.prototype.unlistenImageChange=function(t){},r.prototype.calculateLineJoinSize_=function(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;var o=this.radius_,a=this.radius2_===void 0?o:this.radius2_;if(o<a){var s=o;o=a,a=s}var l=this.radius2_===void 0?this.points_:this.points_*2,u=2*Math.PI/l,h=a*Math.sin(u),c=Math.sqrt(a*a-h*h),f=o-c,p=Math.sqrt(h*h+f*f),d=p/h;if(t==="miter"&&d<=n)return d*e;var v=e/2/d,_=e/2*(f/p),g=Math.sqrt((o+v)*(o+v)+_*_),y=g-o;if(this.radius2_===void 0||t==="bevel")return y*2;var m=o*Math.sin(u),E=Math.sqrt(o*o-m*m),T=a-E,I=Math.sqrt(m*m+T*T),R=I/m;if(R<=n){var C=R*e/2-a-o;return 2*Math.max(y,C)}return y*2},r.prototype.createRenderOptions=function(){var t=defaultLineJoin,e=0,n=null,o=0,a,s=0;this.stroke_&&(a=this.stroke_.getColor(),a===null&&(a=defaultStrokeStyle),a=asColorLike(a),s=this.stroke_.getWidth(),s===void 0&&(s=defaultLineWidth),n=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=defaultLineJoin),e=this.stroke_.getMiterLimit(),e===void 0&&(e=defaultMiterLimit));var l=this.calculateLineJoinSize_(t,s,e),u=Math.max(this.radius_,this.radius2_||0),h=Math.ceil(2*u+l);return{strokeStyle:a,strokeWidth:s,size:h,lineDash:n,lineDashOffset:o,lineJoin:t,miterLimit:e}},r.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size,e=this.getDisplacement();this.canvas_={},this.anchor_=[t/2-e[0],t/2+e[1]],this.size_=[t,t]},r.prototype.draw_=function(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var o=this.fill_.getColor();o===null&&(o=defaultFillStyle),e.fillStyle=asColorLike(o),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},r.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),n=0;if(typeof e=="string"&&(e=asArray(e)),e===null?n=1:Array.isArray(e)&&(n=e.length===4?e[3]:1),n===0){var o=createCanvasContext2D(t.size,t.size);this.hitDetectionCanvas_=o.canvas,this.drawHitDetectionCanvas_(t,o)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},r.prototype.createPath_=function(t){var e=this.points_,n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{var o=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);for(var a=this.angle_-Math.PI/2,s=2*Math.PI/e,l=0;l<e;l++){var u=a+l*s,h=l%2==0?n:o;t.lineTo(h*Math.cos(u),h*Math.sin(u))}t.closePath()}},r.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=defaultFillStyle,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},r}(ImageStyle$1),RegularShape$1=RegularShape,__extends$x=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CircleStyle=function(i){__extends$x(r,i);function r(t){var e=this,n=t||{};return e=i.call(this,{points:1/0,fill:n.fill,radius:n.radius,stroke:n.stroke,scale:n.scale!==void 0?n.scale:1,rotation:n.rotation!==void 0?n.rotation:0,rotateWithView:n.rotateWithView!==void 0?n.rotateWithView:!1,displacement:n.displacement!==void 0?n.displacement:[0,0]})||this,e}return r.prototype.clone=function(){var t=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e},r.prototype.setRadius=function(t){this.radius_=t,this.render()},r}(RegularShape$1),Circle=CircleStyle,Fill=function(){function i(r){var t=r||{};this.color_=t.color!==void 0?t.color:null}return i.prototype.clone=function(){var r=this.getColor();return new i({color:Array.isArray(r)?r.slice():r||void 0})},i.prototype.getColor=function(){return this.color_},i.prototype.setColor=function(r){this.color_=r},i}(),Fill$1=Fill,Stroke=function(){function i(r){var t=r||{};this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return i.prototype.clone=function(){var r=this.getColor();return new i({color:Array.isArray(r)?r.slice():r||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},i.prototype.getColor=function(){return this.color_},i.prototype.getLineCap=function(){return this.lineCap_},i.prototype.getLineDash=function(){return this.lineDash_},i.prototype.getLineDashOffset=function(){return this.lineDashOffset_},i.prototype.getLineJoin=function(){return this.lineJoin_},i.prototype.getMiterLimit=function(){return this.miterLimit_},i.prototype.getWidth=function(){return this.width_},i.prototype.setColor=function(r){this.color_=r},i.prototype.setLineCap=function(r){this.lineCap_=r},i.prototype.setLineDash=function(r){this.lineDash_=r},i.prototype.setLineDashOffset=function(r){this.lineDashOffset_=r},i.prototype.setLineJoin=function(r){this.lineJoin_=r},i.prototype.setMiterLimit=function(r){this.miterLimit_=r},i.prototype.setWidth=function(r){this.width_=r},i}(),Stroke$1=Stroke,Style=function(){function i(r){var t=r||{};this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}return i.prototype.clone=function(){var r=this.getGeometry();return r&&typeof r=="object"&&(r=r.clone()),new i({geometry:r,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},i.prototype.getRenderer=function(){return this.renderer_},i.prototype.setRenderer=function(r){this.renderer_=r},i.prototype.setHitDetectionRenderer=function(r){this.hitDetectionRenderer_=r},i.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},i.prototype.getGeometry=function(){return this.geometry_},i.prototype.getGeometryFunction=function(){return this.geometryFunction_},i.prototype.getFill=function(){return this.fill_},i.prototype.setFill=function(r){this.fill_=r},i.prototype.getImage=function(){return this.image_},i.prototype.setImage=function(r){this.image_=r},i.prototype.getStroke=function(){return this.stroke_},i.prototype.setStroke=function(r){this.stroke_=r},i.prototype.getText=function(){return this.text_},i.prototype.setText=function(r){this.text_=r},i.prototype.getZIndex=function(){return this.zIndex_},i.prototype.setGeometry=function(r){typeof r=="function"?this.geometryFunction_=r:typeof r=="string"?this.geometryFunction_=function(t){return t.get(r)}:r?r!==void 0&&(this.geometryFunction_=function(){return r}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=r},i.prototype.setZIndex=function(r){this.zIndex_=r},i}();function toFunction(i){var r;if(typeof i=="function")r=i;else{var t;if(Array.isArray(i))t=i;else{assert(typeof i.getZIndex=="function",41);var e=i;t=[e]}r=function(){return t}}return r}var defaultStyles=null;function createDefaultStyle(i,r){if(!defaultStyles){var t=new Fill$1({color:"rgba(255,255,255,0.4)"}),e=new Stroke$1({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new Circle({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return defaultStyles}function defaultGeometryFunction(i){return i.getGeometry()}var __extends$w=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Property$1={RENDER_ORDER:"renderOrder"},BaseVectorLayer=function(i){__extends$w(r,i);function r(t){var e=this,n=t||{},o=assign({},n);return delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,e=i.call(this,o)||this,e.declutter_=n.declutter!==void 0?n.declutter:!1,e.renderBuffer_=n.renderBuffer!==void 0?n.renderBuffer:100,e.style_=null,e.styleFunction_=void 0,e.setStyle(n.style),e.updateWhileAnimating_=n.updateWhileAnimating!==void 0?n.updateWhileAnimating:!1,e.updateWhileInteracting_=n.updateWhileInteracting!==void 0?n.updateWhileInteracting:!1,e}return r.prototype.getDeclutter=function(){return this.declutter_},r.prototype.getFeatures=function(t){return i.prototype.getFeatures.call(this,t)},r.prototype.getRenderBuffer=function(){return this.renderBuffer_},r.prototype.getRenderOrder=function(){return this.get(Property$1.RENDER_ORDER)},r.prototype.getStyle=function(){return this.style_},r.prototype.getStyleFunction=function(){return this.styleFunction_},r.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},r.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},r.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new RBush$2(9)),this.getRenderer().renderDeclutter(t)},r.prototype.setRenderOrder=function(t){this.set(Property$1.RENDER_ORDER,t)},r.prototype.setStyle=function(t){this.style_=t!==void 0?t:createDefaultStyle,this.styleFunction_=t===null?void 0:toFunction(this.style_),this.changed()},r}(Layer$1),BaseVectorLayer$1=BaseVectorLayer,Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH],CanvasInstruction=Instruction,VectorContext=function(){function i(){}return i.prototype.drawCustom=function(r,t,e,n){},i.prototype.drawGeometry=function(r){},i.prototype.setStyle=function(r){},i.prototype.drawCircle=function(r,t){},i.prototype.drawFeature=function(r,t){},i.prototype.drawGeometryCollection=function(r,t){},i.prototype.drawLineString=function(r,t){},i.prototype.drawMultiLineString=function(r,t){},i.prototype.drawMultiPoint=function(r,t){},i.prototype.drawMultiPolygon=function(r,t){},i.prototype.drawPoint=function(r,t){},i.prototype.drawPolygon=function(r,t){},i.prototype.drawText=function(r,t){},i.prototype.setFillStrokeStyle=function(r,t){},i.prototype.setImageStyle=function(r,t){},i.prototype.setTextStyle=function(r,t){},i}(),VectorContext$1=VectorContext,__extends$v=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasBuilder=function(i){__extends$v(r,i);function r(t,e,n,o){var a=i.call(this)||this;return a.tolerance=t,a.maxExtent=e,a.pixelRatio=o,a.maxLineWidth=0,a.resolution=n,a.beginGeometryInstruction1_=null,a.beginGeometryInstruction2_=null,a.bufferedMaxExtent_=null,a.instructions=[],a.coordinates=[],a.tmpCoordinate_=[],a.hitDetectionInstructions=[],a.state={},a}return r.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})},r.prototype.appendFlatPointCoordinates=function(t,e){for(var n=this.getBufferedMaxExtent(),o=this.tmpCoordinate_,a=this.coordinates,s=a.length,l=0,u=t.length;l<u;l+=e)o[0]=t[l],o[1]=t[l+1],containsCoordinate(n,o)&&(a[s++]=o[0],a[s++]=o[1]);return s},r.prototype.appendFlatLineCoordinates=function(t,e,n,o,a,s){var l=this.coordinates,u=l.length,h=this.getBufferedMaxExtent();s&&(e+=o);var c=t[e],f=t[e+1],p=this.tmpCoordinate_,d=!0,v,_,g;for(v=e+o;v<n;v+=o)p[0]=t[v],p[1]=t[v+1],g=coordinateRelationship(h,p),g!==_?(d&&(l[u++]=c,l[u++]=f,d=!1),l[u++]=p[0],l[u++]=p[1]):g===Relationship.INTERSECTING?(l[u++]=p[0],l[u++]=p[1],d=!1):d=!0,c=p[0],f=p[1],_=g;return(a&&d||v===e+o)&&(l[u++]=c,l[u++]=f),u},r.prototype.drawCustomCoordinates_=function(t,e,n,o,a){for(var s=0,l=n.length;s<l;++s){var u=n[s],h=this.appendFlatLineCoordinates(t,e,u,o,!1,!1);a.push(h),e=u}return e},r.prototype.drawCustom=function(t,e,n,o){this.beginGeometry(t,e);var a=t.getType(),s=t.getStride(),l=this.coordinates.length,u,h,c,f,p;switch(a){case GeometryType.MULTI_POLYGON:u=t.getOrientedFlatCoordinates(),f=[];var d=t.getEndss();p=0;for(var v=0,_=d.length;v<_;++v){var g=[];p=this.drawCustomCoordinates_(u,p,d[v],s,g),f.push(g)}this.instructions.push([CanvasInstruction.CUSTOM,l,f,t,n,inflateMultiCoordinatesArray]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,f,t,o||n,inflateMultiCoordinatesArray]);break;case GeometryType.POLYGON:case GeometryType.MULTI_LINE_STRING:c=[],u=a==GeometryType.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),p=this.drawCustomCoordinates_(u,0,t.getEnds(),s,c),this.instructions.push([CanvasInstruction.CUSTOM,l,c,t,n,inflateCoordinatesArray]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,c,t,o||n,inflateCoordinatesArray]);break;case GeometryType.LINE_STRING:case GeometryType.CIRCLE:u=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(u,0,u.length,s,!1,!1),this.instructions.push([CanvasInstruction.CUSTOM,l,h,t,n,inflateCoordinates]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,h,t,o||n,inflateCoordinates]);break;case GeometryType.MULTI_POINT:u=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(u,s),h>l&&(this.instructions.push([CanvasInstruction.CUSTOM,l,h,t,n,inflateCoordinates]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,h,t,o||n,inflateCoordinates]));break;case GeometryType.POINT:u=t.getFlatCoordinates(),this.coordinates.push(u[0],u[1]),h=this.coordinates.length,this.instructions.push([CanvasInstruction.CUSTOM,l,h,t,n]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,l,h,t,o||n]);break}this.endGeometry(e)},r.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[CanvasInstruction.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[CanvasInstruction.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},r.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},r.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var e,n=t.length,o,a,s=-1;for(e=0;e<n;++e)o=t[e],a=o[0],a==CanvasInstruction.END_GEOMETRY?s=e:a==CanvasInstruction.BEGIN_GEOMETRY&&(o[2]=e,reverseSubArray(this.hitDetectionInstructions,s,e),s=-1)},r.prototype.setFillStrokeStyle=function(t,e){var n=this.state;if(t){var o=t.getColor();n.fillStyle=asColorLike(o||defaultFillStyle)}else n.fillStyle=void 0;if(e){var a=e.getColor();n.strokeStyle=asColorLike(a||defaultStrokeStyle);var s=e.getLineCap();n.lineCap=s!==void 0?s:defaultLineCap;var l=e.getLineDash();n.lineDash=l?l.slice():defaultLineDash;var u=e.getLineDashOffset();n.lineDashOffset=u||defaultLineDashOffset;var h=e.getLineJoin();n.lineJoin=h!==void 0?h:defaultLineJoin;var c=e.getWidth();n.lineWidth=c!==void 0?c:defaultLineWidth;var f=e.getMiterLimit();n.miterLimit=f!==void 0?f:defaultMiterLimit,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0},r.prototype.createFill=function(t){var e=t.fillStyle,n=[CanvasInstruction.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(!0),n},r.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},r.prototype.createStroke=function(t){return[CanvasInstruction.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},r.prototype.updateFillStyle=function(t,e){var n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)},r.prototype.updateStrokeStyle=function(t,e){var n=t.strokeStyle,o=t.lineCap,a=t.lineDash,s=t.lineDashOffset,l=t.lineJoin,u=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=o||a!=t.currentLineDash&&!equals$2(t.currentLineDash,a)||t.currentLineDashOffset!=s||t.currentLineJoin!=l||t.currentLineWidth!=u||t.currentMiterLimit!=h)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=o,t.currentLineDash=a,t.currentLineDashOffset=s,t.currentLineJoin=l,t.currentLineWidth=u,t.currentMiterLimit=h)},r.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[CanvasInstruction.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},r.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},r}(VectorContext$1),Builder=CanvasBuilder,__extends$u=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasImageBuilder=function(i){__extends$u(r,i);function r(t,e,n,o){var a=i.call(this,t,e,n,o)||this;return a.hitDetectionImage_=null,a.image_=null,a.imagePixelRatio_=void 0,a.anchorX_=void 0,a.anchorY_=void 0,a.height_=void 0,a.opacity_=void 0,a.originX_=void 0,a.originY_=void 0,a.rotateWithView_=void 0,a.rotation_=void 0,a.scale_=void 0,a.width_=void 0,a.declutterImageWithText_=void 0,a}return r.prototype.drawPoint=function(t,e){if(!!this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),o=t.getStride(),a=this.coordinates.length,s=this.appendFlatPointCoordinates(n,o);this.instructions.push([CanvasInstruction.DRAW_IMAGE,a,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,a,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},r.prototype.drawMultiPoint=function(t,e){if(!!this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),o=t.getStride(),a=this.coordinates.length,s=this.appendFlatPointCoordinates(n,o);this.instructions.push([CanvasInstruction.DRAW_IMAGE,a,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,a,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},r.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,i.prototype.finish.call(this)},r.prototype.setImageStyle=function(t,e){var n=t.getAnchor(),o=t.getSize(),a=t.getHitDetectionImage(),s=t.getImage(this.pixelRatio),l=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=a,this.image_=s,this.height_=o[1],this.opacity_=t.getOpacity(),this.originX_=l[0]*this.imagePixelRatio_,this.originY_=l[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=o[0],this.declutterImageWithText_=e},r}(Builder),ImageBuilder=CanvasImageBuilder,__extends$t=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasLineStringBuilder=function(i){__extends$t(r,i);function r(t,e,n,o){return i.call(this,t,e,n,o)||this}return r.prototype.drawFlatCoordinates_=function(t,e,n,o){var a=this.coordinates.length,s=this.appendFlatLineCoordinates(t,e,n,o,!1,!1),l=[CanvasInstruction.MOVE_TO_LINE_TO,a,s];return this.instructions.push(l),this.hitDetectionInstructions.push(l),n},r.prototype.drawLineString=function(t,e){var n=this.state,o=n.strokeStyle,a=n.lineWidth;if(!(o===void 0||a===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);var s=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(s,0,s.length,l),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(e)}},r.prototype.drawMultiLineString=function(t,e){var n=this.state,o=n.strokeStyle,a=n.lineWidth;if(!(o===void 0||a===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],beginPathInstruction);for(var s=t.getEnds(),l=t.getFlatCoordinates(),u=t.getStride(),h=0,c=0,f=s.length;c<f;++c)h=this.drawFlatCoordinates_(l,h,s[c],u);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(e)}},r.prototype.finish=function(){var t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,i.prototype.finish.call(this)},r.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),t.lastStroke=this.coordinates.length),t.lastStroke=0,i.prototype.applyStroke.call(this,t),this.instructions.push(beginPathInstruction)},r}(Builder),LineStringBuilder=CanvasLineStringBuilder,__extends$s=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasPolygonBuilder=function(i){__extends$s(r,i);function r(t,e,n,o){return i.call(this,t,e,n,o)||this}return r.prototype.drawFlatCoordinatess_=function(t,e,n,o){var a=this.state,s=a.fillStyle!==void 0,l=a.strokeStyle!==void 0,u=n.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(var h=0;h<u;++h){var c=n[h],f=this.coordinates.length,p=this.appendFlatLineCoordinates(t,e,c,o,!0,!l),d=[CanvasInstruction.MOVE_TO_LINE_TO,f,p];this.instructions.push(d),this.hitDetectionInstructions.push(d),l&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),e=c}return s&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),l&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),e},r.prototype.drawCircle=function(t,e){var n=this.state,o=n.fillStyle,a=n.strokeStyle;if(!(o===void 0&&a===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var s=t.getFlatCoordinates(),l=t.getStride(),u=this.coordinates.length;this.appendFlatLineCoordinates(s,0,s.length,l,!1,!1);var h=[CanvasInstruction.CIRCLE,u];this.instructions.push(beginPathInstruction,h),this.hitDetectionInstructions.push(beginPathInstruction,h),n.fillStyle!==void 0&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),n.strokeStyle!==void 0&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(e)}},r.prototype.drawPolygon=function(t,e){var n=this.state,o=n.fillStyle,a=n.strokeStyle;if(!(o===void 0&&a===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var s=t.getEnds(),l=t.getOrientedFlatCoordinates(),u=t.getStride();this.drawFlatCoordinatess_(l,0,s,u),this.endGeometry(e)}},r.prototype.drawMultiPolygon=function(t,e){var n=this.state,o=n.fillStyle,a=n.strokeStyle;if(!(o===void 0&&a===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);for(var s=t.getEndss(),l=t.getOrientedFlatCoordinates(),u=t.getStride(),h=0,c=0,f=s.length;c<f;++c)h=this.drawFlatCoordinatess_(l,h,s[c],u);this.endGeometry(e)}},r.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0)for(var e=this.coordinates,n=0,o=e.length;n<o;++n)e[n]=snap(e[n],t);return i.prototype.finish.call(this)},r.prototype.setFillStrokeStyles_=function(){var t=this.state,e=t.fillStyle;e!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)},r}(Builder),PolygonBuilder=CanvasPolygonBuilder,TextPlacement={POINT:"point",LINE:"line"};function matchingChunk(i,r,t,e,n){var o=t,a=t,s=0,l=0,u=t,h,c,f,p,d,v,_,g,y,m;for(c=t;c<e;c+=n){var E=r[c],T=r[c+1];d!==void 0&&(y=E-d,m=T-v,p=Math.sqrt(y*y+m*m),_!==void 0&&(l+=f,h=Math.acos((_*y+g*m)/(f*p)),h>i&&(l>s&&(s=l,o=u,a=c),l=0,u=c-n)),f=p,_=y,g=m),d=E,v=T}return l+=p,l>s?[u,c]:[o,a]}var __extends$r=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),TEXT_ALIGN={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},CanvasTextBuilder=function(i){__extends$r(r,i);function r(t,e,n,o){var a=i.call(this,t,e,n,o)||this;return a.labels_=null,a.text_="",a.textOffsetX_=0,a.textOffsetY_=0,a.textRotateWithView_=void 0,a.textRotation_=0,a.textFillState_=null,a.fillStates={},a.textStrokeState_=null,a.strokeStates={},a.textState_={},a.textStates={},a.textKey_="",a.fillKey_="",a.strokeKey_="",a.declutterImageWithText_=void 0,a}return r.prototype.finish=function(){var t=i.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},r.prototype.drawText=function(t,e){var n=this.textFillState_,o=this.textStrokeState_,a=this.textState_;if(!(this.text_===""||!a||!n&&!o)){var s=this.coordinates,l=s.length,u=t.getType(),h=null,c=t.getStride();if(a.placement===TextPlacement.LINE&&(u==GeometryType.LINE_STRING||u==GeometryType.MULTI_LINE_STRING||u==GeometryType.POLYGON||u==GeometryType.MULTI_POLYGON)){if(!intersects$1(this.getBufferedMaxExtent(),t.getExtent()))return;var f=void 0;if(h=t.getFlatCoordinates(),u==GeometryType.LINE_STRING)f=[h.length];else if(u==GeometryType.MULTI_LINE_STRING)f=t.getEnds();else if(u==GeometryType.POLYGON)f=t.getEnds().slice(0,1);else if(u==GeometryType.MULTI_POLYGON){var p=t.getEndss();f=[];for(var d=0,v=p.length;d<v;++d)f.push(p[d][0])}this.beginGeometry(t,e);for(var _=a.textAlign,g=0,y=void 0,m=0,E=f.length;m<E;++m){if(_==null){var T=matchingChunk(a.maxAngle,h,g,f[m],c);g=T[0],y=T[1]}else y=f[m];for(var d=g;d<y;d+=c)s.push(h[d],h[d+1]);var I=s.length;g=f[m],this.drawChars_(l,I),l=I}this.endGeometry(e)}else{var R=a.overflow?null:[];switch(u){case GeometryType.POINT:case GeometryType.MULTI_POINT:h=t.getFlatCoordinates();break;case GeometryType.LINE_STRING:h=t.getFlatMidpoint();break;case GeometryType.CIRCLE:h=t.getCenter();break;case GeometryType.MULTI_LINE_STRING:h=t.getFlatMidpoints(),c=2;break;case GeometryType.POLYGON:h=t.getFlatInteriorPoint(),a.overflow||R.push(h[2]/this.resolution),c=3;break;case GeometryType.MULTI_POLYGON:var C=t.getFlatInteriorPoints();h=[];for(var d=0,v=C.length;d<v;d+=3)a.overflow||R.push(C[d+2]/this.resolution),h.push(C[d],C[d+1]);if(h.length===0)return;c=2;break}var I=this.appendFlatPointCoordinates(h,c);if(I===l)return;if(R&&(I-l)/2!=h.length/c){var S=l/2;R=R.filter(function(G,b){var B=s[(S+b)*2]===h[b*c]&&s[(S+b)*2+1]===h[b*c+1];return B||--S,B})}this.saveTextStates_(),(a.backgroundFill||a.backgroundStroke)&&(this.setFillStrokeStyle(a.backgroundFill,a.backgroundStroke),a.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),a.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var L=a.padding;if(L!=defaultPadding&&(a.scale[0]<0||a.scale[1]<0)){var O=a.padding[0],P=a.padding[1],D=a.padding[2],N=a.padding[3];a.scale[0]<0&&(P=-P,N=-N),a.scale[1]<0&&(O=-O,D=-D),L=[O,P,D,N]}var A=this.pixelRatio;this.instructions.push([CanvasInstruction.DRAW_IMAGE,l,I,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,L==defaultPadding?defaultPadding:L.map(function(G){return G*A}),!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,R]);var M=1/A;this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,l,I,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[M,M],NaN,this.declutterImageWithText_,L,!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,R]),this.endGeometry(e)}}},r.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,o=this.strokeKey_;t&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var a=this.textKey_;a in this.textStates||(this.textStates[a]={font:e.font,textAlign:e.textAlign||defaultTextAlign,textBaseline:e.textBaseline||defaultTextBaseline,scale:e.scale});var s=this.fillKey_;n&&(s in this.fillStates||(this.fillStates[s]={fillStyle:n.fillStyle}))},r.prototype.drawChars_=function(t,e){var n=this.textStrokeState_,o=this.textState_,a=this.strokeKey_,s=this.textKey_,l=this.fillKey_;this.saveTextStates_();var u=this.pixelRatio,h=TEXT_ALIGN[o.textBaseline],c=this.textOffsetY_*u,f=this.text_,p=n?n.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([CanvasInstruction.DRAW_CHARS,t,e,h,o.overflow,l,o.maxAngle,u,c,a,p*u,f,s,1]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_CHARS,t,e,h,o.overflow,l,o.maxAngle,1,c,a,p,f,s,1/u])},r.prototype.setTextStyle=function(t,e){var n,o,a;if(!t)this.text_="";else{var s=t.getFill();s?(o=this.textFillState_,o||(o={},this.textFillState_=o),o.fillStyle=asColorLike(s.getColor()||defaultFillStyle)):(o=null,this.textFillState_=o);var l=t.getStroke();if(!l)a=null,this.textStrokeState_=a;else{a=this.textStrokeState_,a||(a={},this.textStrokeState_=a);var u=l.getLineDash(),h=l.getLineDashOffset(),c=l.getWidth(),f=l.getMiterLimit();a.lineCap=l.getLineCap()||defaultLineCap,a.lineDash=u?u.slice():defaultLineDash,a.lineDashOffset=h===void 0?defaultLineDashOffset:h,a.lineJoin=l.getLineJoin()||defaultLineJoin,a.lineWidth=c===void 0?defaultLineWidth:c,a.miterLimit=f===void 0?defaultMiterLimit:f,a.strokeStyle=asColorLike(l.getColor()||defaultStrokeStyle)}n=this.textState_;var p=t.getFont()||defaultFont;registerFont(p);var d=t.getScaleArray();n.overflow=t.getOverflow(),n.font=p,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.textBaseline=t.getTextBaseline()||defaultTextBaseline,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||defaultPadding,n.scale=d===void 0?[1,1]:d;var v=t.getOffsetX(),_=t.getOffsetY(),g=t.getRotateWithView(),y=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=v===void 0?0:v,this.textOffsetY_=_===void 0?0:_,this.textRotateWithView_=g===void 0?!1:g,this.textRotation_=y===void 0?0:y,this.strokeKey_=a?(typeof a.strokeStyle=="string"?a.strokeStyle:getUid(a.strokeStyle))+a.lineCap+a.lineDashOffset+"|"+a.lineWidth+a.lineJoin+a.miterLimit+"["+a.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.textBaseline||"?"),this.fillKey_=o?typeof o.fillStyle=="string"?o.fillStyle:"|"+getUid(o.fillStyle):""}this.declutterImageWithText_=e},r}(Builder),TextBuilder=CanvasTextBuilder,BATCH_CONSTRUCTORS={Circle:PolygonBuilder,Default:Builder,Image:ImageBuilder,LineString:LineStringBuilder,Polygon:PolygonBuilder,Text:TextBuilder},BuilderGroup=function(){function i(r,t,e,n){this.tolerance_=r,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=e,this.buildersByZIndex_={}}return i.prototype.finish=function(){var r={};for(var t in this.buildersByZIndex_){r[t]=r[t]||{};var e=this.buildersByZIndex_[t];for(var n in e){var o=e[n].finish();r[t][n]=o}}return r},i.prototype.getBuilder=function(r,t){var e=r!==void 0?r.toString():"0",n=this.buildersByZIndex_[e];n===void 0&&(n={},this.buildersByZIndex_[e]=n);var o=n[t];if(o===void 0){var a=BATCH_CONSTRUCTORS[t];o=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=o}return o},i}(),CanvasBuilderGroup=BuilderGroup,__extends$q=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),LayerRenderer=function(i){__extends$q(r,i);function r(t){var e=i.call(this)||this;return e.boundHandleImageChange_=e.handleImageChange_.bind(e),e.layer_=t,e.declutterExecutorGroup=null,e}return r.prototype.getFeatures=function(t){return abstract()},r.prototype.prepareFrame=function(t){return abstract()},r.prototype.renderFrame=function(t,e){return abstract()},r.prototype.loadedTileCallback=function(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n},r.prototype.createLoadedTileFinder=function(t,e,n){return function(o,a){var s=this.loadedTileCallback.bind(this,n,o);return t.forEachLoadedTile(e,o,a,s)}.bind(this)},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,o,a){},r.prototype.getDataAtPixel=function(t,e,n){return null},r.prototype.getLayer=function(){return this.layer_},r.prototype.handleFontsChanged=function(){},r.prototype.handleImageChange_=function(t){var e=t.target;e.getState()===ImageState.LOADED&&this.renderIfReadyAndVisible()},r.prototype.loadImage=function(t){var e=t.getState();return e!=ImageState.LOADED&&e!=ImageState.ERROR&&t.addEventListener(EventType.CHANGE,this.boundHandleImageChange_),e==ImageState.IDLE&&(t.load(),e=t.getState()),e==ImageState.LOADED},r.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==State.READY&&t.changed()},r}(Observable$1),LayerRenderer$1=LayerRenderer,__extends$p=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasLayerRenderer=function(i){__extends$p(r,i);function r(t){var e=i.call(this,t)||this;return e.container=null,e.renderedResolution,e.tempTransform=create$2(),e.pixelTransform=create$2(),e.inversePixelTransform=create$2(),e.context=null,e.containerReused=!1,e}return r.prototype.useContainer=function(t,e,n){var o=this.getLayer().getClassName(),a,s;if(t&&t.style.opacity===cssOpacity(n)&&t.className===o){var l=t.firstElementChild;l instanceof HTMLCanvasElement&&(s=l.getContext("2d"))}if(s&&s.canvas.style.transform===e?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){a=document.createElement("div"),a.className=o;var u=a.style;u.position="absolute",u.width="100%",u.height="100%",s=createCanvasContext2D();var l=s.canvas;a.appendChild(l),u=l.style,u.position="absolute",u.left="0",u.transformOrigin="top left",this.container=a,this.context=s}},r.prototype.clipUnrotated=function(t,e,n){var o=getTopLeft(n),a=getTopRight(n),s=getBottomRight(n),l=getBottomLeft(n);apply(e.coordinateToPixelTransform,o),apply(e.coordinateToPixelTransform,a),apply(e.coordinateToPixelTransform,s),apply(e.coordinateToPixelTransform,l);var u=this.inversePixelTransform;apply(u,o),apply(u,a),apply(u,s),apply(u,l),t.save(),t.beginPath(),t.moveTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(l[0]),Math.round(l[1])),t.clip()},r.prototype.dispatchRenderEvent_=function(t,e,n){var o=this.getLayer();if(o.hasListener(t)){var a=new RenderEvent$1(t,this.inversePixelTransform,n,e);o.dispatchEvent(a)}},r.prototype.preRender=function(t,e){this.dispatchRenderEvent_(RenderEventType.PRERENDER,t,e)},r.prototype.postRender=function(t,e){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,t,e)},r.prototype.getRenderTransform=function(t,e,n,o,a,s,l){var u=a/2,h=s/2,c=o/e,f=-c,p=-t[0]+l,d=-t[1];return compose(this.tempTransform,u,h,c,f,-n,p,d)},r.prototype.getDataAtPixel=function(t,e,n){var o=apply(this.inversePixelTransform,t.slice()),a=this.context,s=this.getLayer(),l=s.getExtent();if(l){var u=apply(e.pixelToCoordinateTransform,t.slice());if(!containsCoordinate(l,u))return null}var h;try{var c=Math.round(o[0]),f=Math.round(o[1]),p=document.createElement("canvas"),d=p.getContext("2d");p.width=1,p.height=1,d.clearRect(0,0,1,1),d.drawImage(a.canvas,c,f,1,1,0,0,1,1),h=d.getImageData(0,0,1,1).data}catch(v){return v.name==="SecurityError"?new Uint8Array:h}return h[3]===0?null:h},r}(LayerRenderer$1),CanvasLayerRenderer$1=CanvasLayerRenderer,ReplayType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function drawTextOnPath(i,r,t,e,n,o,a,s,l,u,h,c){var f=i[r],p=i[r+1],d=0,v=0,_=0,g=0;function y(){d=f,v=p,r+=e,f=i[r],p=i[r+1],g+=_,_=Math.sqrt((f-d)*(f-d)+(p-v)*(p-v))}do y();while(r<t-e&&g+_<o);for(var m=_===0?0:(o-g)/_,E=lerp(d,f,m),T=lerp(v,p,m),I=r-e,R=g,C=o+s*l(u,n,h);r<t-e&&g+_<C;)y();m=_===0?0:(C-g)/_;var S=lerp(d,f,m),L=lerp(v,p,m),O;if(c){var P=[E,T,S,L];rotate(P,0,4,2,c,P,P),O=P[0]>P[2]}else O=E>S;var D=Math.PI,N=[],A=I+e===r;r=I,_=0,g=R,f=i[r],p=i[r+1];var M;if(A){y(),M=Math.atan2(p-v,f-d),O&&(M+=M>0?-D:D);var w=(S+E)/2,G=(L+T)/2;return N[0]=[w,G,(C-o)/2,M,n],N}for(var b=0,B=n.length;b<B;){y();var U=Math.atan2(p-v,f-d);if(O&&(U+=U>0?-D:D),M!==void 0){var x=U-M;if(x+=x>D?-2*D:x<-D?2*D:0,Math.abs(x)>a)return null}M=U;for(var k=b,F=0;b<B;++b){var $=O?B-b-1:b,W=s*l(u,n[$],h);if(r+e<t&&g+_<o+F+W/2)break;F+=W}if(b!==k){var V=O?n.substring(B-k,B-b):n.substring(k,b);m=_===0?0:(o+F/2-g)/_;var w=lerp(d,f,m),G=lerp(v,p,m);N.push([w,G,F/2,U,V]),o+=F}}return N}var tmpExtent=createEmpty(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(i){return i[3].declutterBox}var rtlRegEx=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function horizontalTextAlign(i,r){return(r==="start"||r==="end")&&!rtlRegEx.test(i)&&(r=r==="start"?"left":"right"),TEXT_ALIGN[r]}var Executor=function(){function i(r,t,e,n){this.overlaps=e,this.pixelRatio=t,this.resolution=r,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=create$2(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return i.prototype.createLabel=function(r,t,e,n){var o=r+t+e+n;if(this.labels_[o])return this.labels_[o];var a=n?this.strokeStates[n]:null,s=e?this.fillStates[e]:null,l=this.textStates[t],u=this.pixelRatio,h=[l.scale[0]*u,l.scale[1]*u],c=horizontalTextAlign(r,l.textAlign||defaultTextAlign),f=n&&a.lineWidth?a.lineWidth:0,p=r.split(`
`),d=p.length,v=[],_=measureTextWidths(l.font,p,v),g=measureTextHeight(l.font),y=g*d,m=_+f,E=[],T=(m+2)*h[0],I=(y+f)*h[1],R={width:T<0?Math.floor(T):Math.ceil(T),height:I<0?Math.floor(I):Math.ceil(I),contextInstructions:E};if((h[0]!=1||h[1]!=1)&&E.push("scale",h),E.push("font",l.font),n){E.push("strokeStyle",a.strokeStyle),E.push("lineWidth",f),E.push("lineCap",a.lineCap),E.push("lineJoin",a.lineJoin),E.push("miterLimit",a.miterLimit);var C=WORKER_OFFSCREEN_CANVAS?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;C.prototype.setLineDash&&(E.push("setLineDash",[a.lineDash]),E.push("lineDashOffset",a.lineDashOffset))}e&&E.push("fillStyle",s.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");var S=.5-c,L=c*m+S*f,O;if(n)for(O=0;O<d;++O)E.push("strokeText",[p[O],L+S*v[O],.5*(f+g)+O*g]);if(e)for(O=0;O<d;++O)E.push("fillText",[p[O],L+S*v[O],.5*(f+g)+O*g]);return this.labels_[o]=R,R},i.prototype.replayTextBackground_=function(r,t,e,n,o,a,s){r.beginPath(),r.moveTo.apply(r,t),r.lineTo.apply(r,e),r.lineTo.apply(r,n),r.lineTo.apply(r,o),r.lineTo.apply(r,t),a&&(this.alignFill_=a[2],this.fill_(r)),s&&(this.setStrokeStyle_(r,s),r.stroke())},i.prototype.calculateImageOrLabelDimensions_=function(r,t,e,n,o,a,s,l,u,h,c,f,p,d,v,_){s*=f[0],l*=f[1];var g=e-s,y=n-l,m=o+u>r?r-u:o,E=a+h>t?t-h:a,T=d[3]+m*f[0]+d[1],I=d[0]+E*f[1]+d[2],R=g-d[3],C=y-d[0];(v||c!==0)&&(p1[0]=R,p4[0]=R,p1[1]=C,p2[1]=C,p2[0]=R+T,p3[0]=p2[0],p3[1]=C+I,p4[1]=p3[1]);var S;return c!==0?(S=compose(create$2(),e,n,1,1,c,-e,-n),apply(S,p1),apply(S,p2),apply(S,p3),apply(S,p4),createOrUpdate$2(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):createOrUpdate$2(Math.min(R,R+T),Math.min(C,C+I),Math.max(R,R+T),Math.max(C,C+I),tmpExtent),p&&(g=Math.round(g),y=Math.round(y)),{drawImageX:g,drawImageY:y,drawImageW:m,drawImageH:E,originX:u,originY:h,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:_},canvasTransform:S,scale:f}},i.prototype.replayImageOrLabel_=function(r,t,e,n,o,a,s){var l=!!(a||s),u=n.declutterBox,h=r.canvas,c=s?s[2]*n.scale[0]/2:0,f=u.minX-c<=h.width/t&&u.maxX+c>=0&&u.minY-c<=h.height/t&&u.maxY+c>=0;return f&&(l&&this.replayTextBackground_(r,p1,p2,p3,p4,a,s),drawImageOrLabel(r,n.canvasTransform,o,e,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},i.prototype.fill_=function(r){if(this.alignFill_){var t=apply(this.renderedTransform_,[0,0]),e=512*this.pixelRatio;r.save(),r.translate(t[0]%e,t[1]%e),r.rotate(this.viewRotation_)}r.fill(),this.alignFill_&&r.restore()},i.prototype.setStrokeStyle_=function(r,t){r.strokeStyle=t[1],r.lineWidth=t[2],r.lineCap=t[3],r.lineJoin=t[4],r.miterLimit=t[5],r.setLineDash&&(r.lineDashOffset=t[7],r.setLineDash(t[6]))},i.prototype.drawLabelWithPointPlacement_=function(r,t,e,n){var o=this.textStates[t],a=this.createLabel(r,t,n,e),s=this.strokeStates[e],l=this.pixelRatio,u=horizontalTextAlign(r,o.textAlign||defaultTextAlign),h=TEXT_ALIGN[o.textBaseline||defaultTextBaseline],c=s&&s.lineWidth?s.lineWidth:0,f=a.width/l-2*o.scale[0],p=u*f+2*(.5-u)*c,d=h*a.height/l+2*(.5-h)*c;return{label:a,anchorX:p,anchorY:d}},i.prototype.execute_=function(r,t,e,n,o,a,s,l){var u;this.pixelCoordinates_&&equals$2(e,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=transform2D(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),setFromArray(this.renderedTransform_,e));for(var h=0,c=n.length,f=0,p,d,v,_,g,y,m,E,T,I,R,C,S=0,L=0,O=null,P=null,D=this.coordinateCache_,N=this.viewRotation_,A=Math.round(Math.atan2(-e[1],e[0])*1e12)/1e12,M={context:r,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:N},w=this.instructions!=n||this.overlaps?0:200,G,b,B,U;h<c;){var x=n[h],k=x[0];switch(k){case CanvasInstruction.BEGIN_GEOMETRY:G=x[1],U=x[3],G.getGeometry()?s!==void 0&&!intersects$1(s,U.getExtent())?h=x[2]+1:++h:h=x[2];break;case CanvasInstruction.BEGIN_PATH:S>w&&(this.fill_(r),S=0),L>w&&(r.stroke(),L=0),!S&&!L&&(r.beginPath(),_=NaN,g=NaN),++h;break;case CanvasInstruction.CIRCLE:f=x[1];var F=u[f],$=u[f+1],W=u[f+2],V=u[f+3],X=W-F,Y=V-$,ot=Math.sqrt(X*X+Y*Y);r.moveTo(F+ot,$),r.arc(F,$,ot,0,2*Math.PI,!0),++h;break;case CanvasInstruction.CLOSE_PATH:r.closePath(),++h;break;case CanvasInstruction.CUSTOM:f=x[1],p=x[2];var Z=x[3],mt=x[4],Et=x.length==6?x[5]:void 0;M.geometry=Z,M.feature=G,h in D||(D[h]=[]);var J=D[h];Et?Et(u,f,p,2,J):(J[0]=u[f],J[1]=u[f+1],J.length=2),mt(J,M),++h;break;case CanvasInstruction.DRAW_IMAGE:f=x[1],p=x[2],E=x[3],d=x[4],v=x[5];var at=x[6],Tt=x[7],ct=x[8],xt=x[9],rt=x[10],ft=x[11],Rt=x[12],st=x[13],Q=x[14];if(!E&&x.length>=19){T=x[18],I=x[19],R=x[20],C=x[21];var lt=this.drawLabelWithPointPlacement_(T,I,R,C);E=lt.label,x[3]=E;var Lt=x[22];d=(lt.anchorX-Lt)*this.pixelRatio,x[4]=d;var Ct=x[23];v=(lt.anchorY-Ct)*this.pixelRatio,x[5]=v,at=E.height,x[6]=at,st=E.width,x[13]=st}var pt=void 0;x.length>24&&(pt=x[24]);var tt=void 0,q=void 0,nt=void 0;x.length>16?(tt=x[15],q=x[16],nt=x[17]):(tt=defaultPadding,q=!1,nt=!1),rt&&A?ft+=N:!rt&&!A&&(ft-=N);for(var ut=0;f<p;f+=2)if(!(pt&&pt[ut++]<st/this.pixelRatio)){var K=this.calculateImageOrLabelDimensions_(E.width,E.height,u[f],u[f+1],st,at,d,v,ct,xt,ft,Rt,o,tt,q||nt,G),H=[r,t,E,K,Tt,q?O:null,nt?P:null],it=void 0,ht=void 0;if(l&&Q){var It=p-f;if(!Q[It]){Q[It]=H;continue}if(it=Q[It],delete Q[It],ht=getDeclutterBox(it),l.collides(ht))continue}l&&l.collides(K.declutterBox)||(it&&(l&&l.insert(ht),this.replayImageOrLabel_.apply(this,it)),l&&l.insert(K.declutterBox),this.replayImageOrLabel_.apply(this,H))}++h;break;case CanvasInstruction.DRAW_CHARS:var Mt=x[1],Ft=x[2],wt=x[3],Vt=x[4];C=x[5];var Yt=x[6],Nt=x[7],bt=x[8];R=x[9];var Pt=x[10];T=x[11],I=x[12];var Gt=[x[13],x[13]],At=this.textStates[I],dt=At.font,vt=[At.scale[0]*Nt,At.scale[1]*Nt],_t=void 0;dt in this.widths_?_t=this.widths_[dt]:(_t={},this.widths_[dt]=_t);var Bt=lineStringLength(u,Mt,Ft,2),Ut=Math.abs(vt[0])*measureAndCacheTextWidth(dt,T,_t);if(Vt||Ut<=Bt){var zt=this.textStates[I].textAlign,Kt=(Bt-Ut)*TEXT_ALIGN[zt],gt=drawTextOnPath(u,Mt,Ft,2,T,Kt,Yt,Math.abs(vt[0]),measureAndCacheTextWidth,dt,_t,A?0:this.viewRotation_);t:if(gt){var yt=[],et=void 0,St=void 0,Ot=void 0,j=void 0,z=void 0;if(R)for(et=0,St=gt.length;et<St;++et){z=gt[et],Ot=z[4],j=this.createLabel(Ot,I,"",R),d=z[2]+(vt[0]<0?-Pt:Pt),v=wt*j.height+(.5-wt)*2*Pt*vt[1]/vt[0]-bt;var K=this.calculateImageOrLabelDimensions_(j.width,j.height,z[0],z[1],j.width,j.height,d,v,0,0,z[3],Gt,!1,defaultPadding,!1,G);if(l&&l.collides(K.declutterBox))break t;yt.push([r,t,j,K,1,null,null])}if(C)for(et=0,St=gt.length;et<St;++et){z=gt[et],Ot=z[4],j=this.createLabel(Ot,I,C,""),d=z[2],v=wt*j.height-bt;var K=this.calculateImageOrLabelDimensions_(j.width,j.height,z[0],z[1],j.width,j.height,d,v,0,0,z[3],Gt,!1,defaultPadding,!1,G);if(l&&l.collides(K.declutterBox))break t;yt.push([r,t,j,K,1,null,null])}l&&l.load(yt.map(getDeclutterBox));for(var Dt=0,Ht=yt.length;Dt<Ht;++Dt)this.replayImageOrLabel_.apply(this,yt[Dt])}}++h;break;case CanvasInstruction.END_GEOMETRY:if(a!==void 0){G=x[1];var $t=a(G,U);if($t)return $t}++h;break;case CanvasInstruction.FILL:w?S++:this.fill_(r),++h;break;case CanvasInstruction.MOVE_TO_LINE_TO:for(f=x[1],p=x[2],b=u[f],B=u[f+1],y=b+.5|0,m=B+.5|0,(y!==_||m!==g)&&(r.moveTo(b,B),_=y,g=m),f+=2;f<p;f+=2)b=u[f],B=u[f+1],y=b+.5|0,m=B+.5|0,(f==p-2||y!==_||m!==g)&&(r.lineTo(b,B),_=y,g=m);++h;break;case CanvasInstruction.SET_FILL_STYLE:O=x,this.alignFill_=x[2],S&&(this.fill_(r),S=0,L&&(r.stroke(),L=0)),r.fillStyle=x[1],++h;break;case CanvasInstruction.SET_STROKE_STYLE:P=x,L&&(r.stroke(),L=0),this.setStrokeStyle_(r,x),++h;break;case CanvasInstruction.STROKE:w?L++:r.stroke(),++h;break;default:++h;break}}S&&this.fill_(r),L&&r.stroke()},i.prototype.execute=function(r,t,e,n,o,a){this.viewRotation_=n,this.execute_(r,t,e,this.instructions,o,void 0,void 0,a)},i.prototype.executeHitDetection=function(r,t,e,n,o){return this.viewRotation_=e,this.execute_(r,1,t,this.hitDetectionInstructions,!0,n,o)},i}(),Executor$1=Executor,ORDER=[ReplayType.POLYGON,ReplayType.CIRCLE,ReplayType.LINE_STRING,ReplayType.IMAGE,ReplayType.TEXT,ReplayType.DEFAULT],ExecutorGroup=function(){function i(r,t,e,n,o,a){this.maxExtent_=r,this.overlaps_=n,this.pixelRatio_=e,this.resolution_=t,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=create$2(),this.createExecutors_(o)}return i.prototype.clip=function(r,t){var e=this.getClipCoords(t);r.beginPath(),r.moveTo(e[0],e[1]),r.lineTo(e[2],e[3]),r.lineTo(e[4],e[5]),r.lineTo(e[6],e[7]),r.clip()},i.prototype.createExecutors_=function(r){for(var t in r){var e=this.executorsByZIndex_[t];e===void 0&&(e={},this.executorsByZIndex_[t]=e);var n=r[t];for(var o in n){var a=n[o];e[o]=new Executor$1(this.resolution_,this.pixelRatio_,this.overlaps_,a)}}},i.prototype.hasExecutors=function(r){for(var t in this.executorsByZIndex_)for(var e=this.executorsByZIndex_[t],n=0,o=r.length;n<o;++n)if(r[n]in e)return!0;return!1},i.prototype.forEachFeatureAtCoordinate=function(r,t,e,n,o,a){n=Math.round(n);var s=n*2+1,l=compose(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-e,-r[0],-r[1]),u=!this.hitDetectionContext_;u&&(this.hitDetectionContext_=createCanvasContext2D(s,s));var h=this.hitDetectionContext_;h.canvas.width!==s||h.canvas.height!==s?(h.canvas.width=s,h.canvas.height=s):u||h.clearRect(0,0,s,s);var c;this.renderBuffer_!==void 0&&(c=createEmpty(),extendCoordinate(c,r),buffer(c,t*(this.renderBuffer_+n),c));var f=getPixelIndexArray(n),p;function d(I,R){for(var C=h.getImageData(0,0,s,s).data,S=0,L=f.length;S<L;S++)if(C[f[S]]>0){if(!a||p!==ReplayType.IMAGE&&p!==ReplayType.TEXT||a.indexOf(I)!==-1){var O=(f[S]-3)/4,P=n-O%s,D=n-(O/s|0),N=o(I,R,P*P+D*D);if(N)return N}h.clearRect(0,0,s,s);break}}var v=Object.keys(this.executorsByZIndex_).map(Number);v.sort(numberSafeCompareFunction);var _,g,y,m,E;for(_=v.length-1;_>=0;--_){var T=v[_].toString();for(y=this.executorsByZIndex_[T],g=ORDER.length-1;g>=0;--g)if(p=ORDER[g],m=y[p],m!==void 0&&(E=m.executeHitDetection(h,l,e,d,c),E))return E}},i.prototype.getClipCoords=function(r){var t=this.maxExtent_;if(!t)return null;var e=t[0],n=t[1],o=t[2],a=t[3],s=[e,n,e,a,o,a,o,n];return transform2D(s,0,8,2,r,s),s},i.prototype.isEmpty=function(){return isEmpty(this.executorsByZIndex_)},i.prototype.execute=function(r,t,e,n,o,a,s){var l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(numberSafeCompareFunction),this.maxExtent_&&(r.save(),this.clip(r,e));var u=a||ORDER,h,c,f,p,d,v;for(s&&l.reverse(),h=0,c=l.length;h<c;++h){var _=l[h].toString();for(d=this.executorsByZIndex_[_],f=0,p=u.length;f<p;++f){var g=u[f];v=d[g],v!==void 0&&v.execute(r,t,e,n,o,s)}}this.maxExtent_&&r.restore()},i}(),circlePixelIndexArrayCache={};function getPixelIndexArray(i){if(circlePixelIndexArrayCache[i]!==void 0)return circlePixelIndexArrayCache[i];for(var r=i*2+1,t=i*i,e=new Array(t+1),n=0;n<=i;++n)for(var o=0;o<=i;++o){var a=n*n+o*o;if(a>t)break;var s=e[a];s||(s=[],e[a]=s),s.push(((i+n)*r+(i+o))*4+3),n>0&&s.push(((i-n)*r+(i+o))*4+3),o>0&&(s.push(((i+n)*r+(i-o))*4+3),n>0&&s.push(((i-n)*r+(i-o))*4+3))}for(var l=[],n=0,u=e.length;n<u;++n)e[n]&&l.push.apply(l,e[n]);return circlePixelIndexArrayCache[i]=l,l}var CanvasExecutorGroup=ExecutorGroup,__extends$o=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasImmediateRenderer=function(i){__extends$o(r,i);function r(t,e,n,o,a,s,l){var u=i.call(this)||this;return u.context_=t,u.pixelRatio_=e,u.extent_=n,u.transform_=o,u.viewRotation_=a,u.squaredTolerance_=s,u.userTransform_=l,u.contextFillState_=null,u.contextStrokeState_=null,u.contextTextState_=null,u.fillState_=null,u.strokeState_=null,u.image_=null,u.imageAnchorX_=0,u.imageAnchorY_=0,u.imageHeight_=0,u.imageOpacity_=0,u.imageOriginX_=0,u.imageOriginY_=0,u.imageRotateWithView_=!1,u.imageRotation_=0,u.imageScale_=[0,0],u.imageWidth_=0,u.text_="",u.textOffsetX_=0,u.textOffsetY_=0,u.textRotateWithView_=!1,u.textRotation_=0,u.textScale_=[0,0],u.textFillState_=null,u.textStrokeState_=null,u.textState_=null,u.pixelCoordinates_=[],u.tmpLocalTransform_=create$2(),u}return r.prototype.drawImages_=function(t,e,n,o){if(!!this.image_){var a=transform2D(t,e,n,o,this.transform_,this.pixelCoordinates_),s=this.context_,l=this.tmpLocalTransform_,u=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=u*this.imageOpacity_);var h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(var c=0,f=a.length;c<f;c+=2){var p=a[c]-this.imageAnchorX_,d=a[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var v=p+this.imageAnchorX_,_=d+this.imageAnchorY_;compose(l,v,_,1,1,h,-v,-_),s.setTransform.apply(s,l),s.translate(v,_),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.setTransform(1,0,0,1,0,0)}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=u)}},r.prototype.drawText_=function(t,e,n,o){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var a=transform2D(t,e,n,o,this.transform_,this.pixelCoordinates_),s=this.context_,l=this.textRotation_;for(this.textRotateWithView_&&(l+=this.viewRotation_);e<n;e+=o){var u=a[e]+this.textOffsetX_,h=a[e+1]+this.textOffsetY_;if(l!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var c=compose(this.tmpLocalTransform_,u,h,1,1,l,-u,-h);s.setTransform.apply(s,c),s.translate(u,h),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&s.strokeText(this.text_,u,h),this.textFillState_&&s.fillText(this.text_,u,h)}}},r.prototype.moveToLineTo_=function(t,e,n,o,a){var s=this.context_,l=transform2D(t,e,n,o,this.transform_,this.pixelCoordinates_);s.moveTo(l[0],l[1]);var u=l.length;a&&(u-=2);for(var h=2;h<u;h+=2)s.lineTo(l[h],l[h+1]);return a&&s.closePath(),n},r.prototype.drawRings_=function(t,e,n,o){for(var a=0,s=n.length;a<s;++a)e=this.moveToLineTo_(t,e,n[a],o,!0);return e},r.prototype.drawCircle=function(t){if(!!intersects$1(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=transformGeom2D(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],o=e[3]-e[1],a=Math.sqrt(n*n+o*o),s=this.context_;s.beginPath(),s.arc(e[0],e[1],a,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},r.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},r.prototype.setTransform=function(t){this.transform_=t},r.prototype.drawGeometry=function(t){var e=t.getType();switch(e){case GeometryType.POINT:this.drawPoint(t);break;case GeometryType.LINE_STRING:this.drawLineString(t);break;case GeometryType.POLYGON:this.drawPolygon(t);break;case GeometryType.MULTI_POINT:this.drawMultiPoint(t);break;case GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case GeometryType.MULTI_POLYGON:this.drawMultiPolygon(t);break;case GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case GeometryType.CIRCLE:this.drawCircle(t);break}},r.prototype.drawFeature=function(t,e){var n=e.getGeometryFunction()(t);!n||!intersects$1(this.extent_,n.getExtent())||(this.setStyle(e),this.drawGeometry(n))},r.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),n=0,o=e.length;n<o;++n)this.drawGeometry(e[n])},r.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)},r.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)},r.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){var o=t.getFlatMidpoint();this.drawText_(o,0,2,2)}}},r.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(!!intersects$1(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var n=this.context_,o=t.getFlatCoordinates(),a=0,s=t.getEnds(),l=t.getStride();n.beginPath();for(var u=0,h=s.length;u<h;++u)a=this.moveToLineTo_(o,a,s[u],l,!1);n.stroke()}if(this.text_!==""){var c=t.getFlatMidpoints();this.drawText_(c,0,c.length,2)}}},r.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var n=t.getFlatInteriorPoint();this.drawText_(n,0,2,2)}}},r.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getOrientedFlatCoordinates(),o=0,a=t.getEndss(),s=t.getStride();e.beginPath();for(var l=0,u=a.length;l<u;++l){var h=a[l];o=this.drawRings_(n,o,h,s)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var c=t.getFlatInteriorPoints();this.drawText_(c,0,c.length,2)}}},r.prototype.setContextFillState_=function(t){var e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},r.prototype.setContextStrokeState_=function(t){var e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(equals$2(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},r.prototype.setContextTextState_=function(t){var e=this.context_,n=this.contextTextState_,o=t.textAlign?t.textAlign:defaultTextAlign;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=o&&(n.textAlign=o,e.textAlign=o),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=o,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:o,textBaseline:t.textBaseline})},r.prototype.setFillStrokeStyle=function(t,e){var n=this;if(!t)this.fillState_=null;else{var o=t.getColor();this.fillState_={fillStyle:asColorLike(o||defaultFillStyle)}}if(!e)this.strokeState_=null;else{var a=e.getColor(),s=e.getLineCap(),l=e.getLineDash(),u=e.getLineDashOffset(),h=e.getLineJoin(),c=e.getWidth(),f=e.getMiterLimit(),p=l||defaultLineDash;this.strokeState_={lineCap:s!==void 0?s:defaultLineCap,lineDash:this.pixelRatio_===1?p:p.map(function(d){return d*n.pixelRatio_}),lineDashOffset:(u||defaultLineDashOffset)*this.pixelRatio_,lineJoin:h!==void 0?h:defaultLineJoin,lineWidth:(c!==void 0?c:defaultLineWidth)*this.pixelRatio_,miterLimit:f!==void 0?f:defaultMiterLimit,strokeStyle:asColorLike(a||defaultStrokeStyle)}}},r.prototype.setImageStyle=function(t){var e;if(!t||!(e=t.getSize())){this.image_=null;return}var n=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*this.pixelRatio_,this.imageAnchorY_=n[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_},r.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var e=t.getFill();if(!e)this.textFillState_=null;else{var n=e.getColor();this.textFillState_={fillStyle:asColorLike(n||defaultFillStyle)}}var o=t.getStroke();if(!o)this.textStrokeState_=null;else{var a=o.getColor(),s=o.getLineCap(),l=o.getLineDash(),u=o.getLineDashOffset(),h=o.getLineJoin(),c=o.getWidth(),f=o.getMiterLimit();this.textStrokeState_={lineCap:s!==void 0?s:defaultLineCap,lineDash:l||defaultLineDash,lineDashOffset:u||defaultLineDashOffset,lineJoin:h!==void 0?h:defaultLineJoin,lineWidth:c!==void 0?c:defaultLineWidth,miterLimit:f!==void 0?f:defaultMiterLimit,strokeStyle:asColorLike(a||defaultStrokeStyle)}}var p=t.getFont(),d=t.getOffsetX(),v=t.getOffsetY(),_=t.getRotateWithView(),g=t.getRotation(),y=t.getScaleArray(),m=t.getText(),E=t.getTextAlign(),T=t.getTextBaseline();this.textState_={font:p!==void 0?p:defaultFont,textAlign:E!==void 0?E:defaultTextAlign,textBaseline:T!==void 0?T:defaultTextBaseline},this.text_=m!==void 0?m:"",this.textOffsetX_=d!==void 0?this.pixelRatio_*d:0,this.textOffsetY_=v!==void 0?this.pixelRatio_*v:0,this.textRotateWithView_=_!==void 0?_:!1,this.textRotation_=g!==void 0?g:0,this.textScale_=[this.pixelRatio_*y[0],this.pixelRatio_*y[1]]}},r}(VectorContext$1),CanvasImmediateRenderer$1=CanvasImmediateRenderer,IconAnchorUnits={FRACTION:"fraction",PIXELS:"pixels"},IconOrigin={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},__extends$n=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ImageBase=function(i){__extends$n(r,i);function r(t,e,n,o){var a=i.call(this)||this;return a.extent=t,a.pixelRatio_=n,a.resolution=e,a.state=o,a}return r.prototype.changed=function(){this.dispatchEvent(EventType.CHANGE)},r.prototype.getExtent=function(){return this.extent},r.prototype.getImage=function(){return abstract()},r.prototype.getPixelRatio=function(){return this.pixelRatio_},r.prototype.getResolution=function(){return this.resolution},r.prototype.getState=function(){return this.state},r.prototype.load=function(){abstract()},r}(EventTarget),ImageBase$1=ImageBase,__extends$m=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();(function(i){__extends$m(r,i);function r(t,e,n,o,a,s){var l=i.call(this,t,e,n,ImageState.IDLE)||this;return l.src_=o,l.image_=new Image,a!==null&&(l.image_.crossOrigin=a),l.unlisten_=null,l.state=ImageState.IDLE,l.imageLoadFunction_=s,l}return r.prototype.getImage=function(){return this.image_},r.prototype.handleImageError_=function(){this.state=ImageState.ERROR,this.unlistenImage_(),this.changed()},r.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=getHeight(this.extent)/this.image_.height),this.state=ImageState.LOADED,this.unlistenImage_(),this.changed()},r.prototype.load=function(){(this.state==ImageState.IDLE||this.state==ImageState.ERROR)&&(this.state=ImageState.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},r.prototype.setImage=function(t){this.image_=t,this.resolution=getHeight(this.extent)/this.image_.height},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},r})(ImageBase$1);function listenImage(i,r,t){var e=i;if(e.src&&IMAGE_DECODE){var n=e.decode(),o=!0,a=function(){o=!1};return n.then(function(){o&&r()}).catch(function(l){o&&(l.name==="EncodingError"&&l.message==="Invalid image type."?r():t())}),a}var s=[listenOnce(e,EventType.LOAD,r),listenOnce(e,EventType.ERROR,t)];return function(){s.forEach(unlistenByKey)}}var __extends$l=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),taintedTestContext=null,IconImage=function(i){__extends$l(r,i);function r(t,e,n,o,a,s){var l=i.call(this)||this;return l.hitDetectionImage_=null,l.image_=t||new Image,o!==null&&(l.image_.crossOrigin=o),l.canvas_={},l.color_=s,l.unlisten_=null,l.imageState_=a,l.size_=n,l.src_=e,l.tainted_,l}return r.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1)),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch{taintedTestContext=null,this.tainted_=!0}}return this.tainted_===!0},r.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(EventType.CHANGE)},r.prototype.handleImageError_=function(){this.imageState_=ImageState.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},r.prototype.handleImageLoad_=function(){this.imageState_=ImageState.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},r.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},r.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},r.prototype.getImageState=function(){return this.imageState_},r.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],n=createCanvasContext2D(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},r.prototype.getSize=function(){return this.size_},r.prototype.getSrc=function(){return this.src_},r.prototype.load=function(){if(this.imageState_==ImageState.IDLE){this.imageState_=ImageState.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},r.prototype.replaceColor_=function(t){if(!(!this.color_||this.canvas_[t]||this.imageState_!==ImageState.LOADED)){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var n=e.getContext("2d");if(n.scale(t,t),n.drawImage(this.image_,0,0),n.globalCompositeOperation="multiply",n.globalCompositeOperation==="multiply"||this.isTainted_())n.fillStyle=asString(this.color_),n.fillRect(0,0,e.width/t,e.height/t),n.globalCompositeOperation="destination-in",n.drawImage(this.image_,0,0);else{for(var o=n.getImageData(0,0,e.width,e.height),a=o.data,s=this.color_[0]/255,l=this.color_[1]/255,u=this.color_[2]/255,h=this.color_[3],c=0,f=a.length;c<f;c+=4)a[c]*=s,a[c+1]*=l,a[c+2]*=u,a[c+3]*=h;n.putImageData(o,0,0)}}},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},r}(EventTarget);function get(i,r,t,e,n,o){var a=shared.get(r,e,o);return a||(a=new IconImage(i,r,t,e,n,o),shared.set(r,e,o,a)),a}var __extends$k=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Icon=function(i){__extends$k(r,i);function r(t){var e=this,n=t||{},o=n.opacity!==void 0?n.opacity:1,a=n.rotation!==void 0?n.rotation:0,s=n.scale!==void 0?n.scale:1,l=n.rotateWithView!==void 0?n.rotateWithView:!1;e=i.call(this,{opacity:o,rotation:a,scale:s,displacement:n.displacement!==void 0?n.displacement:[0,0],rotateWithView:l})||this,e.anchor_=n.anchor!==void 0?n.anchor:[.5,.5],e.normalizedAnchor_=null,e.anchorOrigin_=n.anchorOrigin!==void 0?n.anchorOrigin:IconOrigin.TOP_LEFT,e.anchorXUnits_=n.anchorXUnits!==void 0?n.anchorXUnits:IconAnchorUnits.FRACTION,e.anchorYUnits_=n.anchorYUnits!==void 0?n.anchorYUnits:IconAnchorUnits.FRACTION,e.crossOrigin_=n.crossOrigin!==void 0?n.crossOrigin:null;var u=n.img!==void 0?n.img:null,h=n.imgSize!==void 0?n.imgSize:null,c=n.src;assert(!(c!==void 0&&u),4),assert(!u||u&&h,5),(c===void 0||c.length===0)&&u&&(c=u.src||getUid(u)),assert(c!==void 0&&c.length>0,6);var f=n.src!==void 0?ImageState.IDLE:ImageState.LOADED;return e.color_=n.color!==void 0?asArray(n.color):null,e.iconImage_=get(u,c,h,e.crossOrigin_,f,e.color_),e.offset_=n.offset!==void 0?n.offset:[0,0],e.offsetOrigin_=n.offsetOrigin!==void 0?n.offsetOrigin:IconOrigin.TOP_LEFT,e.origin_=null,e.size_=n.size!==void 0?n.size:null,e}return r.prototype.clone=function(){var t=this.getScale();return new r({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:this.size_!==null?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},r.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==IconAnchorUnits.FRACTION||this.anchorYUnits_==IconAnchorUnits.FRACTION){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==IconAnchorUnits.FRACTION&&(t[0]*=e[0]),this.anchorYUnits_==IconAnchorUnits.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=IconOrigin.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_==IconOrigin.TOP_RIGHT||this.anchorOrigin_==IconOrigin.BOTTOM_RIGHT)&&(t[0]=-t[0]+e[0]),(this.anchorOrigin_==IconOrigin.BOTTOM_LEFT||this.anchorOrigin_==IconOrigin.BOTTOM_RIGHT)&&(t[1]=-t[1]+e[1])}var n=this.getDisplacement();return t[0]-=n[0],t[1]+=n[1],this.normalizedAnchor_=t,this.normalizedAnchor_},r.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},r.prototype.getColor=function(){return this.color_},r.prototype.getImage=function(t){return this.iconImage_.getImage(t)},r.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},r.prototype.getImageSize=function(){return this.iconImage_.getSize()},r.prototype.getImageState=function(){return this.iconImage_.getImageState()},r.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},r.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=IconOrigin.TOP_LEFT){var e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_==IconOrigin.TOP_RIGHT||this.offsetOrigin_==IconOrigin.BOTTOM_RIGHT)&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_==IconOrigin.BOTTOM_LEFT||this.offsetOrigin_==IconOrigin.BOTTOM_RIGHT)&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_},r.prototype.getSrc=function(){return this.iconImage_.getSrc()},r.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},r.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(EventType.CHANGE,t)},r.prototype.load=function(){this.iconImage_.load()},r.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(EventType.CHANGE,t)},r}(ImageStyle$1),Icon$1=Icon,HIT_DETECT_RESOLUTION=.5;function createHitDetectionImageData(i,r,t,e,n,o,a){var s=i[0]*HIT_DETECT_RESOLUTION,l=i[1]*HIT_DETECT_RESOLUTION,u=createCanvasContext2D(s,l);u.imageSmoothingEnabled=!1;for(var h=u.canvas,c=new CanvasImmediateRenderer$1(u,HIT_DETECT_RESOLUTION,n,null,a),f=t.length,p=Math.floor((256*256*256-1)/f),d={},v=1;v<=f;++v){var _=t[v-1],g=_.getStyleFunction()||e;if(!!e){var y=g(_,o);if(!!y){Array.isArray(y)||(y=[y]);for(var m=v*p,E="#"+("000000"+m.toString(16)).slice(-6),T=0,I=y.length;T<I;++T){var R=y[T],C=R.getGeometryFunction()(_);if(!(!C||!intersects$1(n,C.getExtent()))){var S=R.clone(),L=S.getFill();L&&L.setColor(E);var O=S.getStroke();O&&(O.setColor(E),O.setLineDash(null)),S.setText(void 0);var P=R.getImage();if(P&&P.getOpacity()!==0){var D=P.getImageSize();if(!D)continue;var N=createCanvasContext2D(D[0],D[1],void 0,{alpha:!1}),A=N.canvas;N.fillStyle=E,N.fillRect(0,0,A.width,A.height),S.setImage(new Icon$1({img:A,imgSize:D,anchor:P.getAnchor(),anchorXUnits:IconAnchorUnits.PIXELS,anchorYUnits:IconAnchorUnits.PIXELS,offset:P.getOrigin(),opacity:1,size:P.getSize(),scale:P.getScale(),rotation:P.getRotation(),rotateWithView:P.getRotateWithView()}))}var M=S.getZIndex()||0,w=d[M];w||(w={},d[M]=w,w[GeometryType.POLYGON]=[],w[GeometryType.CIRCLE]=[],w[GeometryType.LINE_STRING]=[],w[GeometryType.POINT]=[]),w[C.getType().replace("Multi","")].push(C,S)}}}}}for(var G=Object.keys(d).map(Number).sort(numberSafeCompareFunction),v=0,b=G.length;v<b;++v){var w=d[G[v]];for(var B in w)for(var U=w[B],T=0,I=U.length;T<I;T+=2){c.setStyle(U[T+1]);for(var x=0,k=r.length;x<k;++x)c.setTransform(r[x]),c.drawGeometry(U[T])}}return u.getImageData(0,0,h.width,h.height)}function hitDetect(i,r,t){var e=[];if(t){var n=Math.floor(Math.round(i[0])*HIT_DETECT_RESOLUTION),o=Math.floor(Math.round(i[1])*HIT_DETECT_RESOLUTION),a=(clamp(n,0,t.width-1)+clamp(o,0,t.height-1)*t.width)*4,s=t.data[a],l=t.data[a+1],u=t.data[a+2],h=u+256*(l+256*s),c=Math.floor((256*256*256-1)/r.length);h&&h%c==0&&e.push(r[h/c-1])}return e}var SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(i,r){return parseInt(getUid(i),10)-parseInt(getUid(r),10)}function getSquaredTolerance(i,r){var t=getTolerance(i,r);return t*t}function getTolerance(i,r){return SIMPLIFY_TOLERANCE*i/r}function renderCircleGeometry(i,r,t,e,n){var o=t.getFill(),a=t.getStroke();if(o||a){var s=i.getBuilder(t.getZIndex(),ReplayType.CIRCLE);s.setFillStrokeStyle(o,a),s.drawCircle(r,e)}var l=t.getText();if(l&&l.getText()){var u=(n||i).getBuilder(t.getZIndex(),ReplayType.TEXT);u.setTextStyle(l),u.drawText(r,e)}}function renderFeature(i,r,t,e,n,o,a){var s=!1,l=t.getImage();if(l){var u=l.getImageState();u==ImageState.LOADED||u==ImageState.ERROR?l.unlistenImageChange(n):(u==ImageState.IDLE&&l.load(),u=l.getImageState(),l.listenImageChange(n),s=!0)}return renderFeatureInternal(i,r,t,e,o,a),s}function renderFeatureInternal(i,r,t,e,n,o){var a=t.getGeometryFunction()(r);if(!!a){var s=a.simplifyTransformed(e,n),l=t.getRenderer();if(l)renderGeometry(i,s,t,r);else{var u=GEOMETRY_RENDERERS[s.getType()];u(i,s,t,r,o)}}}function renderGeometry(i,r,t,e){if(r.getType()==GeometryType.GEOMETRY_COLLECTION){for(var n=r.getGeometries(),o=0,a=n.length;o<a;++o)renderGeometry(i,n[o],t,e);return}var s=i.getBuilder(t.getZIndex(),ReplayType.DEFAULT);s.drawCustom(r,e,t.getRenderer(),t.getHitDetectionRenderer())}function renderGeometryCollectionGeometry(i,r,t,e,n){var o=r.getGeometriesArray(),a,s;for(a=0,s=o.length;a<s;++a){var l=GEOMETRY_RENDERERS[o[a].getType()];l(i,o[a],t,e,n)}}function renderLineStringGeometry(i,r,t,e,n){var o=t.getStroke();if(o){var a=i.getBuilder(t.getZIndex(),ReplayType.LINE_STRING);a.setFillStrokeStyle(null,o),a.drawLineString(r,e)}var s=t.getText();if(s&&s.getText()){var l=(n||i).getBuilder(t.getZIndex(),ReplayType.TEXT);l.setTextStyle(s),l.drawText(r,e)}}function renderMultiLineStringGeometry(i,r,t,e,n){var o=t.getStroke();if(o){var a=i.getBuilder(t.getZIndex(),ReplayType.LINE_STRING);a.setFillStrokeStyle(null,o),a.drawMultiLineString(r,e)}var s=t.getText();if(s&&s.getText()){var l=(n||i).getBuilder(t.getZIndex(),ReplayType.TEXT);l.setTextStyle(s),l.drawText(r,e)}}function renderMultiPolygonGeometry(i,r,t,e,n){var o=t.getFill(),a=t.getStroke();if(a||o){var s=i.getBuilder(t.getZIndex(),ReplayType.POLYGON);s.setFillStrokeStyle(o,a),s.drawMultiPolygon(r,e)}var l=t.getText();if(l&&l.getText()){var u=(n||i).getBuilder(t.getZIndex(),ReplayType.TEXT);u.setTextStyle(l),u.drawText(r,e)}}function renderPointGeometry(i,r,t,e,n){var o=t.getImage(),a=t.getText(),s;if(n&&(i=n,s=o&&a&&a.getText()?{}:void 0),o){if(o.getImageState()!=ImageState.LOADED)return;var l=i.getBuilder(t.getZIndex(),ReplayType.IMAGE);l.setImageStyle(o,s),l.drawPoint(r,e)}if(a&&a.getText()){var u=i.getBuilder(t.getZIndex(),ReplayType.TEXT);u.setTextStyle(a,s),u.drawText(r,e)}}function renderMultiPointGeometry(i,r,t,e,n){var o=t.getImage(),a=t.getText(),s;if(n&&(i=n,s=o&&a&&a.getText()?{}:void 0),o){if(o.getImageState()!=ImageState.LOADED)return;var l=i.getBuilder(t.getZIndex(),ReplayType.IMAGE);l.setImageStyle(o,s),l.drawMultiPoint(r,e)}if(a&&a.getText()){var u=(n||i).getBuilder(t.getZIndex(),ReplayType.TEXT);u.setTextStyle(a,s),u.drawText(r,e)}}function renderPolygonGeometry(i,r,t,e,n){var o=t.getFill(),a=t.getStroke();if(o||a){var s=i.getBuilder(t.getZIndex(),ReplayType.POLYGON);s.setFillStrokeStyle(o,a),s.drawPolygon(r,e)}var l=t.getText();if(l&&l.getText()){var u=(n||i).getBuilder(t.getZIndex(),ReplayType.TEXT);u.setTextStyle(l),u.drawText(r,e)}}var __extends$j=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasVectorLayerRenderer=function(i){__extends$j(r,i);function r(t){var e=i.call(this,t)||this;return e.boundHandleStyleImageChange_=e.handleStyleImageChange_.bind(e),e.animatingOrInteracting_,e.dirty_=!1,e.hitDetectionImageData_=null,e.renderedFeatures_=null,e.renderedRevision_=-1,e.renderedResolution_=NaN,e.renderedExtent_=createEmpty(),e.wrappedRenderedExtent_=createEmpty(),e.renderedRotation_,e.renderedCenter_=null,e.renderedProjection_=null,e.renderedRenderOrder_=null,e.replayGroup_=null,e.replayGroupChanged=!0,e.declutterExecutorGroup=null,e.clipping=!0,e}return r.prototype.useContainer=function(t,e,n){n<1&&(t=null),i.prototype.useContainer.call(this,t,e,n)},r.prototype.renderWorlds=function(t,e,n){var o=e.extent,a=e.viewState,s=a.center,l=a.resolution,u=a.projection,h=a.rotation,c=u.getExtent(),f=this.getLayer().getSource(),p=e.pixelRatio,d=e.viewHints,v=!(d[ViewHint.ANIMATING]||d[ViewHint.INTERACTING]),_=this.context,g=Math.round(e.size[0]*p),y=Math.round(e.size[1]*p),m=f.getWrapX()&&u.canWrapX(),E=m?getWidth(c):null,T=m?Math.ceil((o[2]-c[2])/E)+1:1,I=m?Math.floor((o[0]-c[0])/E):0;do{var R=this.getRenderTransform(s,l,h,p,g,y,I*E);t.execute(_,1,R,h,v,void 0,n)}while(++I<T)},r.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree)},r.prototype.renderFrame=function(t,e){var n=t.pixelRatio,o=t.layerStatesArray[t.layerIndex];makeScale(this.pixelTransform,1/n,1/n),makeInverse(this.inversePixelTransform,this.pixelTransform);var a=toString$1(this.pixelTransform);this.useContainer(e,a,o.opacity);var s=this.context,l=s.canvas,u=this.replayGroup_,h=this.declutterExecutorGroup;if((!u||u.isEmpty())&&(!h||h.isEmpty()))return null;var c=Math.round(t.size[0]*n),f=Math.round(t.size[1]*n);l.width!=c||l.height!=f?(l.width=c,l.height=f,l.style.transform!==a&&(l.style.transform=a)):this.containerReused||s.clearRect(0,0,c,f),this.preRender(s,t);var p=t.viewState;p.projection;var d=!1,v=!0;if(o.extent&&this.clipping){var _=fromUserExtent(o.extent);v=intersects$1(_,t.extent),d=v&&!containsExtent(_,t.extent),d&&this.clipUnrotated(s,t,_)}v&&this.renderWorlds(u,t),d&&s.restore(),this.postRender(s,t);var g=cssOpacity(o.opacity),y=this.container;return g!==y.style.opacity&&(y.style.opacity=g),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),this.container},r.prototype.getFeatures=function(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];apply(this.pixelTransform,n);var o=this.renderedCenter_,a=this.renderedResolution_,s=this.renderedRotation_,l=this.renderedProjection_,u=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],f=n[0]*HIT_DETECT_RESOLUTION,p=n[1]*HIT_DETECT_RESOLUTION;c.push(this.getRenderTransform(o,a,s,HIT_DETECT_RESOLUTION,f,p,0).slice());var d=h.getSource(),v=l.getExtent();if(d.getWrapX()&&l.canWrapX()&&!containsExtent(v,u)){for(var _=u[0],g=getWidth(v),y=0,m=void 0;_<v[0];)--y,m=g*y,c.push(this.getRenderTransform(o,a,s,HIT_DETECT_RESOLUTION,f,p,m).slice()),_+=g;for(y=0,_=u[2];_>v[2];)++y,m=g*y,c.push(this.getRenderTransform(o,a,s,HIT_DETECT_RESOLUTION,f,p,m).slice()),_-=g}this.hitDetectionImageData_=createHitDetectionImageData(n,c,this.renderedFeatures_,h.getStyleFunction(),u,a,s)}e(hitDetect(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,o,a){var s=this;if(!!this.replayGroup_){var l=e.viewState.resolution,u=e.viewState.rotation,h=this.getLayer(),c={},f=function(v,_,g){var y=getUid(v),m=c[y];if(m){if(m!==!0&&g<m.distanceSq){if(g===0)return c[y]=!0,a.splice(a.lastIndexOf(m),1),o(v,h,_);m.geometry=_,m.distanceSq=g}}else{if(g===0)return c[y]=!0,o(v,h,_);a.push(c[y]={feature:v,layer:h,geometry:_,distanceSq:g,callback:o})}},p,d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(function(v){return p=v.forEachFeatureAtCoordinate(t,l,u,n,f,v===s.declutterExecutorGroup?e.declutterTree.all().map(function(_){return _.value}):null)}),p}},r.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},r.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},r.prototype.prepareFrame=function(t){var e=this.getLayer(),n=e.getSource();if(!n)return!1;var o=t.viewHints[ViewHint.ANIMATING],a=t.viewHints[ViewHint.INTERACTING],s=e.getUpdateWhileAnimating(),l=e.getUpdateWhileInteracting();if(!this.dirty_&&!s&&o||!l&&a)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var u=t.extent,h=t.viewState,c=h.projection,f=h.resolution,p=t.pixelRatio,d=e.getRevision(),v=e.getRenderBuffer(),_=e.getRenderOrder();_===void 0&&(_=defaultOrder);var g=h.center.slice(),y=buffer(u,v*f),m=y.slice(),E=[y.slice()],T=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!containsExtent(T,t.extent)){var I=getWidth(T),R=Math.max(getWidth(y)/2,I);y[0]=T[0]-R,y[2]=T[2]+R,wrapX$1(g,c);var C=wrapX$2(E[0],c);C[0]<T[0]&&C[2]<T[2]?E.push([C[0]+I,C[1],C[2]+I,C[3]]):C[0]>T[0]&&C[2]>T[2]&&E.push([C[0]-I,C[1],C[2]-I,C[3]])}if(!this.dirty_&&this.renderedResolution_==f&&this.renderedRevision_==d&&this.renderedRenderOrder_==_&&containsExtent(this.wrappedRenderedExtent_,y))return equals$2(this.renderedExtent_,m)||(this.hitDetectionImageData_=null,this.renderedExtent_=m),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var S=new CanvasBuilderGroup(getTolerance(f,p),y,f,p),L;this.getLayer().getDeclutter()&&(L=new CanvasBuilderGroup(getTolerance(f,p),y,f,p));for(var O,P,D,P=0,D=E.length;P<D;++P)n.loadFeatures(E[P],f,c);var N=getSquaredTolerance(f,p),A=function(B){var U,x=B.getStyleFunction()||e.getStyleFunction();if(x&&(U=x(B,f)),U){var k=this.renderFeature(B,N,U,S,O,L);this.dirty_=this.dirty_||k}}.bind(this),M=toUserExtent(y),w=n.getFeaturesInExtent(M);_&&w.sort(_);for(var P=0,D=w.length;P<D;++P)A(w[P]);this.renderedFeatures_=w;var G=S.finish(),b=new CanvasExecutorGroup(y,f,p,n.getOverlaps(),G,e.getRenderBuffer());return L&&(this.declutterExecutorGroup=new CanvasExecutorGroup(y,f,p,n.getOverlaps(),L.finish(),e.getRenderBuffer())),this.renderedResolution_=f,this.renderedRevision_=d,this.renderedRenderOrder_=_,this.renderedExtent_=m,this.wrappedRenderedExtent_=y,this.renderedCenter_=g,this.renderedProjection_=c,this.replayGroup_=b,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},r.prototype.renderFeature=function(t,e,n,o,a,s){if(!n)return!1;var l=!1;if(Array.isArray(n))for(var u=0,h=n.length;u<h;++u)l=renderFeature(o,t,n[u],e,this.boundHandleStyleImageChange_,a,s)||l;else l=renderFeature(o,t,n,e,this.boundHandleStyleImageChange_,a,s);return l},r}(CanvasLayerRenderer$1),CanvasVectorLayerRenderer$1=CanvasVectorLayerRenderer,__extends$i=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),VectorLayer=function(i){__extends$i(r,i);function r(t){return i.call(this,t)||this}return r.prototype.createRenderer=function(){return new CanvasVectorLayerRenderer$1(this)},r}(BaseVectorLayer$1),VectorLayer$1=VectorLayer,RBush=function(){function i(r){this.rbush_=new RBush$2(r),this.items_={}}return i.prototype.insert=function(r,t){var e={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:t};this.rbush_.insert(e),this.items_[getUid(t)]=e},i.prototype.load=function(r,t){for(var e=new Array(t.length),n=0,o=t.length;n<o;n++){var a=r[n],s=t[n],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};e[n]=l,this.items_[getUid(s)]=l}this.rbush_.load(e)},i.prototype.remove=function(r){var t=getUid(r),e=this.items_[t];return delete this.items_[t],this.rbush_.remove(e)!==null},i.prototype.update=function(r,t){var e=this.items_[getUid(t)],n=[e.minX,e.minY,e.maxX,e.maxY];equals$1(n,r)||(this.remove(t),this.insert(r,t))},i.prototype.getAll=function(){var r=this.rbush_.all();return r.map(function(t){return t.value})},i.prototype.getInExtent=function(r){var t={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]},e=this.rbush_.search(t);return e.map(function(n){return n.value})},i.prototype.forEach=function(r){return this.forEach_(this.getAll(),r)},i.prototype.forEachInExtent=function(r,t){return this.forEach_(this.getInExtent(r),t)},i.prototype.forEach_=function(r,t){for(var e,n=0,o=r.length;n<o;n++)if(e=t(r[n]),e)return e;return e},i.prototype.isEmpty=function(){return isEmpty(this.items_)},i.prototype.clear=function(){this.rbush_.clear(),this.items_={}},i.prototype.getExtent=function(r){var t=this.rbush_.toJSON();return createOrUpdate$2(t.minX,t.minY,t.maxX,t.maxY,r)},i.prototype.concat=function(r){this.rbush_.load(r.rbush_.all());for(var t in r.items_)this.items_[t]=r.items_[t]},i}(),RBush$1=RBush,__extends$h=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Source=function(i){__extends$h(r,i);function r(t){var e=i.call(this)||this;e.projection=get$1(t.projection),e.attributions_=adaptAttributions(t.attributions),e.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,e.loading=!1,e.state_=t.state!==void 0?t.state:State.READY,e.wrapX_=t.wrapX!==void 0?t.wrapX:!1,e.viewResolver=null,e.viewRejector=null;var n=e;return e.viewPromise_=new Promise(function(o,a){n.viewResolver=o,n.viewRejector=a}),e}return r.prototype.getAttributions=function(){return this.attributions_},r.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},r.prototype.getProjection=function(){return this.projection},r.prototype.getResolutions=function(){return abstract()},r.prototype.getView=function(){return this.viewPromise_},r.prototype.getState=function(){return this.state_},r.prototype.getWrapX=function(){return this.wrapX_},r.prototype.getContextOptions=function(){},r.prototype.refresh=function(){this.changed()},r.prototype.setAttributions=function(t){this.attributions_=adaptAttributions(t),this.changed()},r.prototype.setState=function(t){this.state_=t,this.changed()},r}(BaseObject$1);function adaptAttributions(i){return i?Array.isArray(i)?function(r){return i}:typeof i=="function"?i:function(r){return[i]}:null}var Source$1=Source,VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function all(i,r){return[[-1/0,-1/0,1/0,1/0]]}var withCredentials=!1;function loadFeaturesXhr(i,r,t,e,n,o,a){var s=new XMLHttpRequest;s.open("GET",typeof i=="function"?i(t,e,n):i,!0),r.getType()==FormatType.ARRAY_BUFFER&&(s.responseType="arraybuffer"),s.withCredentials=withCredentials,s.onload=function(l){if(!s.status||s.status>=200&&s.status<300){var u=r.getType(),h=void 0;u==FormatType.JSON||u==FormatType.TEXT?h=s.responseText:u==FormatType.XML?(h=s.responseXML,h||(h=new DOMParser().parseFromString(s.responseText,"application/xml"))):u==FormatType.ARRAY_BUFFER&&(h=s.response),h?o(r.readFeatures(h,{extent:t,featureProjection:n}),r.readProjection(h)):a()}else a()},s.onerror=a,s.send()}function xhr(i,r){return function(t,e,n,o,a){var s=this;loadFeaturesXhr(i,r,t,e,n,function(l,u){s.addFeatures(l),o!==void 0&&o(l)},a||VOID)}}var __extends$g=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),VectorSourceEvent=function(i){__extends$g(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.feature=e,o.features=n,o}return r}(BaseEvent$1),VectorSource=function(i){__extends$g(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{attributions:n.attributions,projection:void 0,state:State.READY,wrapX:n.wrapX!==void 0?n.wrapX:!0})||this,e.on,e.once,e.un,e.loader_=VOID,e.format_=n.format,e.overlaps_=n.overlaps===void 0?!0:n.overlaps,e.url_=n.url,n.loader!==void 0?e.loader_=n.loader:e.url_!==void 0&&(assert(e.format_,7),e.loader_=xhr(e.url_,e.format_)),e.strategy_=n.strategy!==void 0?n.strategy:all;var o=n.useSpatialIndex!==void 0?n.useSpatialIndex:!0;e.featuresRtree_=o?new RBush$1:null,e.loadedExtentsRtree_=new RBush$1,e.loadingExtentsCount_=0,e.nullGeometryFeatures_={},e.idIndex_={},e.uidIndex_={},e.featureChangeKeys_={},e.featuresCollection_=null;var a,s;return Array.isArray(n.features)?s=n.features:n.features&&(a=n.features,s=a.getArray()),!o&&a===void 0&&(a=new Collection$1(s)),s!==void 0&&e.addFeaturesInternal(s),a!==void 0&&e.bindFeaturesCollection_(a),e}return r.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},r.prototype.addFeatureInternal=function(t){var e=getUid(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);var n=t.getGeometry();if(n){var o=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,t))},r.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[listen(e,EventType.CHANGE,this.handleFeatureChange_,this),listen(e,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)]},r.prototype.addToIndex_=function(t,e){var n=!0,o=e.getId();return o!==void 0&&(o.toString()in this.idIndex_?n=!1:this.idIndex_[o.toString()]=e),n&&(assert(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),n},r.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},r.prototype.addFeaturesInternal=function(t){for(var e=[],n=[],o=[],a=0,s=t.length;a<s;a++){var l=t[a],u=getUid(l);this.addToIndex_(u,l)&&n.push(l)}for(var a=0,h=n.length;a<h;a++){var l=n[a],u=getUid(l);this.setupChangeEvents_(u,l);var c=l.getGeometry();if(c){var f=c.getExtent();e.push(f),o.push(l)}else this.nullGeometryFeatures_[u]=l}this.featuresRtree_&&this.featuresRtree_.load(e,o);for(var a=0,p=n.length;a<p;a++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,n[a]))},r.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener(VectorEventType.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(VectorEventType.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(CollectionEventType.ADD,function(n){e||(e=!0,this.addFeature(n.element),e=!1)}.bind(this)),t.addEventListener(CollectionEventType.REMOVE,function(n){e||(e=!0,this.removeFeature(n.element),e=!1)}.bind(this)),this.featuresCollection_=t},r.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){var n=this.featureChangeKeys_[e];n.forEach(unlistenByKey)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this));for(var o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var a=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(a),this.changed()},r.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},r.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(o){var a=o.getGeometry();if(a.intersectsCoordinate(t))return e(o)})},r.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},r.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,function(n){var o=n.getGeometry();if(o.intersectsExtent(t)){var a=e(n);if(a)return a}})},r.prototype.getFeaturesCollection=function(){return this.featuresCollection_},r.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),isEmpty(this.nullGeometryFeatures_)||extend$2(t,getValues(this.nullGeometryFeatures_))),t},r.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e},r.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},r.prototype.getClosestFeatureToCoordinate=function(t,e){var n=t[0],o=t[1],a=null,s=[NaN,NaN],l=1/0,u=[-1/0,-1/0,1/0,1/0],h=e||TRUE;return this.featuresRtree_.forEachInExtent(u,function(c){if(h(c)){var f=c.getGeometry(),p=l;if(l=f.closestPointXY(n,o,s,l),l<p){a=c;var d=Math.sqrt(l);u[0]=n-d,u[1]=o-d,u[2]=n+d,u[3]=o+d}}}),a},r.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},r.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return e!==void 0?e:null},r.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return e!==void 0?e:null},r.prototype.getFormat=function(){return this.format_},r.prototype.getOverlaps=function(){return this.overlaps_},r.prototype.getUrl=function(){return this.url_},r.prototype.handleFeatureChange_=function(t){var e=t.target,n=getUid(e),o=e.getGeometry();if(!o)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{var a=o.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(a,e)):this.featuresRtree_&&this.featuresRtree_.update(a,e)}var s=e.getId();if(s!==void 0){var l=s.toString();this.idIndex_[l]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[l]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,e))},r.prototype.hasFeature=function(t){var e=t.getId();return e!==void 0?e in this.idIndex_:getUid(t)in this.uidIndex_},r.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&isEmpty(this.nullGeometryFeatures_)},r.prototype.loadFeatures=function(t,e,n){for(var o=this.loadedExtentsRtree_,a=this.strategy_(t,e,n),s=function(c,f){var p=a[c],d=o.forEachInExtent(p,function(v){return containsExtent(v.extent,p)});d||(++l.loadingExtentsCount_,l.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)),l.loader_.call(l,p,e,n,function(v){--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADEND,void 0,v))}.bind(l),function(){--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADERROR))}.bind(l)),o.insert(p,{extent:p.slice()}))},l=this,u=0,h=a.length;u<h;++u)s(u);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},r.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),i.prototype.refresh.call(this)},r.prototype.removeLoadedExtent=function(t){var e=this.loadedExtentsRtree_,n;e.forEachInExtent(t,function(o){if(equals$1(o.extent,t))return n=o,!0}),n&&e.remove(n)},r.prototype.removeFeature=function(t){var e=getUid(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()},r.prototype.removeFeatureInternal=function(t){var e=getUid(t);this.featureChangeKeys_[e].forEach(unlistenByKey),delete this.featureChangeKeys_[e];var n=t.getId();n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,t))},r.prototype.removeFromIdIndex_=function(t){var e=!1;for(var n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}return e},r.prototype.setLoader=function(t){this.loader_=t},r.prototype.setUrl=function(t){assert(this.format_,7),this.url_=t,this.setLoader(xhr(t,this.format_))},r}(Source$1),VectorSource$1=VectorSource;function defaults(i){var r=i||{},t=new Collection$1,e=new Kinetic$1(-.005,.05,100),n=r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0;n&&t.push(new DragRotate$1);var o=r.doubleClickZoom!==void 0?r.doubleClickZoom:!0;o&&t.push(new DoubleClickZoom$1({delta:r.zoomDelta,duration:r.zoomDuration}));var a=r.dragPan!==void 0?r.dragPan:!0;a&&t.push(new DragPan$1({onFocusOnly:r.onFocusOnly,kinetic:e}));var s=r.pinchRotate!==void 0?r.pinchRotate:!0;s&&t.push(new PinchRotate$1);var l=r.pinchZoom!==void 0?r.pinchZoom:!0;l&&t.push(new PinchZoom$1({duration:r.zoomDuration}));var u=r.keyboard!==void 0?r.keyboard:!0;u&&(t.push(new KeyboardPan$1),t.push(new KeyboardZoom$1({delta:r.zoomDelta,duration:r.zoomDuration})));var h=r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0;h&&t.push(new MouseWheelZoom$1({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration}));var c=r.shiftDragZoom!==void 0?r.shiftDragZoom:!0;return c&&t.push(new DragZoom$1({duration:r.zoomDuration})),t}var __extends$f=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Map=function(i){__extends$f(r,i);function r(t){var e=this;return t=assign({},t),t.controls||(t.controls=defaults$1()),t.interactions||(t.interactions=defaults({onFocusOnly:!0})),e=i.call(this,t)||this,e}return r.prototype.createRenderer=function(){return new CompositeMapRenderer$1(this)},r}(PluggableMap$1),Map$1=Map,ARRAY_BUFFER=34962,ELEMENT_ARRAY_BUFFER=34963,STREAM_DRAW=35040,STATIC_DRAW=35044,DYNAMIC_DRAW=35048,UNSIGNED_BYTE=5121,UNSIGNED_SHORT=5123,UNSIGNED_INT=5125,FLOAT=5126,CONTEXT_IDS=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function getContext(i,r){for(var t=CONTEXT_IDS.length,e=0;e<t;++e)try{var n=i.getContext(CONTEXT_IDS[e],r);if(n)return n}catch{}return null}var BufferUsage={STATIC_DRAW,STREAM_DRAW,DYNAMIC_DRAW},WebGLArrayBuffer=function(){function i(r,t){this.array=null,this.type=r,assert(r===ARRAY_BUFFER||r===ELEMENT_ARRAY_BUFFER,62),this.usage=t!==void 0?t:BufferUsage.STATIC_DRAW}return i.prototype.ofSize=function(r){this.array=new(getArrayClassForType(this.type))(r)},i.prototype.fromArray=function(r){var t=getArrayClassForType(this.type);this.array=t.from?t.from(r):new t(r)},i.prototype.fromArrayBuffer=function(r){this.array=new(getArrayClassForType(this.type))(r)},i.prototype.getType=function(){return this.type},i.prototype.getArray=function(){return this.array},i.prototype.getUsage=function(){return this.usage},i.prototype.getSize=function(){return this.array?this.array.length:0},i}();function getArrayClassForType(i){switch(i){case ARRAY_BUFFER:return Float32Array;case ELEMENT_ARRAY_BUFFER:return Uint32Array;default:return Float32Array}}var WebGLArrayBuffer$1=WebGLArrayBuffer,ContextEventType={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},DEFAULT_VERTEX_SHADER=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,DEFAULT_FRAGMENT_SHADER=`
  precision mediump float;
   
  uniform sampler2D u_image;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord);
  }
`,WebGLPostProcessingPass=function(){function i(r){this.gl_=r.webGlContext;var t=this.gl_;this.scaleRatio_=r.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();var e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,r.vertexShader||DEFAULT_VERTEX_SHADER),t.compileShader(e);var n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,r.fragmentShader||DEFAULT_FRAGMENT_SHADER),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,e),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();var o=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],r.uniforms&&Object.keys(r.uniforms).forEach(function(a){this.uniforms_.push({value:r.uniforms[a],location:t.getUniformLocation(this.renderTargetProgram_,a)})}.bind(this))}return i.prototype.getGL=function(){return this.gl_},i.prototype.init=function(r){var t=this.getGL(),e=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,e[0],e[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==e[0]||this.renderTargetTextureSize_[1]!==e[1]){this.renderTargetTextureSize_=e;var n=0,o=t.RGBA,a=0,s=t.RGBA,l=t.UNSIGNED_BYTE,u=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,n,o,e[0],e[1],a,s,l,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}},i.prototype.apply=function(r,t){var e=this.getGL(),n=r.size;e.bindFramebuffer(e.FRAMEBUFFER,t?t.getFrameBuffer():null),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.useProgram(this.renderTargetProgram_),e.enableVertexAttribArray(this.renderTargetAttribLocation_),e.vertexAttribPointer(this.renderTargetAttribLocation_,2,e.FLOAT,!1,0,0),e.uniform2f(this.renderTargetUniformLocation_,n[0],n[1]),e.uniform1i(this.renderTargetTextureLocation_,0),this.applyUniforms(r),e.drawArrays(e.TRIANGLES,0,6)},i.prototype.getFrameBuffer=function(){return this.frameBuffer_},i.prototype.applyUniforms=function(r){var t=this.getGL(),e,n=1;this.uniforms_.forEach(function(o){if(e=typeof o.value=="function"?o.value(r):o.value,e instanceof HTMLCanvasElement||e instanceof ImageData)o.texture||(o.texture=t.createTexture()),t.activeTexture(t["TEXTURE"+n]),t.bindTexture(t.TEXTURE_2D,o.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,e.width,e.height,0,t.UNSIGNED_BYTE,new Uint8Array(e.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.uniform1i(o.location,n++);else if(Array.isArray(e))switch(e.length){case 2:t.uniform2f(o.location,e[0],e[1]);return;case 3:t.uniform3f(o.location,e[0],e[1],e[2]);return;case 4:t.uniform4f(o.location,e[0],e[1],e[2],e[3]);return;default:return}else typeof e=="number"&&t.uniform1f(o.location,e)})},i}(),WebGLPostProcessingPass$1=WebGLPostProcessingPass;function create$1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fromTransform(i,r){return i[0]=r[0],i[1]=r[1],i[4]=r[2],i[5]=r[3],i[12]=r[4],i[13]=r[5],i}var __extends$e=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),DefaultUniform={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution"},AttributeType={UNSIGNED_BYTE,UNSIGNED_SHORT,UNSIGNED_INT,FLOAT},WebGLHelper=function(i){__extends$e(r,i);function r(t){var e=i.call(this)||this,n=t||{};e.boundHandleWebGLContextLost_=e.handleWebGLContextLost.bind(e),e.boundHandleWebGLContextRestored_=e.handleWebGLContextRestored.bind(e),e.canvas_=document.createElement("canvas"),e.canvas_.style.position="absolute",e.canvas_.style.left="0",e.gl_=getContext(e.canvas_);var o=e.getGL();if(e.bufferCache_={},e.extensionCache_={},e.currentProgram_=null,e.canvas_.addEventListener(ContextEventType.LOST,e.boundHandleWebGLContextLost_),e.canvas_.addEventListener(ContextEventType.RESTORED,e.boundHandleWebGLContextRestored_),e.offsetRotateMatrix_=create$2(),e.offsetScaleMatrix_=create$2(),e.tmpMat4_=create$1(),e.uniformLocations_={},e.attribLocations_={},e.uniforms_=[],n.uniforms)for(var a in n.uniforms)e.uniforms_.push({name:a,value:n.uniforms[a]});return e.postProcessPasses_=n.postProcesses?n.postProcesses.map(function(s){return new WebGLPostProcessingPass$1({webGlContext:o,scaleRatio:s.scaleRatio,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,uniforms:s.uniforms})}):[new WebGLPostProcessingPass$1({webGlContext:o})],e.shaderCompileErrors_=null,e.startTime_=Date.now(),e}return r.prototype.getExtension=function(t){if(t in this.extensionCache_)return this.extensionCache_[t];var e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e},r.prototype.bindBuffer=function(t){var e=this.getGL(),n=getUid(t),o=this.bufferCache_[n];if(!o){var a=e.createBuffer();o={buffer:t,webGlBuffer:a},this.bufferCache_[n]=o}e.bindBuffer(t.getType(),o.webGlBuffer)},r.prototype.flushBufferData=function(t){var e=this.getGL();this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())},r.prototype.deleteBuffer=function(t){var e=this.getGL(),n=getUid(t),o=this.bufferCache_[n];o&&!e.isContextLost()&&e.deleteBuffer(o.webGlBuffer),delete this.bufferCache_[n]},r.prototype.disposeInternal=function(){this.canvas_.removeEventListener(ContextEventType.LOST,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(ContextEventType.RESTORED,this.boundHandleWebGLContextRestored_);var t=this.gl_.getExtension("WEBGL_lose_context");t&&t.loseContext(),delete this.gl_,delete this.canvas_},r.prototype.prepareDraw=function(t,e){var n=this.getGL(),o=this.getCanvas(),a=t.size,s=t.pixelRatio;o.width=a[0]*s,o.height=a[1]*s,o.style.width=a[0]+"px",o.style.height=a[1]+"px",n.useProgram(this.currentProgram_);for(var l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,e?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},r.prototype.prepareDrawToRenderTarget=function(t,e,n){var o=this.getGL(),a=e.getSize();o.bindFramebuffer(o.FRAMEBUFFER,e.getFramebuffer()),o.viewport(0,0,a[0],a[1]),o.bindTexture(o.TEXTURE_2D,e.getTexture()),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,n?o.ZERO:o.ONE_MINUS_SRC_ALPHA),o.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},r.prototype.drawElements=function(t,e){var n=this.getGL();this.getExtension("OES_element_index_uint");var o=n.UNSIGNED_INT,a=4,s=e-t,l=t*a;n.drawElements(n.TRIANGLES,s,o,l)},r.prototype.finalizeDraw=function(t){for(var e=0;e<this.postProcessPasses_.length;e++)this.postProcessPasses_[e].apply(t,this.postProcessPasses_[e+1]||null)},r.prototype.getCanvas=function(){return this.canvas_},r.prototype.getGL=function(){return this.gl_},r.prototype.applyFrameState=function(t){var e=t.size,n=t.viewState.rotation,o=reset(this.offsetScaleMatrix_);scale$3(o,2/e[0],2/e[1]);var a=reset(this.offsetRotateMatrix_);n!==0&&rotate$2(a,-n),this.setUniformMatrixValue(DefaultUniform.OFFSET_SCALE_MATRIX,fromTransform(this.tmpMat4_,o)),this.setUniformMatrixValue(DefaultUniform.OFFSET_ROTATION_MATRIX,fromTransform(this.tmpMat4_,a)),this.setUniformFloatValue(DefaultUniform.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(DefaultUniform.ZOOM,t.viewState.zoom),this.setUniformFloatValue(DefaultUniform.RESOLUTION,t.viewState.resolution)},r.prototype.applyUniforms=function(t){var e=this.getGL(),n,o=0;this.uniforms_.forEach(function(a){if(n=typeof a.value=="function"?a.value(t):a.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData){a.texture||(a.prevValue=void 0,a.texture=e.createTexture()),e.activeTexture(e["TEXTURE"+o]),e.bindTexture(e.TEXTURE_2D,a.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var s=!(n instanceof HTMLImageElement)||n.complete;s&&a.prevValue!==n&&(a.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),e.uniform1i(this.getUniformLocation(a.name),o++)}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(a.name,fromTransform(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(a.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(a.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(a.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(a.name),n)}.bind(this))},r.prototype.useProgram=function(t){if(t==this.currentProgram_)return!1;var e=this.getGL();return e.useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},!0},r.prototype.compileShader=function(t,e){var n=this.getGL(),o=n.createShader(e);return n.shaderSource(o,t),n.compileShader(o),o},r.prototype.getProgram=function(t,e){var n=this.getGL(),o=this.compileShader(t,n.FRAGMENT_SHADER),a=this.compileShader(e,n.VERTEX_SHADER),s=n.createProgram();if(n.attachShader(s,o),n.attachShader(s,a),n.linkProgram(s),!n.getShaderParameter(o,n.COMPILE_STATUS)){var l="Fragment shader compliation failed: "+n.getShaderInfoLog(o);throw new Error(l)}if(n.deleteShader(o),!n.getShaderParameter(a,n.COMPILE_STATUS)){var l="Vertex shader compilation failed: "+n.getShaderInfoLog(a);throw new Error(l)}if(n.deleteShader(a),!n.getProgramParameter(s,n.LINK_STATUS)){var l="GL program linking failed: "+n.getShaderInfoLog(a);throw new Error(l)}return s},r.prototype.getUniformLocation=function(t){return this.uniformLocations_[t]===void 0&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]},r.prototype.getAttributeLocation=function(t){return this.attribLocations_[t]===void 0&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]},r.prototype.makeProjectionTransform=function(t,e){var n=t.size,o=t.viewState.rotation,a=t.viewState.resolution,s=t.viewState.center;return reset(e),compose(e,0,0,2/(a*n[0]),2/(a*n[1]),-o,-s[0],-s[1]),e},r.prototype.setUniformFloatValue=function(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)},r.prototype.setUniformMatrixValue=function(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)},r.prototype.enableAttributeArray_=function(t,e,n,o,a){var s=this.getAttributeLocation(t);s<0||(this.getGL().enableVertexAttribArray(s),this.getGL().vertexAttribPointer(s,e,n,!1,o,a))},r.prototype.enableAttributes=function(t){for(var e=computeAttributesStride(t),n=0,o=0;o<t.length;o++){var a=t[o];this.enableAttributeArray_(a.name,a.size,a.type||FLOAT,e,n),n+=a.size*getByteSizeFromType(a.type)}},r.prototype.handleWebGLContextLost=function(){clear(this.bufferCache_),this.currentProgram_=null},r.prototype.handleWebGLContextRestored=function(){},r.prototype.createTexture=function(t,e,n){var o=this.getGL(),a=n||o.createTexture(),s=0,l=o.RGBA,u=0,h=o.RGBA,c=o.UNSIGNED_BYTE;return o.bindTexture(o.TEXTURE_2D,a),e?o.texImage2D(o.TEXTURE_2D,s,l,h,c,e):o.texImage2D(o.TEXTURE_2D,s,l,t[0],t[1],u,h,c,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),a},r}(Disposable$1);function computeAttributesStride(i){for(var r=0,t=0;t<i.length;t++){var e=i[t];r+=e.size*getByteSizeFromType(e.type)}return r}function getByteSizeFromType(i){switch(i){case AttributeType.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case AttributeType.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var __extends$d=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),WebGLWorkerMessageType={GENERATE_BUFFERS:"GENERATE_BUFFERS"},WebGLLayerRenderer=function(i){__extends$d(r,i);function r(t,e){var n=i.call(this,t)||this,o=e||{};return n.helper=new WebGLHelper({postProcesses:o.postProcesses,uniforms:o.uniforms}),o.className!==void 0&&(n.helper.getCanvas().className=o.className),n}return r.prototype.disposeInternal=function(){this.helper.dispose(),delete this.helper,i.prototype.disposeInternal.call(this)},r.prototype.dispatchRenderEvent_=function(t,e){var n=this.getLayer();if(n.hasListener(t)){var o=new RenderEvent$1(t,null,e,null);n.dispatchEvent(o)}},r.prototype.preRender=function(t){this.dispatchRenderEvent_(RenderEventType.PRERENDER,t)},r.prototype.postRender=function(t){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,t)},r}(LayerRenderer$1);function colorEncodeId(i,r){var t=r||[],e=256,n=e-1;return t[0]=Math.floor(i/e/e/e)/n,t[1]=Math.floor(i/e/e)%e/n,t[2]=Math.floor(i/e)%e/n,t[3]=i%e/n,t}function colorDecodeId(i){var r=0,t=256,e=t-1;return r+=Math.round(i[0]*t*t*t*e),r+=Math.round(i[1]*t*t*e),r+=Math.round(i[2]*t*e),r+=Math.round(i[3]*e),r}var WebGLLayerRenderer$1=WebGLLayerRenderer,tmpArray4=new Uint8Array(4),WebGLRenderTarget=function(){function i(r,t){this.helper_=r;var e=r.getGL();this.texture_=e.createTexture(),this.framebuffer_=e.createFramebuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}return i.prototype.setSize=function(r){equals$2(r,this.size_)||(this.size_[0]=r[0],this.size_[1]=r[1],this.updateSize_())},i.prototype.getSize=function(){return this.size_},i.prototype.clearCachedData=function(){this.dataCacheDirty_=!0},i.prototype.readAll=function(){if(this.dataCacheDirty_){var r=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,r[0],r[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_},i.prototype.readPixel=function(r,t){if(r<0||t<0||r>this.size_[0]||t>=this.size_[1])return tmpArray4[0]=0,tmpArray4[1]=0,tmpArray4[2]=0,tmpArray4[3]=0,tmpArray4;this.readAll();var e=Math.floor(r)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return tmpArray4[0]=this.data_[e*4],tmpArray4[1]=this.data_[e*4+1],tmpArray4[2]=this.data_[e*4+2],tmpArray4[3]=this.data_[e*4+3],tmpArray4},i.prototype.getTexture=function(){return this.texture_},i.prototype.getFramebuffer=function(){return this.framebuffer_},i.prototype.updateSize_=function(){var r=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(r,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,r[0],r[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(r[0]*r[1]*4)},i}(),WebGLRenderTarget$1=WebGLRenderTarget,source='var e="function"==typeof Object.assign?Object.assign:function(e,n){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1,o=arguments.length;r<o;++r){var i=arguments[r];if(null!=i)for(var f in i)i.hasOwnProperty(f)&&(t[f]=i[f])}return t},n="GENERATE_BUFFERS",t=[],r={vertexPosition:0,indexPosition:0};function o(e,n,t,r,o){e[n+0]=t,e[n+1]=r,e[n+2]=o}function i(e,n,i,f,s,u){var a=3+s,l=e[n+0],v=e[n+1],c=t;c.length=s;for(var g=0;g<c.length;g++)c[g]=e[n+2+g];var b=u?u.vertexPosition:0,h=u?u.indexPosition:0,d=b/a;return o(i,b,l,v,0),c.length&&i.set(c,b+3),o(i,b+=a,l,v,1),c.length&&i.set(c,b+3),o(i,b+=a,l,v,2),c.length&&i.set(c,b+3),o(i,b+=a,l,v,3),c.length&&i.set(c,b+3),b+=a,f[h++]=d,f[h++]=d+1,f[h++]=d+3,f[h++]=d+1,f[h++]=d+2,f[h++]=d+3,r.vertexPosition=b,r.indexPosition=h,r}var f=self;f.onmessage=function(t){var r=t.data;if(r.type===n){for(var o=r.customAttributesCount,s=2+o,u=new Float32Array(r.renderInstructions),a=u.length/s,l=4*a*(o+3),v=new Uint32Array(6*a),c=new Float32Array(l),g=null,b=0;b<u.length;b+=s)g=i(u,b,c,v,o,g);var h=e({vertexBuffer:c.buffer,indexBuffer:v.buffer,renderInstructions:u.buffer},r);f.postMessage(h,[c.buffer,v.buffer,u.buffer])}};',blob=new Blob([source],{type:"application/javascript"}),url=URL.createObjectURL(blob);function create(){return new Worker(url)}var __extends$c=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),WebGLPointsLayerRenderer=function(i){__extends$c(r,i);function r(t,e){var n=this,o=e.uniforms||{},a=create$2();o[DefaultUniform.PROJECTION_MATRIX]=a,n=i.call(this,t,{className:e.className,uniforms:o,postProcesses:e.postProcesses})||this,n.sourceRevision_=-1,n.verticesBuffer_=new WebGLArrayBuffer$1(ARRAY_BUFFER,DYNAMIC_DRAW),n.hitVerticesBuffer_=new WebGLArrayBuffer$1(ARRAY_BUFFER,DYNAMIC_DRAW),n.indicesBuffer_=new WebGLArrayBuffer$1(ELEMENT_ARRAY_BUFFER,DYNAMIC_DRAW),n.program_=n.helper.getProgram(e.fragmentShader,e.vertexShader),n.hitDetectionEnabled_=!!(e.hitFragmentShader&&e.hitVertexShader),n.hitProgram_=n.hitDetectionEnabled_&&n.helper.getProgram(e.hitFragmentShader,e.hitVertexShader);var s=e.attributes?e.attributes.map(function(u){return{name:"a_"+u.name,size:1,type:AttributeType.FLOAT}}):[];n.attributes=[{name:"a_position",size:2,type:AttributeType.FLOAT},{name:"a_index",size:1,type:AttributeType.FLOAT}].concat(s),n.hitDetectionAttributes=[{name:"a_position",size:2,type:AttributeType.FLOAT},{name:"a_index",size:1,type:AttributeType.FLOAT},{name:"a_hitColor",size:4,type:AttributeType.FLOAT},{name:"a_featureUid",size:1,type:AttributeType.FLOAT}].concat(s),n.customAttributes=e.attributes?e.attributes:[],n.previousExtent_=createEmpty(),n.currentTransform_=a,n.renderTransform_=create$2(),n.invertRenderTransform_=create$2(),n.renderInstructions_=new Float32Array(0),n.hitRenderInstructions_=new Float32Array(0),n.hitRenderTarget_=n.hitDetectionEnabled_&&new WebGLRenderTarget$1(n.helper),n.worker_=create(),n.worker_.addEventListener("message",function(u){var h=u.data;if(h.type===WebGLWorkerMessageType.GENERATE_BUFFERS){var c=h.projectionTransform;h.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(h.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(h.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(h.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=c,makeInverse(this.invertRenderTransform_,this.renderTransform_),h.hitDetection?this.hitRenderInstructions_=new Float32Array(u.data.renderInstructions):this.renderInstructions_=new Float32Array(u.data.renderInstructions),this.getLayer().changed()}}.bind(n)),n.featureCache_={},n.featureCount_=0;var l=n.getLayer().getSource();return n.sourceListenKeys_=[listen(l,VectorEventType.ADDFEATURE,n.handleSourceFeatureAdded_,n),listen(l,VectorEventType.CHANGEFEATURE,n.handleSourceFeatureChanged_,n),listen(l,VectorEventType.REMOVEFEATURE,n.handleSourceFeatureDelete_,n),listen(l,VectorEventType.CLEAR,n.handleSourceFeatureClear_,n)],l.forEachFeature(function(u){this.featureCache_[getUid(u)]={feature:u,properties:u.getProperties(),geometry:u.getGeometry()},this.featureCount_++}.bind(n)),n}return r.prototype.handleSourceFeatureAdded_=function(t){var e=t.feature;this.featureCache_[getUid(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++},r.prototype.handleSourceFeatureChanged_=function(t){var e=t.feature;this.featureCache_[getUid(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}},r.prototype.handleSourceFeatureDelete_=function(t){var e=t.feature;delete this.featureCache_[getUid(e)],this.featureCount_--},r.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},r.prototype.renderFrame=function(t){this.preRender(t);var e=this.indicesBuffer_.getSize();this.helper.drawElements(0,e),this.helper.finalizeDraw(t);var n=this.helper.getCanvas(),o=t.layerStatesArray[t.layerIndex],a=o.opacity;return a!==parseFloat(n.style.opacity)&&(n.style.opacity=String(a)),this.hitDetectionEnabled_&&(this.renderHitDetection(t),this.hitRenderTarget_.clearCachedData()),this.postRender(t),n},r.prototype.prepareFrame=function(t){var e=this.getLayer(),n=e.getSource(),o=t.viewState,a=!t.viewHints[ViewHint.ANIMATING]&&!t.viewHints[ViewHint.INTERACTING],s=!equals$1(this.previousExtent_,t.extent),l=this.sourceRevision_<n.getRevision();if(l&&(this.sourceRevision_=n.getRevision()),a&&(s||l)){var u=o.projection,h=o.resolution,c=e instanceof BaseVectorLayer$1?e.getRenderBuffer():0,f=buffer(t.extent,c*h);n.loadFeatures(f,h,u),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.makeProjectionTransform(t,this.currentTransform_),multiply(this.currentTransform_,this.invertRenderTransform_),this.helper.useProgram(this.program_),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},r.prototype.rebuildBuffers_=function(t){var e=create$2();this.helper.makeProjectionTransform(t,e);var n=(2+this.customAttributes.length)*this.featureCount_;if((!this.renderInstructions_||this.renderInstructions_.length!==n)&&(this.renderInstructions_=new Float32Array(n)),this.hitDetectionEnabled_){var o=(7+this.customAttributes.length)*this.featureCount_;(!this.hitRenderInstructions_||this.hitRenderInstructions_.length!==o)&&(this.hitRenderInstructions_=new Float32Array(o))}var a,s,l=[],u=[],h=0,c=0,f;for(var p in this.featureCache_)if(a=this.featureCache_[p],s=a.geometry,!(!s||s.getType()!==GeometryType.POINT)){l[0]=s.getFlatCoordinates()[0],l[1]=s.getFlatCoordinates()[1],apply(e,l),f=colorEncodeId(c+6,u),this.renderInstructions_[h++]=l[0],this.renderInstructions_[h++]=l[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[c++]=l[0],this.hitRenderInstructions_[c++]=l[1],this.hitRenderInstructions_[c++]=f[0],this.hitRenderInstructions_[c++]=f[1],this.hitRenderInstructions_[c++]=f[2],this.hitRenderInstructions_[c++]=f[3],this.hitRenderInstructions_[c++]=Number(p));for(var d=void 0,v=0;v<this.customAttributes.length;v++)d=this.customAttributes[v].callback(a.feature,a.properties),this.renderInstructions_[h++]=d,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[c++]=d)}var _={type:WebGLWorkerMessageType.GENERATE_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(_.projectionTransform=e,this.worker_.postMessage(_,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var g={type:WebGLWorkerMessageType.GENERATE_BUFFERS,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};g.projectionTransform=e,g.hitDetection=!0,this.worker_.postMessage(g,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,o,a){if(assert(this.hitDetectionEnabled_,66),!!this.hitRenderInstructions_){var s=apply(e.coordinateToPixelTransform,t.slice()),l=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),u=[l[0]/255,l[1]/255,l[2]/255,l[3]/255],h=colorDecodeId(u),c=this.hitRenderInstructions_[h],f=Math.floor(c).toString(),p=this.getLayer().getSource(),d=p.getFeatureByUid(f);if(d)return o(d,this.getLayer(),null)}},r.prototype.renderHitDetection=function(t){if(!!this.hitVerticesBuffer_.getSize()){this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);var e=this.indicesBuffer_.getSize();this.helper.drawElements(0,e)}},r.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){unlistenByKey(t)}),this.sourceListenKeys_=null,i.prototype.disposeInternal.call(this)},r}(WebGLLayerRenderer$1),WebGLPointsLayerRenderer$1=WebGLPointsLayerRenderer,__extends$b=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Property={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},DEFAULT_GRADIENT=["#00f","#0ff","#0f0","#ff0","#f00"],Heatmap=function(i){__extends$b(r,i);function r(t){var e=this,n=t||{},o=assign({},n);delete o.gradient,delete o.radius,delete o.blur,delete o.weight,e=i.call(this,o)||this,e.gradient_=null,e.addChangeListener(Property.GRADIENT,e.handleGradientChanged_),e.setGradient(n.gradient?n.gradient:DEFAULT_GRADIENT),e.setBlur(n.blur!==void 0?n.blur:15),e.setRadius(n.radius!==void 0?n.radius:8);var a=n.weight?n.weight:"weight";return typeof a=="string"?e.weightFunction_=function(s){return s.get(a)}:e.weightFunction_=a,e.setRenderOrder(null),e}return r.prototype.getBlur=function(){return this.get(Property.BLUR)},r.prototype.getGradient=function(){return this.get(Property.GRADIENT)},r.prototype.getRadius=function(){return this.get(Property.RADIUS)},r.prototype.handleGradientChanged_=function(){this.gradient_=createGradient(this.getGradient())},r.prototype.setBlur=function(t){this.set(Property.BLUR,t)},r.prototype.setGradient=function(t){this.set(Property.GRADIENT,t)},r.prototype.setRadius=function(t){this.set(Property.RADIUS,t)},r.prototype.createRenderer=function(){return new WebGLPointsLayerRenderer$1(this,{className:this.getClassName(),attributes:[{name:"weight",callback:function(t){var e=this.weightFunction_(t);return e!==void 0?clamp(e,0,1):1}.bind(this)}],vertexShader:`
        precision mediump float;
        uniform mat4 u_projectionMatrix;
        uniform mat4 u_offsetScaleMatrix;
        uniform float u_size;
        attribute vec2 a_position;
        attribute float a_index;
        attribute float a_weight;

        varying vec2 v_texCoord;
        varying float v_weight;

        void main(void) {
          mat4 offsetMatrix = u_offsetScaleMatrix;
          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;
          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;
          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);
          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;
          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;
          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;
          v_texCoord = vec2(u, v);
          v_weight = a_weight;
        }`,fragmentShader:`
        precision mediump float;
        uniform float u_blurSlope;

        varying vec2 v_texCoord;
        varying float v_weight;

        void main(void) {
          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);
          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;
          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;
          float alpha = smoothstep(0.0, 1.0, value) * v_weight;
          gl_FragColor = vec4(alpha, alpha, alpha, alpha);
        }`,hitVertexShader:`
        precision mediump float;
        uniform mat4 u_projectionMatrix;
        uniform mat4 u_offsetScaleMatrix;
        uniform float u_size;
        attribute vec2 a_position;
        attribute float a_index;
        attribute float a_weight;
        attribute vec4 a_hitColor;

        varying vec2 v_texCoord;
        varying float v_weight;
        varying vec4 v_hitColor;

        void main(void) {
          mat4 offsetMatrix = u_offsetScaleMatrix;
          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;
          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;
          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);
          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;
          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;
          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;
          v_texCoord = vec2(u, v);
          v_hitColor = a_hitColor;
          v_weight = a_weight;
        }`,hitFragmentShader:`
        precision mediump float;
        uniform float u_blurSlope;

        varying vec2 v_texCoord;
        varying float v_weight;
        varying vec4 v_hitColor;

        void main(void) {
          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);
          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;
          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;
          float alpha = smoothstep(0.0, 1.0, value) * v_weight;
          if (alpha < 0.05) {
            discard;
          }

          gl_FragColor = v_hitColor;
        }`,uniforms:{u_size:function(){return(this.get(Property.RADIUS)+this.get(Property.BLUR))*2}.bind(this),u_blurSlope:function(){return this.get(Property.RADIUS)/Math.max(1,this.get(Property.BLUR))}.bind(this)},postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:function(){return this.gradient_}.bind(this)}}]})},r.prototype.renderDeclutter=function(){},r}(VectorLayer$1);function createGradient(i){for(var r=1,t=256,e=createCanvasContext2D(r,t),n=e.createLinearGradient(0,0,r,t),o=1/(i.length-1),a=0,s=i.length;a<s;++a)n.addColorStop(a*o,i[a]);return e.fillStyle=n,e.fillRect(0,0,r,t),e.canvas}var HeatmapLayer=Heatmap,ERROR_THRESHOLD=.5,ENABLE_RASTER_REPROJECTION=!0,TileRange=function(){function i(r,t,e,n){this.minX=r,this.maxX=t,this.minY=e,this.maxY=n}return i.prototype.contains=function(r){return this.containsXY(r[1],r[2])},i.prototype.containsTileRange=function(r){return this.minX<=r.minX&&r.maxX<=this.maxX&&this.minY<=r.minY&&r.maxY<=this.maxY},i.prototype.containsXY=function(r,t){return this.minX<=r&&r<=this.maxX&&this.minY<=t&&t<=this.maxY},i.prototype.equals=function(r){return this.minX==r.minX&&this.minY==r.minY&&this.maxX==r.maxX&&this.maxY==r.maxY},i.prototype.extend=function(r){r.minX<this.minX&&(this.minX=r.minX),r.maxX>this.maxX&&(this.maxX=r.maxX),r.minY<this.minY&&(this.minY=r.minY),r.maxY>this.maxY&&(this.maxY=r.maxY)},i.prototype.getHeight=function(){return this.maxY-this.minY+1},i.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},i.prototype.getWidth=function(){return this.maxX-this.minX+1},i.prototype.intersects=function(r){return this.minX<=r.maxX&&this.maxX>=r.minX&&this.minY<=r.maxY&&this.maxY>=r.minY},i}();function createOrUpdate$1(i,r,t,e,n){return n!==void 0?(n.minX=i,n.maxX=r,n.minY=t,n.maxY=e,n):new TileRange(i,r,t,e)}var TileRange$1=TileRange,__extends$a=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),CanvasTileLayerRenderer=function(i){__extends$a(r,i);function r(t){var e=i.call(this,t)||this;return e.extentChanged=!0,e.renderedExtent_=null,e.renderedPixelRatio,e.renderedProjection=null,e.renderedRevision,e.renderedTiles=[],e.newTiles_=!1,e.tmpExtent=createEmpty(),e.tmpTileRange_=new TileRange$1(0,0,0,0),e}return r.prototype.isDrawableTile=function(t){var e=this.getLayer(),n=t.getState(),o=e.getUseInterimTilesOnError();return n==TileState.LOADED||n==TileState.EMPTY||n==TileState.ERROR&&!o},r.prototype.getTile=function(t,e,n,o){var a=o.pixelRatio,s=o.viewState.projection,l=this.getLayer(),u=l.getSource(),h=u.getTile(t,e,n,a,s);return h.getState()==TileState.ERROR&&(l.getUseInterimTilesOnError()?l.getPreload()>0&&(this.newTiles_=!0):h.setState(TileState.LOADED)),this.isDrawableTile(h)||(h=h.getInterimTile()),h},r.prototype.loadedTileCallback=function(t,e,n){return this.isDrawableTile(n)?i.prototype.loadedTileCallback.call(this,t,e,n):!1},r.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},r.prototype.renderFrame=function(t,e){var n=t.layerStatesArray[t.layerIndex],o=t.viewState,a=o.projection,s=o.resolution,l=o.center,u=o.rotation,h=t.pixelRatio,c=this.getLayer(),f=c.getSource(),p=f.getRevision(),d=f.getTileGridForProjection(a),v=d.getZForResolution(s,f.zDirection),_=d.getResolution(v),g=t.extent,y=n.extent&&fromUserExtent(n.extent);y&&(g=getIntersection(g,fromUserExtent(n.extent)));var m=f.getTilePixelRatio(h),E=Math.round(t.size[0]*m),T=Math.round(t.size[1]*m);if(u){var I=Math.round(Math.sqrt(E*E+T*T));E=I,T=I}var R=_*E/2/m,C=_*T/2/m,S=[l[0]-R,l[1]-C,l[0]+R,l[1]+C],L=d.getTileRangeForExtentAndZ(g,v),O={};O[v]={};var P=this.createLoadedTileFinder(f,a,O),D=this.tmpExtent,N=this.tmpTileRange_;this.newTiles_=!1;for(var A=L.minX;A<=L.maxX;++A)for(var M=L.minY;M<=L.maxY;++M){var w=this.getTile(v,A,M,t);if(this.isDrawableTile(w)){var G=getUid(this);if(w.getState()==TileState.LOADED){O[v][w.tileCoord.toString()]=w;var b=w.inTransition(G);!this.newTiles_&&(b||this.renderedTiles.indexOf(w)===-1)&&(this.newTiles_=!0)}if(w.getAlpha(G,t.time)===1)continue}var B=d.getTileCoordChildTileRange(w.tileCoord,N,D),U=!1;B&&(U=P(v+1,B)),U||d.forEachTileCoordParentTileRange(w.tileCoord,P,N,D)}var x=_/s;compose(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/m,1/m,u,-E/2,-T/2);var k=toString$1(this.pixelTransform);this.useContainer(e,k,n.opacity);var F=this.context,$=F.canvas;makeInverse(this.inversePixelTransform,this.pixelTransform),compose(this.tempTransform,E/2,T/2,x,x,0,-E/2,-T/2),$.width!=E||$.height!=T?($.width=E,$.height=T):this.containerReused||F.clearRect(0,0,E,T),y&&this.clipUnrotated(F,t,y),assign(F,f.getContextOptions()),this.preRender(F,t),this.renderedTiles.length=0;var W=Object.keys(O).map(Number);W.sort(numberSafeCompareFunction);var V,X,Y;n.opacity===1&&(!this.containerReused||f.getOpaque(t.viewState.projection))?W=W.reverse():(V=[],X=[]);for(var ot=W.length-1;ot>=0;--ot){var Z=W[ot],mt=f.getTilePixelSize(Z,h,a),Et=d.getResolution(Z),J=Et/_,at=mt[0]*J*x,Tt=mt[1]*J*x,ct=d.getTileCoordForCoordAndZ(getTopLeft(S),Z),xt=d.getTileCoordExtent(ct),rt=apply(this.tempTransform,[m*(xt[0]-S[0])/_,m*(S[3]-xt[3])/_]),ft=m*f.getGutterForProjection(a),Rt=O[Z];for(var st in Rt){var w=Rt[st],Q=w.tileCoord,lt=ct[1]-Q[1],Lt=Math.round(rt[0]-(lt-1)*at),Ct=ct[2]-Q[2],pt=Math.round(rt[1]-(Ct-1)*Tt),A=Math.round(rt[0]-lt*at),M=Math.round(rt[1]-Ct*Tt),tt=Lt-A,q=pt-M,nt=v===Z,b=nt&&w.getAlpha(getUid(this),t.time)!==1;if(!b)if(V){F.save(),Y=[A,M,A+tt,M,A+tt,M+q,A,M+q];for(var ut=0,K=V.length;ut<K;++ut)if(v!==Z&&Z<X[ut]){var H=V[ut];F.beginPath(),F.moveTo(Y[0],Y[1]),F.lineTo(Y[2],Y[3]),F.lineTo(Y[4],Y[5]),F.lineTo(Y[6],Y[7]),F.moveTo(H[6],H[7]),F.lineTo(H[4],H[5]),F.lineTo(H[2],H[3]),F.lineTo(H[0],H[1]),F.clip()}V.push(Y),X.push(Z)}else F.clearRect(A,M,tt,q);this.drawTileImage(w,t,A,M,tt,q,ft,nt),V&&!b?(F.restore(),this.renderedTiles.unshift(w)):this.renderedTiles.push(w),this.updateUsedTiles(t.usedTiles,f,w)}}this.renderedRevision=p,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!equals$1(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=h,this.renderedProjection=a,this.manageTilePyramid(t,f,d,h,a,g,v,c.getPreload()),this.scheduleExpireCache(t,f),this.postRender(F,t),n.extent&&F.restore(),k!==$.style.transform&&($.style.transform=k);var it=cssOpacity(n.opacity),ht=this.container;return it!==ht.style.opacity&&(ht.style.opacity=it),this.container},r.prototype.drawTileImage=function(t,e,n,o,a,s,l,u){var h=this.getTileImage(t);if(!!h){var c=getUid(this),f=u?t.getAlpha(c,e.time):1,p=f!==this.context.globalAlpha;p&&(this.context.save(),this.context.globalAlpha=f),this.context.drawImage(h,l,l,h.width-2*l,h.height-2*l,n,o,a,s),p&&this.context.restore(),f!==1?e.animate=!0:u&&t.endTransition(c)}},r.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},r.prototype.getTileImage=function(t){return t.getImage()},r.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var n=function(o,a,s){var l=getUid(o);l in s.usedTiles&&o.expireCache(s.viewState.projection,s.usedTiles[l])}.bind(null,e);t.postRenderFunctions.push(n)}},r.prototype.updateUsedTiles=function(t,e,n){var o=getUid(e);o in t||(t[o]={}),t[o][n.getKey()]=!0},r.prototype.manageTilePyramid=function(t,e,n,o,a,s,l,u,h){var c=getUid(e);c in t.wantedTiles||(t.wantedTiles[c]={});var f=t.wantedTiles[c],p=t.tileQueue,d=n.getMinZoom(),v=0,_,g,y,m,E,T;for(T=d;T<=l;++T)for(g=n.getTileRangeForExtentAndZ(s,T,g),y=n.getResolution(T),m=g.minX;m<=g.maxX;++m)for(E=g.minY;E<=g.maxY;++E)l-T<=u?(++v,_=e.getTile(T,m,E,o,a),_.getState()==TileState.IDLE&&(f[_.getKey()]=!0,p.isKeyQueued(_.getKey())||p.enqueue([_,c,n.getTileCoordCenter(_.tileCoord),y])),h!==void 0&&h(_)):e.useTile(T,m,E,a);e.updateCacheSize(v,a)},r}(CanvasLayerRenderer$1);CanvasTileLayerRenderer.prototype.getLayer;var CanvasTileLayerRenderer$1=CanvasTileLayerRenderer,TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},__extends$9=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Tile=function(i){__extends$9(r,i);function r(t,e,n){var o=i.call(this)||this,a=n||{};return o.tileCoord=t,o.state=e,o.interimTile=null,o.key="",o.transition_=a.transition===void 0?250:a.transition,o.transitionStarts_={},o}return r.prototype.changed=function(){this.dispatchEvent(EventType.CHANGE)},r.prototype.release=function(){},r.prototype.getKey=function(){return this.key+"/"+this.tileCoord},r.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==TileState.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},r.prototype.refreshInterimChain=function(){if(!!this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==TileState.LOADED){t.interimTile=null;break}else t.getState()==TileState.LOADING?e=t:t.getState()==TileState.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}},r.prototype.getTileCoord=function(){return this.tileCoord},r.prototype.getState=function(){return this.state},r.prototype.setState=function(t){if(this.state!==TileState.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},r.prototype.load=function(){abstract()},r.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;var o=e-n+1e3/60;return o>=this.transition_?1:easeIn(o/this.transition_)},r.prototype.inTransition=function(t){return this.transition_?this.transitionStarts_[t]!==-1:!1},r.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},r}(EventTarget),Tile$1=Tile,LRUCache=function(){function i(r){this.highWaterMark=r!==void 0?r:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return i.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},i.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},i.prototype.containsKey=function(r){return this.entries_.hasOwnProperty(r)},i.prototype.forEach=function(r){for(var t=this.oldest_;t;)r(t.value_,t.key_,this),t=t.newer},i.prototype.get=function(r,t){var e=this.entries_[r];return assert(e!==void 0,15),e===this.newest_||(e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer),e.newer=null,e.older=this.newest_,this.newest_.newer=e,this.newest_=e),e.value_},i.prototype.remove=function(r){var t=this.entries_[r];return assert(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[r],--this.count_,t.value_},i.prototype.getCount=function(){return this.count_},i.prototype.getKeys=function(){var r=new Array(this.count_),t=0,e;for(e=this.newest_;e;e=e.older)r[t++]=e.key_;return r},i.prototype.getValues=function(){var r=new Array(this.count_),t=0,e;for(e=this.newest_;e;e=e.older)r[t++]=e.value_;return r},i.prototype.peekLast=function(){return this.oldest_.value_},i.prototype.peekLastKey=function(){return this.oldest_.key_},i.prototype.peekFirstKey=function(){return this.newest_.key_},i.prototype.pop=function(){var r=this.oldest_;return delete this.entries_[r.key_],r.newer&&(r.newer.older=null),this.oldest_=r.newer,this.oldest_||(this.newest_=null),--this.count_,r.value_},i.prototype.replace=function(r,t){this.get(r),this.entries_[r].value_=t},i.prototype.set=function(r,t){assert(!(r in this.entries_),16);var e={key_:r,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=e:this.oldest_=e,this.newest_=e,this.entries_[r]=e,++this.count_},i.prototype.setSize=function(r){this.highWaterMark=r},i}(),LRUCache$1=LRUCache;function createOrUpdate(i,r,t,e){return e!==void 0?(e[0]=i,e[1]=r,e[2]=t,e):[i,r,t]}function getKeyZXY(i,r,t){return i+"/"+r+"/"+t}function getKey(i){return getKeyZXY(i[0],i[1],i[2])}function fromKey(i){return i.split("/").map(Number)}function hash(i){return(i[1]<<i[0])+i[2]}function withinExtentAndZ(i,r){var t=i[0],e=i[1],n=i[2];if(r.getMinZoom()>t||t>r.getMaxZoom())return!1;var o=r.getFullTileRange(t);return o?o.containsXY(e,n):!0}var __extends$8=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),TileCache=function(i){__extends$8(r,i);function r(){return i!==null&&i.apply(this,arguments)||this}return r.prototype.expireCache=function(t){for(;this.canExpireCache();){var e=this.peekLast();if(e.getKey()in t)break;this.pop().release()}},r.prototype.pruneExceptNewestZ=function(){if(this.getCount()!==0){var t=this.peekFirstKey(),e=fromKey(t),n=e[0];this.forEach(function(o){o.tileCoord[0]!==n&&(this.remove(getKey(o.tileCoord)),o.release())}.bind(this))}},r}(LRUCache$1),TileCache$1=TileCache,TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},tmpTileCoord=[0,0,0],TileGrid=function(){function i(r){this.minZoom=r.minZoom!==void 0?r.minZoom:0,this.resolutions_=r.resolutions,assert(isSorted(this.resolutions_,function(a,s){return s-a},!0),17);var t;if(!r.origins){for(var e=0,n=this.resolutions_.length-1;e<n;++e)if(!t)t=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=r.origin!==void 0?r.origin:null,this.origins_=null,r.origins!==void 0&&(this.origins_=r.origins,assert(this.origins_.length==this.resolutions_.length,20));var o=r.extent;o!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=getTopLeft(o)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,r.tileSizes!==void 0&&(this.tileSizes_=r.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=r.tileSize!==void 0?r.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=o!==void 0?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],r.sizes!==void 0?this.fullTileRanges_=r.sizes.map(function(a,s){var l=new TileRange$1(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1));if(o){var u=this.getTileRangeForExtentAndZ(o,s);l.minX=Math.max(u.minX,l.minX),l.maxX=Math.min(u.maxX,l.maxX),l.minY=Math.max(u.minY,l.minY),l.maxY=Math.min(u.maxY,l.maxY)}return l},this):o&&this.calculateTileRanges_(o)}return i.prototype.forEachTileCoord=function(r,t,e){for(var n=this.getTileRangeForExtentAndZ(r,t),o=n.minX,a=n.maxX;o<=a;++o)for(var s=n.minY,l=n.maxY;s<=l;++s)e([t,o,s])},i.prototype.forEachTileCoordParentTileRange=function(r,t,e,n){var o,a,s,l=null,u=r[0]-1;for(this.zoomFactor_===2?(a=r[1],s=r[2]):l=this.getTileCoordExtent(r,n);u>=this.minZoom;){if(this.zoomFactor_===2?(a=Math.floor(a/2),s=Math.floor(s/2),o=createOrUpdate$1(a,a,s,s,e)):o=this.getTileRangeForExtentAndZ(l,u,e),t(u,o))return!0;--u}return!1},i.prototype.getExtent=function(){return this.extent_},i.prototype.getMaxZoom=function(){return this.maxZoom},i.prototype.getMinZoom=function(){return this.minZoom},i.prototype.getOrigin=function(r){return this.origin_?this.origin_:this.origins_[r]},i.prototype.getResolution=function(r){return this.resolutions_[r]},i.prototype.getResolutions=function(){return this.resolutions_},i.prototype.getTileCoordChildTileRange=function(r,t,e){if(r[0]<this.maxZoom){if(this.zoomFactor_===2){var n=r[1]*2,o=r[2]*2;return createOrUpdate$1(n,n+1,o,o+1,t)}var a=this.getTileCoordExtent(r,e||this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,r[0]+1,t)}return null},i.prototype.getTileRangeForTileCoordAndZ=function(r,t,e){if(t>this.maxZoom||t<this.minZoom)return null;var n=r[0],o=r[1],a=r[2];if(t===n)return createOrUpdate$1(o,a,o,a,e);if(this.zoomFactor_){var s=Math.pow(this.zoomFactor_,t-n),l=Math.floor(o*s),u=Math.floor(a*s);if(t<n)return createOrUpdate$1(l,l,u,u,e);var h=Math.floor(s*(o+1))-1,c=Math.floor(s*(a+1))-1;return createOrUpdate$1(l,h,u,c,e)}var f=this.getTileCoordExtent(r,this.tmpExtent_);return this.getTileRangeForExtentAndZ(f,t,e)},i.prototype.getTileRangeExtent=function(r,t,e){var n=this.getOrigin(r),o=this.getResolution(r),a=toSize(this.getTileSize(r),this.tmpSize_),s=n[0]+t.minX*a[0]*o,l=n[0]+(t.maxX+1)*a[0]*o,u=n[1]+t.minY*a[1]*o,h=n[1]+(t.maxY+1)*a[1]*o;return createOrUpdate$2(s,u,l,h,e)},i.prototype.getTileRangeForExtentAndZ=function(r,t,e){var n=tmpTileCoord;this.getTileCoordForXYAndZ_(r[0],r[3],t,!1,n);var o=n[1],a=n[2];return this.getTileCoordForXYAndZ_(r[2],r[1],t,!0,n),createOrUpdate$1(o,n[1],a,n[2],e)},i.prototype.getTileCoordCenter=function(r){var t=this.getOrigin(r[0]),e=this.getResolution(r[0]),n=toSize(this.getTileSize(r[0]),this.tmpSize_);return[t[0]+(r[1]+.5)*n[0]*e,t[1]-(r[2]+.5)*n[1]*e]},i.prototype.getTileCoordExtent=function(r,t){var e=this.getOrigin(r[0]),n=this.getResolution(r[0]),o=toSize(this.getTileSize(r[0]),this.tmpSize_),a=e[0]+r[1]*o[0]*n,s=e[1]-(r[2]+1)*o[1]*n,l=a+o[0]*n,u=s+o[1]*n;return createOrUpdate$2(a,s,l,u,t)},i.prototype.getTileCoordForCoordAndResolution=function(r,t,e){return this.getTileCoordForXYAndResolution_(r[0],r[1],t,!1,e)},i.prototype.getTileCoordForXYAndResolution_=function(r,t,e,n,o){var a=this.getZForResolution(e),s=e/this.getResolution(a),l=this.getOrigin(a),u=toSize(this.getTileSize(a),this.tmpSize_),h=n?.5:0,c=n?.5:0,f=Math.floor((r-l[0])/e+h),p=Math.floor((l[1]-t)/e+c),d=s*f/u[0],v=s*p/u[1];return n?(d=Math.ceil(d)-1,v=Math.ceil(v)-1):(d=Math.floor(d),v=Math.floor(v)),createOrUpdate(a,d,v,o)},i.prototype.getTileCoordForXYAndZ_=function(r,t,e,n,o){var a=this.getOrigin(e),s=this.getResolution(e),l=toSize(this.getTileSize(e),this.tmpSize_),u=n?.5:0,h=n?.5:0,c=Math.floor((r-a[0])/s+u),f=Math.floor((a[1]-t)/s+h),p=c/l[0],d=f/l[1];return n?(p=Math.ceil(p)-1,d=Math.ceil(d)-1):(p=Math.floor(p),d=Math.floor(d)),createOrUpdate(e,p,d,o)},i.prototype.getTileCoordForCoordAndZ=function(r,t,e){return this.getTileCoordForXYAndZ_(r[0],r[1],t,!1,e)},i.prototype.getTileCoordResolution=function(r){return this.resolutions_[r[0]]},i.prototype.getTileSize=function(r){return this.tileSize_?this.tileSize_:this.tileSizes_[r]},i.prototype.getFullTileRange=function(r){return this.fullTileRanges_?this.fullTileRanges_[r]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,r):null},i.prototype.getZForResolution=function(r,t){var e=linearFindNearest(this.resolutions_,r,t||0);return clamp(e,this.minZoom,this.maxZoom)},i.prototype.calculateTileRanges_=function(r){for(var t=this.resolutions_.length,e=new Array(t),n=this.minZoom;n<t;++n)e[n]=this.getTileRangeForExtentAndZ(r,n);this.fullTileRanges_=e},i}(),TileGrid$1=TileGrid;function getForProjection(i){var r=i.getDefaultTileGrid();return r||(r=createForProjection(i),i.setDefaultTileGrid(r)),r}function wrapX(i,r,t){var e=r[0],n=i.getTileCoordCenter(r),o=extentFromProjection(t);if(containsCoordinate(o,n))return r;var a=getWidth(o),s=Math.ceil((o[0]-n[0])/a);return n[0]+=a*s,i.getTileCoordForCoordAndZ(n,e)}function createForExtent(i,r,t,e){var n=e!==void 0?e:Corner.TOP_LEFT,o=resolutionsFromExtent(i,r,t);return new TileGrid$1({extent:i,origin:getCorner(i,n),resolutions:o,tileSize:t})}function createXYZ(i){var r=i||{},t=r.extent||get$1("EPSG:3857").getExtent(),e={extent:t,minZoom:r.minZoom,tileSize:r.tileSize,resolutions:resolutionsFromExtent(t,r.maxZoom,r.tileSize,r.maxResolution)};return new TileGrid$1(e)}function resolutionsFromExtent(i,r,t,e){for(var n=r!==void 0?r:DEFAULT_MAX_ZOOM,o=getHeight(i),a=getWidth(i),s=toSize(t!==void 0?t:DEFAULT_TILE_SIZE),l=e>0?e:Math.max(a/s[0],o/s[1]),u=n+1,h=new Array(u),c=0;c<u;++c)h[c]=l/Math.pow(2,c);return h}function createForProjection(i,r,t,e){var n=extentFromProjection(i);return createForExtent(n,r,t,e)}function extentFromProjection(i){i=get$1(i);var r=i.getExtent();if(!r){var t=180*METERS_PER_UNIT$1[Units$1.DEGREES]/i.getMetersPerUnit();r=createOrUpdate$2(-t,-t,t,t)}return r}var __extends$7=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),TileSource=function(i){__extends$7(r,i);function r(t){var e=i.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX})||this;e.on,e.once,e.un,e.opaque_=t.opaque!==void 0?t.opaque:!1,e.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,e.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;var n=[256,256],o=t.tileGrid;return o&&toSize(o.getTileSize(o.getMinZoom()),n),e.tileCache=new TileCache$1(t.cacheSize||0),e.tmpSize=[0,0],e.key_=t.key||"",e.tileOptions={transition:t.transition},e.zDirection=t.zDirection?t.zDirection:0,e}return r.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},r.prototype.expireCache=function(t,e){var n=this.getTileCacheForProjection(t);n&&n.expireCache(e)},r.prototype.forEachLoadedTile=function(t,e,n,o){var a=this.getTileCacheForProjection(t);if(!a)return!1;for(var s=!0,l,u,h,c=n.minX;c<=n.maxX;++c)for(var f=n.minY;f<=n.maxY;++f)u=getKeyZXY(e,c,f),h=!1,a.containsKey(u)&&(l=a.get(u),h=l.getState()===TileState.LOADED,h&&(h=o(l)!==!1)),h||(s=!1);return s},r.prototype.getGutterForProjection=function(t){return 0},r.prototype.getKey=function(){return this.key_},r.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},r.prototype.getOpaque=function(t){return this.opaque_},r.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},r.prototype.getTile=function(t,e,n,o,a){return abstract()},r.prototype.getTileGrid=function(){return this.tileGrid},r.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:getForProjection(t)},r.prototype.getTileCacheForProjection=function(t){return assert(equivalent(this.getProjection(),t),68),this.tileCache},r.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},r.prototype.getTilePixelSize=function(t,e,n){var o=this.getTileGridForProjection(n),a=this.getTilePixelRatio(e),s=toSize(o.getTileSize(t),this.tmpSize);return a==1?s:scale(s,a,this.tmpSize)},r.prototype.getTileCoordForTileUrlFunction=function(t,e){var n=e!==void 0?e:this.getProjection(),o=this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=wrapX(o,t,n)),withinExtentAndZ(t,o)?t:null},r.prototype.clear=function(){this.tileCache.clear()},r.prototype.refresh=function(){this.clear(),i.prototype.refresh.call(this)},r.prototype.updateCacheSize=function(t,e){var n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)},r.prototype.useTile=function(t,e,n,o){},r}(Source$1),TileSourceEvent=function(i){__extends$7(r,i);function r(t,e){var n=i.call(this,t)||this;return n.tile=e,n}return r}(BaseEvent$1),TileSource$1=TileSource;function createFromTemplate(i,r){var t=/\{z\}/g,e=/\{x\}/g,n=/\{y\}/g,o=/\{-y\}/g;return function(a,s,l){if(a)return i.replace(t,a[0].toString()).replace(e,a[1].toString()).replace(n,a[2].toString()).replace(o,function(){var u=a[0],h=r.getFullTileRange(u);assert(h,55);var c=h.getHeight()-a[2]-1;return c.toString()})}}function createFromTemplates(i,r){for(var t=i.length,e=new Array(t),n=0;n<t;++n)e[n]=createFromTemplate(i[n],r);return createFromTileUrlFunctions(e)}function createFromTileUrlFunctions(i){return i.length===1?i[0]:function(r,t,e){if(r){var n=hash(r),o=modulo(n,i.length);return i[o](r,t,e)}else return}}function expandUrl(i){var r=[],t=/\{([a-z])-([a-z])\}/.exec(i);if(t){var e=t[1].charCodeAt(0),n=t[2].charCodeAt(0),o=void 0;for(o=e;o<=n;++o)r.push(i.replace(t[0],String.fromCharCode(o)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){for(var a=parseInt(t[2],10),s=parseInt(t[1],10);s<=a;s++)r.push(i.replace(t[0],s.toString()));return r}return r.push(i),r}var __extends$6=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),UrlTile=function(i){__extends$6(r,i);function r(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.generateTileUrlFunction_=e.tileUrlFunction===r.prototype.tileUrlFunction,e.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(e.tileUrlFunction=t.tileUrlFunction),e.urls=null,t.urls?e.setUrls(t.urls):t.url&&e.setUrl(t.url),e.tileLoadingKeys_={},e}return r.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},r.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},r.prototype.getUrls=function(){return this.urls},r.prototype.handleTileChange=function(t){var e=t.target,n=getUid(e),o=e.getState(),a;o==TileState.LOADING?(this.tileLoadingKeys_[n]=!0,a=TileEventType.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],a=o==TileState.ERROR?TileEventType.TILELOADERROR:o==TileState.LOADED?TileEventType.TILELOADEND:void 0),a!=null&&this.dispatchEvent(new TileSourceEvent(a,e))},r.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},r.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e!="undefined"?this.setKey(e):this.changed()},r.prototype.setUrl=function(t){var e=expandUrl(t);this.urls=e,this.setUrls(e)},r.prototype.setUrls=function(t){this.urls=t;var e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(t,this.tileGrid),e):this.setKey(e)},r.prototype.tileUrlFunction=function(t,e,n){},r.prototype.useTile=function(t,e,n){var o=getKeyZXY(t,e,n);this.tileCache.containsKey(o)&&this.tileCache.get(o)},r}(TileSource$1),UrlTile$1=UrlTile,__extends$5=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ImageTile=function(i){__extends$5(r,i);function r(t,e,n,o,a,s){var l=i.call(this,t,e,s)||this;return l.crossOrigin_=o,l.src_=n,l.key=n,l.image_=new Image,o!==null&&(l.image_.crossOrigin=o),l.unlisten_=null,l.tileLoadFunction_=a,l}return r.prototype.getImage=function(){return this.image_},r.prototype.setImage=function(t){this.image_=t,this.state=TileState.LOADED,this.unlistenImage_(),this.changed()},r.prototype.handleImageError_=function(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()},r.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY,this.unlistenImage_(),this.changed()},r.prototype.load=function(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},r}(Tile$1);function getBlankImage(){var i=createCanvasContext2D(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}var ImageTile$1=ImageTile,MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25,Triangulation=function(){function i(r,t,e,n,o,a){this.sourceProj_=r,this.targetProj_=t;var s={},l=getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(m){var E=m[0]+"/"+m[1];return s[E]||(s[E]=l(m)),s[E]},this.maxSourceExtent_=n,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&getWidth(n)==getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;var u=getTopLeft(e),h=getTopRight(e),c=getBottomRight(e),f=getBottomLeft(e),p=this.transformInv_(u),d=this.transformInv_(h),v=this.transformInv_(c),_=this.transformInv_(f),g=MAX_SUBDIVISION+(a?Math.max(0,Math.ceil(log2(getArea(e)/(a*a*256*256)))):0);if(this.addQuad_(u,h,c,f,p,d,v,_,g),this.wrapsXInSource_){var y=1/0;this.triangles_.forEach(function(m,E,T){y=Math.min(y,m.source[0][0],m.source[1][0],m.source[2][0])}),this.triangles_.forEach(function(m){if(Math.max(m.source[0][0],m.source[1][0],m.source[2][0])-y>this.sourceWorldWidth_/2){var E=[[m.source[0][0],m.source[0][1]],[m.source[1][0],m.source[1][1]],[m.source[2][0],m.source[2][1]]];E[0][0]-y>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-y>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-y>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);var T=Math.min(E[0][0],E[1][0],E[2][0]),I=Math.max(E[0][0],E[1][0],E[2][0]);I-T<this.sourceWorldWidth_/2&&(m.source=E)}}.bind(this))}s={}}return i.prototype.addTriangle_=function(r,t,e,n,o,a){this.triangles_.push({source:[n,o,a],target:[r,t,e]})},i.prototype.addQuad_=function(r,t,e,n,o,a,s,l,u){var h=boundingExtent([o,a,s,l]),c=this.sourceWorldWidth_?getWidth(h)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&c>.5&&c<1,d=!1;if(u>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var v=boundingExtent([r,t,e,n]),_=getWidth(v)/this.targetWorldWidth_;d=_>MAX_TRIANGLE_WIDTH||d}!p&&this.sourceProj_.isGlobal()&&c&&(d=c>MAX_TRIANGLE_WIDTH||d)}if(!(!d&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!intersects$1(h,this.maxSourceExtent_))){var g=0;if(!d&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(l[0])||!isFinite(l[1]))){if(u>0)d=!0;else if(g=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(s[0])||!isFinite(s[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),g!=1&&g!=2&&g!=4&&g!=8)return}if(u>0){if(!d){var y=[(r[0]+e[0])/2,(r[1]+e[1])/2],m=this.transformInv_(y),E=void 0;if(p){var T=(modulo(o[0],f)+modulo(s[0],f))/2;E=T-modulo(m[0],f)}else E=(o[0]+s[0])/2-m[0];var I=(o[1]+s[1])/2-m[1],R=E*E+I*I;d=R>this.errorThresholdSquared_}if(d){if(Math.abs(r[0]-e[0])<=Math.abs(r[1]-e[1])){var C=[(t[0]+e[0])/2,(t[1]+e[1])/2],S=this.transformInv_(C),L=[(n[0]+r[0])/2,(n[1]+r[1])/2],O=this.transformInv_(L);this.addQuad_(r,t,C,L,o,a,S,O,u-1),this.addQuad_(L,C,e,n,O,S,s,l,u-1)}else{var P=[(r[0]+t[0])/2,(r[1]+t[1])/2],D=this.transformInv_(P),N=[(e[0]+n[0])/2,(e[1]+n[1])/2],A=this.transformInv_(N);this.addQuad_(r,P,N,n,o,D,A,l,u-1),this.addQuad_(P,t,e,N,D,a,s,A,u-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(g&11)==0&&this.addTriangle_(r,e,n,o,s,l),(g&14)==0&&this.addTriangle_(r,e,t,o,s,a),g&&((g&13)==0&&this.addTriangle_(t,n,r,a,l,o),(g&7)==0&&this.addTriangle_(t,n,e,a,l,s))}},i.prototype.calculateSourceExtent=function(){var r=createEmpty();return this.triangles_.forEach(function(t,e,n){var o=t.source;extendCoordinate(r,o[0]),extendCoordinate(r,o[1]),extendCoordinate(r,o[2])}),r},i.prototype.getTriangles=function(){return this.triangles_},i}(),Triangulation$1=Triangulation,IMAGE_SMOOTHING_DISABLED={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},brokenDiagonalRendering_;function drawTestTriangle(i,r,t,e,n){i.beginPath(),i.moveTo(0,0),i.lineTo(r,t),i.lineTo(e,n),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(r,e)+1,Math.max(t,n)),i.restore()}function verifyBrokenDiagonalRendering(i,r){return Math.abs(i[r*4]-210)>2||Math.abs(i[r*4+3]-.75*255)>2}function isBrokenDiagonalRendering(){if(brokenDiagonalRendering_===void 0){var i=document.createElement("canvas").getContext("2d");i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(i,4,5,4,0),drawTestTriangle(i,4,5,0,5);var r=i.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(r,0)||verifyBrokenDiagonalRendering(r,4)||verifyBrokenDiagonalRendering(r,8)}return brokenDiagonalRendering_}function calculateSourceResolution(i,r,t,e){var n=transform(t,r,i),o=getPointResolution(r,e,t),a=r.getMetersPerUnit();a!==void 0&&(o*=a);var s=i.getMetersPerUnit();s!==void 0&&(o/=s);var l=i.getExtent();if(!l||containsCoordinate(l,n)){var u=getPointResolution(i,o,n)/o;isFinite(u)&&u>0&&(o/=u)}return o}function calculateSourceExtentResolution(i,r,t,e){var n=getCenter(t),o=calculateSourceResolution(i,r,n,e);return(!isFinite(o)||o<=0)&&forEachCorner(t,function(a){return o=calculateSourceResolution(i,r,a,e),isFinite(o)&&o>0}),o}function render(i,r,t,e,n,o,a,s,l,u,h,c){var f=createCanvasContext2D(Math.round(t*i),Math.round(t*r));if(assign(f,c),l.length===0)return f.canvas;f.scale(t,t);function p(E){return Math.round(E*t)/t}f.globalCompositeOperation="lighter";var d=createEmpty();l.forEach(function(E,T,I){extend$1(d,E.extent)});var v=getWidth(d),_=getHeight(d),g=createCanvasContext2D(Math.round(t*v/e),Math.round(t*_/e));assign(g,c);var y=t/e;l.forEach(function(E,T,I){var R=E.extent[0]-d[0],C=-(E.extent[3]-d[3]),S=getWidth(E.extent),L=getHeight(E.extent);E.image.width>0&&E.image.height>0&&g.drawImage(E.image,u,u,E.image.width-2*u,E.image.height-2*u,R*y,C*y,S*y,L*y)});var m=getTopLeft(a);return s.getTriangles().forEach(function(E,T,I){var R=E.source,C=E.target,S=R[0][0],L=R[0][1],O=R[1][0],P=R[1][1],D=R[2][0],N=R[2][1],A=p((C[0][0]-m[0])/o),M=p(-(C[0][1]-m[1])/o),w=p((C[1][0]-m[0])/o),G=p(-(C[1][1]-m[1])/o),b=p((C[2][0]-m[0])/o),B=p(-(C[2][1]-m[1])/o),U=S,x=L;S=0,L=0,O-=U,P-=x,D-=U,N-=x;var k=[[O,P,0,0,w-A],[D,N,0,0,b-A],[0,0,O,P,G-M],[0,0,D,N,B-M]],F=solveLinearSystem(k);if(!!F){if(f.save(),f.beginPath(),isBrokenDiagonalRendering()||c===IMAGE_SMOOTHING_DISABLED){f.moveTo(w,G);for(var $=4,W=A-w,V=M-G,X=0;X<$;X++)f.lineTo(w+p((X+1)*W/$),G+p(X*V/($-1))),X!=$-1&&f.lineTo(w+p((X+1)*W/$),G+p((X+1)*V/($-1)));f.lineTo(b,B)}else f.moveTo(w,G),f.lineTo(A,M),f.lineTo(b,B);f.clip(),f.transform(F[0],F[2],F[1],F[3],A,M),f.translate(d[0]-U,d[3]-x),f.scale(e/t,-e/t),f.drawImage(g.canvas,0,0),f.restore()}}),h&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,s.getTriangles().forEach(function(E,T,I){var R=E.target,C=(R[0][0]-m[0])/o,S=-(R[0][1]-m[1])/o,L=(R[1][0]-m[0])/o,O=-(R[1][1]-m[1])/o,P=(R[2][0]-m[0])/o,D=-(R[2][1]-m[1])/o;f.beginPath(),f.moveTo(L,O),f.lineTo(C,S),f.lineTo(P,D),f.closePath(),f.stroke()}),f.restore()),f.canvas}var __extends$4=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ReprojTile=function(i){__extends$4(r,i);function r(t,e,n,o,a,s,l,u,h,c,f,p){var d=i.call(this,a,TileState.IDLE)||this;d.renderEdges_=f!==void 0?f:!1,d.contextOptions_=p,d.pixelRatio_=l,d.gutter_=u,d.canvas_=null,d.sourceTileGrid_=e,d.targetTileGrid_=o,d.wrappedTileCoord_=s||a,d.sourceTiles_=[],d.sourcesListenerKeys_=null,d.sourceZ_=0;var v=o.getTileCoordExtent(d.wrappedTileCoord_),_=d.targetTileGrid_.getExtent(),g=d.sourceTileGrid_.getExtent(),y=_?getIntersection(v,_):v;if(getArea(y)===0)return d.state=TileState.EMPTY,d;var m=t.getExtent();m&&(g?g=getIntersection(g,m):g=m);var E=o.getResolution(d.wrappedTileCoord_[0]),T=calculateSourceExtentResolution(t,n,y,E);if(!isFinite(T)||T<=0)return d.state=TileState.EMPTY,d;var I=c!==void 0?c:ERROR_THRESHOLD;if(d.triangulation_=new Triangulation$1(t,n,y,g,T*I,E),d.triangulation_.getTriangles().length===0)return d.state=TileState.EMPTY,d;d.sourceZ_=e.getZForResolution(T);var R=d.triangulation_.calculateSourceExtent();if(g&&(t.canWrapX()?(R[1]=clamp(R[1],g[1],g[3]),R[3]=clamp(R[3],g[1],g[3])):R=getIntersection(R,g)),!getArea(R))d.state=TileState.EMPTY;else{for(var C=e.getTileRangeForExtentAndZ(R,d.sourceZ_),S=C.minX;S<=C.maxX;S++)for(var L=C.minY;L<=C.maxY;L++){var O=h(d.sourceZ_,S,L,l);O&&d.sourceTiles_.push(O)}d.sourceTiles_.length===0&&(d.state=TileState.EMPTY)}return d}return r.prototype.getImage=function(){return this.canvas_},r.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(h,c,f){h&&h.getState()==TileState.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(h.tileCoord),image:h.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=TileState.ERROR;else{var e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),o=typeof n=="number"?n:n[0],a=typeof n=="number"?n:n[1],s=this.targetTileGrid_.getResolution(e),l=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render(o,a,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),s,u,this.triangulation_,t,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=TileState.LOADED}this.changed()},r.prototype.load=function(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,n,o){var a=e.getState();if(a==TileState.IDLE||a==TileState.LOADING){t++;var s=listen(e,EventType.CHANGE,function(l){var u=e.getState();(u==TileState.LOADED||u==TileState.ERROR||u==TileState.EMPTY)&&(unlistenByKey(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,o){var a=e.getState();a==TileState.IDLE&&e.load()})}},r.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null},r}(Tile$1),ReprojTile$1=ReprojTile,__extends$3=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),TileImage=function(i){__extends$3(r,i);function r(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,e.tileClass=t.tileClass!==void 0?t.tileClass:ImageTile$1,e.tileCacheForProjection={},e.tileGridForProjection={},e.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,e.contextOptions_=t.imageSmoothing===!1?IMAGE_SMOOTHING_DISABLED:void 0,e.renderReprojectionEdges_=!1,e}return r.prototype.canExpireCache=function(){if(!ENABLE_RASTER_REPROJECTION)return i.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},r.prototype.expireCache=function(t,e){if(!ENABLE_RASTER_REPROJECTION){i.prototype.expireCache.call(this,t,e);return}var n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(var o in this.tileCacheForProjection){var a=this.tileCacheForProjection[o];a.expireCache(a==n?e:{})}},r.prototype.getContextOptions=function(){return this.contextOptions_},r.prototype.getGutterForProjection=function(t){return ENABLE_RASTER_REPROJECTION&&this.getProjection()&&t&&!equivalent(this.getProjection(),t)?0:this.getGutter()},r.prototype.getGutter=function(){return 0},r.prototype.getKey=function(){return i.prototype.getKey.call(this)+(this.contextOptions_?`
`+JSON.stringify(this.contextOptions_):"")},r.prototype.getOpaque=function(t){return ENABLE_RASTER_REPROJECTION&&this.getProjection()&&t&&!equivalent(this.getProjection(),t)?!1:i.prototype.getOpaque.call(this,t)},r.prototype.getTileGridForProjection=function(t){if(!ENABLE_RASTER_REPROJECTION)return i.prototype.getTileGridForProjection.call(this,t);var e=this.getProjection();if(this.tileGrid&&(!e||equivalent(e,t)))return this.tileGrid;var n=getUid(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=getForProjection(t)),this.tileGridForProjection[n]},r.prototype.getTileCacheForProjection=function(t){if(!ENABLE_RASTER_REPROJECTION)return i.prototype.getTileCacheForProjection.call(this,t);var e=this.getProjection();if(!e||equivalent(e,t))return this.tileCache;var n=getUid(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new TileCache$1(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]},r.prototype.createTile_=function(t,e,n,o,a,s){var l=[t,e,n],u=this.getTileCoordForTileUrlFunction(l,a),h=u?this.tileUrlFunction(u,o,a):void 0,c=new this.tileClass(l,h!==void 0?TileState.IDLE:TileState.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=s,c.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),c},r.prototype.getTile=function(t,e,n,o,a){var s=this.getProjection();if(!ENABLE_RASTER_REPROJECTION||!s||!a||equivalent(s,a))return this.getTileInternal(t,e,n,o,s||a);var l=this.getTileCacheForProjection(a),u=[t,e,n],h=void 0,c=getKey(u);l.containsKey(c)&&(h=l.get(c));var f=this.getKey();if(h&&h.key==f)return h;var p=this.getTileGridForProjection(s),d=this.getTileGridForProjection(a),v=this.getTileCoordForTileUrlFunction(u,a),_=new ReprojTile$1(s,p,a,d,u,v,this.getTilePixelRatio(o),this.getGutter(),function(g,y,m,E){return this.getTileInternal(g,y,m,E,s)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return _.key=f,h?(_.interimTile=h,_.refreshInterimChain(),l.replace(c,_)):l.set(c,_),_},r.prototype.getTileInternal=function(t,e,n,o,a){var s=null,l=getKeyZXY(t,e,n),u=this.getKey();if(!this.tileCache.containsKey(l))s=this.createTile_(t,e,n,o,a,u),this.tileCache.set(l,s);else if(s=this.tileCache.get(l),s.key!=u){var h=s;s=this.createTile_(t,e,n,o,a,u),h.getState()==TileState.IDLE?s.interimTile=h.interimTile:s.interimTile=h,s.refreshInterimChain(),this.tileCache.replace(l,s)}return s},r.prototype.setRenderReprojectionEdges=function(t){if(!(!ENABLE_RASTER_REPROJECTION||this.renderReprojectionEdges_==t)){this.renderReprojectionEdges_=t;for(var e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},r.prototype.setTileGridForProjection=function(t,e){if(ENABLE_RASTER_REPROJECTION){var n=get$1(t);if(n){var o=getUid(n);o in this.tileGridForProjection||(this.tileGridForProjection[o]=e)}}},r}(UrlTile$1);function defaultTileLoadFunction(i,r){i.getImage().src=r}var TileImage$1=TileImage,__extends$2=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),BaseTileLayer=function(i){__extends$2(r,i);function r(t){var e=this,n=t||{},o=assign({},n);return delete o.preload,delete o.useInterimTilesOnError,e=i.call(this,o)||this,e.on,e.once,e.un,e.setPreload(n.preload!==void 0?n.preload:0),e.setUseInterimTilesOnError(n.useInterimTilesOnError!==void 0?n.useInterimTilesOnError:!0),e}return r.prototype.getPreload=function(){return this.get(TileProperty.PRELOAD)},r.prototype.setPreload=function(t){this.set(TileProperty.PRELOAD,t)},r.prototype.getUseInterimTilesOnError=function(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)},r.prototype.setUseInterimTilesOnError=function(t){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,t)},r}(Layer$1),BaseTileLayer$1=BaseTileLayer,__extends$1=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),TileLayer=function(i){__extends$1(r,i);function r(t){return i.call(this,t)||this}return r.prototype.createRenderer=function(){return new CanvasTileLayerRenderer$1(this)},r}(BaseTileLayer$1),TileLayer$1=TileLayer,__extends=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),XYZ=function(i){__extends(r,i);function r(t){var e=this,n=t||{},o=n.projection!==void 0?n.projection:"EPSG:3857",a=n.tileGrid!==void 0?n.tileGrid:createXYZ({extent:extentFromProjection(o),maxResolution:n.maxResolution,maxZoom:n.maxZoom,minZoom:n.minZoom,tileSize:n.tileSize});return e=i.call(this,{attributions:n.attributions,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,imageSmoothing:n.imageSmoothing,opaque:n.opaque,projection:o,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileGrid:a,tileLoadFunction:n.tileLoadFunction,tilePixelRatio:n.tilePixelRatio,tileUrlFunction:n.tileUrlFunction,url:n.url,urls:n.urls,wrapX:n.wrapX!==void 0?n.wrapX:!0,transition:n.transition,attributionsCollapsible:n.attributionsCollapsible,zDirection:n.zDirection})||this,e}return r}(TileImage$1),XYZ$1=XYZ,analyHeatMap_vue_vue_type_style_index_0_scoped_true_lang="";const _sfc_main={name:"Param",setup(){const dataType=reactive({loading:!1,year:0,type:0,chartKey:0,yearList:[{value:0,label:"\u5168\u90E8"},{value:2018,label:"2018\u5E74"},{value:2019,label:"2019\u5E74"},{value:2020,label:"2020\u5E74"},{value:2021,label:"2021\u5E74"}],typeList:[{value:0,label:"\u5168\u90E8"},{value:1,label:"\u6728"},{value:2,label:"\u6C34"},{value:3,label:"\u7535"}]});onMounted(()=>{initMap()});const setHeatMap=i=>{var r=i;let t=[];for(let a=0;a<r.length;++a){let s=new Feature$1({geometry:new point([r[a][0],r[a][1]])});t.push(s)}let e=new VectorSource$1({features:t});var n=new HeatmapLayer({source:e,blur:5,radius:8,weight:function(a){return .5}}),o=new TileLayer$1({source:new XYZ$1({url:"http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}"})});new Map$1({layers:[o,n],target:"myChart",view:new View$1({center:[114.363374,30.539491],zoom:14.5,minZoom:4,maxZoom:20,projection:"EPSG:4326"})})},initMap=(year=0,type=0)=>{axios.get("/api/repairs?pageNum=1&pageSize=1000").then(res=>{var data=eval(res.data.data.records);year!=0&&(data=data.filter(function(i){return i.applyDate.substr(0,4)==year})),type!=0&&(data=data.filter(function(i){var r=dataType.typeList[type+1].label;return i.title==r}));var coordinates=[];for(let i=0;i<data.length;++i)coordinates.push([data[i].longitude,data[i].latitude]);setHeatMap(coordinates)})};function updateData(){dataType.chartKey+=1;var i=dataType;initMap(i.year,i.type)}return Wt(jt({},toRefs(dataType)),{setHeatMap,initMap,updateData})}},_withScopeId=i=>(pushScopeId("data-v-3466f2aa"),i=i(),popScopeId(),i),_hoisted_1={id:"filterArea",class:"filterArea"},_hoisted_2=_withScopeId(()=>createBaseVNode("div",{class:"title"},"\u4E8B\u4EF6\u7C7B\u578B",-1)),_hoisted_3=_withScopeId(()=>createBaseVNode("div",{class:"title"},"\u63D0\u4EA4\u65F6\u95F4",-1)),_hoisted_4=createTextVNode("Search ");function _sfc_render(i,r,t,e,n,o){const a=resolveComponent("el-option"),s=resolveComponent("el-select"),l=resolveComponent("search"),u=resolveComponent("el-icon"),h=resolveComponent("el-button");return openBlock(),createElementBlock(Fragment,null,[(openBlock(),createElementBlock("div",{id:"myChart",class:"myChart",ref:"chart",style:{width:"600px"},key:i.chartKey})),createBaseVNode("div",_hoisted_1,[_hoisted_2,createVNode(s,{modelValue:i.type,"onUpdate:modelValue":r[0]||(r[0]=c=>i.type=c),placeholder:"Select",id:"typeSelect"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.typeList,c=>(openBlock(),createBlock(a,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),_hoisted_3,createVNode(s,{modelValue:i.year,"onUpdate:modelValue":r[1]||(r[1]=c=>i.year=c),placeholder:"Select",id:"yearSelect"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.yearList,c=>(openBlock(),createBlock(a,{key:c.value,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),createVNode(h,{type:"primary",onClick:e.updateData,class:"searchBtn"},{default:withCtx(()=>[createVNode(u,{style:{"vertical-align":"middle"}},{default:withCtx(()=>[createVNode(l)]),_:1}),_hoisted_4]),_:1},8,["onClick"])])],64)}var analyHeatMap=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-3466f2aa"]]);export{analyHeatMap as default};
